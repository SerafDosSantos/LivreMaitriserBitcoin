<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Op√©rations</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article data-line-1">
<div id="header">
</div>
<div id="content">
<div class="sect1 data-line-3">
<h2 id="transactions">Op√©rations</h2>
<div class="sectionbody">
<div class="sect2 data-line-6">
<h3 id="ch06_intro">Pr√©sentation</h3>
<div class="paragraph data-line-8">
<p>Les transactions sont la partie la plus importante du syst√®me Bitcoin. Tout le reste dans le bitcoin est con√ßu pour garantir que les transactions peuvent √™tre cr√©√©es, propag√©es sur le r√©seau, valid√©es et finalement ajout√©es au grand livre mondial des transactions (la cha√Æne de blocs). Les transactions sont des structures de donn√©es qui encodent le transfert de valeur entre les participants au syst√®me Bitcoin. Chaque transaction est une entr√©e publique dans la cha√Æne de blocs de bitcoin, le grand livre comptable mondial en partie double.</p>
</div>
<div class="paragraph data-line-10">
<p>Dans ce chapitre, nous examinerons toutes les diff√©rentes formes de transactions, ce qu&#8217;elles contiennent, comment les cr√©er, comment elles sont v√©rifi√©es et comment elles deviennent partie int√©grante de l&#8217;enregistrement permanent de toutes les transactions. Lorsque nous utilisons le terme &quot;portefeuille&quot; dans ce chapitre, nous faisons r√©f√©rence au logiciel qui construit les transactions, et pas seulement √† la base de donn√©es des cl√©s.</p>
</div>
</div>
<div class="sect2 data-line-13">
<h3 id="tx_structure">Transactions en d√©tail</h3>
<div class="paragraph data-line-15">
<p>Dans <a href="#ch02_bitcoin_overview">[ch02_bitcoin_overview]</a>, nous avons examin√© la transaction utilis√©e par Alice pour payer un caf√© au comptoir √† caf√© de Bob √† l&#8217;aide d&#8217;un explorateur de blocs (<a href="#alices_transactions_to_bobs_cafe">Transaction d&#8217;Alice au Bob&#8217;s Caf√©</a>).</p>
</div>
<div class="paragraph data-line-17">
<p>L&#8217;application de l&#8217;explorateur de blocs montre une transaction de &quot;l&#8217;adresse&quot; d&#8217;Alice √† &quot;l&#8217;adresse&quot; de Bob. Il s&#8217;agit d&#8217;une vue tr√®s simplifi√©e de ce qui est contenu dans une transaction. En fait, comme nous le verrons dans ce chapitre, une grande partie des informations affich√©es sont construites par l&#8217;explorateur de blocs et ne se trouvent pas r√©ellement dans la transaction.</p>
</div>
<div id="alices_transactions_to_bobs_cafe" class="imageblock data-line-21">
<div class="content">
<img src="images/mbc2_0208.png" alt="Alice Coffee Transaction">
</div>
<div class="title">Figure 1. Transaction d&#8217;Alice au Bob&#8217;s Caf√©</div>
</div>
<div class="sect3 data-line-24">
<h4 id="transactions_behind_the_scenes">Transactions: Dans les coulisses</h4>
<div class="paragraph data-line-26">
<p> Dans les coulisses, une transaction r√©elle est tr√®s diff√©rente d&#8217;une transaction fournie par un explorateur de blocs typique. En fait, la plupart des constructions de haut niveau que nous voyons dans les diff√©rentes interfaces utilisateur des applications bitcoin <em>n&#8217;existent pas r√©ellement</em> dans le syst√®me Bitcoin.</p>
</div>
<div class="paragraph data-line-28">
<p>Nous pouvons utiliser l&#8217;interface de ligne de commande de Bitcoin Core (getrawtransaction et decoderawtransaction) pour r√©cup√©rer la transaction &quot;brute&quot; d&#8217;Alice, la d√©coder et voir ce qu&#8217;elle contient. Le r√©sultat ressemble √† ceci¬†:</p>
</div>
<div id="alice_tx" class="listingblock data-line-33">
<div class="title">La transaction d&#8217;Alice d√©cod√©e</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
  "version": 1,
  "locktime": 0,
  "vin": [
    {
      "txid": "7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18",
      "vout": 0,
      "scriptSig" : "3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf",
      "sequence": 4294967295
    }
  ],
  "vout": [
    {
      "value": 0.01500000,
      "scriptPubKey": "OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY OP_CHECKSIG"
    },
    {
      "value": 0.08450000,
      "scriptPubKey": "OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG",
    }
  ]
}</code></pre>
</div>
</div>
<div class="paragraph data-line-58">
<p>Vous remarquerez peut-√™tre certaines choses √† propos de cette transaction, principalement les choses qui manquent¬†! O√π est l&#8217;adresse d&#8217;Alice ? O√π est l&#8217;adresse de Bob ? O√π est l&#8217;entr√©e 0.1 &quot;envoy√©e&quot; par Alice¬†? En bitcoin, il n&#8217;y a pas de pi√®ces, pas d&#8217;exp√©diteurs, pas de destinataires, pas de soldes, pas de comptes et pas d&#8217;adresses. Toutes ces choses sont construites √† un niveau sup√©rieur pour le b√©n√©fice de l&#8217;utilisateur, pour rendre les choses plus faciles √† comprendre.</p>
</div>
<div class="paragraph data-line-60">
<p>Vous pouvez √©galement remarquer de nombreux champs √©tranges et ind√©chiffrables et des cha√Ænes hexad√©cimales. Ne vous inqui√©tez pas, nous expliquerons en d√©tail chaque champ affich√© ici dans ce chapitre.</p>
</div>
</div>
</div>
<div class="sect2 data-line-63">
<h3 id="tx_inputs_outputs">Sorties et entr√©es de transaction</h3>
<div class="paragraph data-line-65">
<p>La base fondamentale d&#8217;une transaction bitcoin est une <em>sortie de transaction</em>. Les sorties de transaction sont des morceaux indivisibles de monnaie bitcoin, enregistr√©s sur la cha√Æne de blocs et reconnus comme valides par l&#8217;ensemble du r√©seau. Les n≈ìuds complets Bitcoin suivent toutes les sorties disponibles et utilisables, appel√©es <em>sorties de transaction non d√©pens√©es</em>, ou <em>UTXO</em>. La collection de tous les UTXO est connue sous le nom d'<em>ensemble UTXO</em> et compte actuellement des millions d&#8217;UTXO. L&#8217;ensemble UTXO augmente √† mesure que de nouveaux UTXO sont cr√©√©s et diminue lorsque UTXO est consomm√©. Chaque transaction repr√©sente un changement (transition d&#8217;√©tat) dans l&#8217;ensemble UTXO.</p>
</div>
<div class="paragraph data-line-67">
<p>Lorsque nous disons que le portefeuille d&#8217;un utilisateur a &quot;re√ßu&quot; du bitcoin, nous voulons dire que le portefeuille a d√©tect√© sur la cha√Æne de blocs un UTXO pouvant √™tre d√©pens√© avec l&#8217;une des cl√©s contr√¥l√©es par ce portefeuille. Ainsi, le &quot;solde&quot; de bitcoins d&#8217;un utilisateur est la somme de tous les UTXO que le portefeuille de l&#8217;utilisateur peut d√©penser et qui peuvent √™tre dispers√©s parmi des centaines de transactions et des centaines de blocs. Le concept de solde est cr√©√© par l&#8217;application de portefeuille. Le portefeuille calcule le solde de l&#8217;utilisateur en scannant la cha√Æne de blocs et en agr√©geant la valeur de tout UTXO que le portefeuille peut d√©penser avec les cl√©s qu&#8217;il contr√¥le. La plupart des portefeuilles maintiennent une base de donn√©es ou utilisent un service de base de donn√©es pour stocker un ensemble de r√©f√©rence rapide de tous les UTXO qu&#8217;ils peuvent d√©penser avec les cl√©s qu&#8217;ils contr√¥lent.</p>
</div>
<div class="paragraph data-line-69">
<p><a href="#utxo-stxo">Cha√Æne de transaction de Joe √† Gopesh en cours de construction sur la cha√Æne de blocs</a> affiche la cha√Æne de blocs √† trois moments diff√©rents, alors que la cha√Æne de transaction de Joe √† Gopesh est en cours de construction. Remarquez comment chaque transaction d√©pense un UTXO qui a √©t√© cr√©√© dans une transaction pr√©c√©dente, le transformant en une <em>sortie de transaction d√©pens√©e</em>, ou <em>STXO</em>. Puisque la transaction #1 (de Joe √† Alice) d√©pense un seul UTXO (de Joe) et cr√©e un seul UTXO (√† Alice), elle ne modifie pas la taille de l&#8217;ensemble UTXO. D&#8217;autre part, les transactions #2 et #3 cr√©ent toutes deux des sorties de change √† l&#8217;exp√©diteur, d√©pensant un seul UTXO et cr√©ant deux UTXO (le paiement et la sortie de change). Par cons√©quent, chacun d&#8217;eux augmente la taille de l&#8217;ensemble UTXO de 1.</p>
</div>
<div id="utxo-stxo" class="imageblock data-line-73">
<div class="content">
<img src="images/mbc2_0609.png" alt="&quot;Cha√Æne de transaction de Joe √† Gopesh en cours de construction sur la blockchain&quot;">
</div>
<div class="title">Figure 2. Cha√Æne de transaction de Joe √† Gopesh en cours de construction sur la cha√Æne de blocs</div>
</div>
<div class="paragraph data-line-75">
<p>Une sortie de transaction peut avoir une valeur arbitraire (enti√®re) libell√©e comme un multiple de satoshis. Tout comme les dollars peuvent √™tre divis√©s jusqu&#8217;√† deux d√©cimales sous forme de cents, le bitcoin peut √™tre divis√© jusqu&#8217;√† huit d√©cimales sous forme de satoshis. Bien qu&#8217;une sortie puisse avoir n&#8217;importe quelle valeur arbitraire, une fois cr√©√©e, elle est indivisible. Il s&#8217;agit d&#8217;une caract√©ristique importante des sorties qui doit √™tre soulign√©e¬†: les sorties sont des unit√©s de valeur <em>discr√®tes</em> et <em>indivisibles</em>, libell√©es en satoshis entiers. Une production non d√©pens√©e ne peut √™tre consomm√©e dans son int√©gralit√© que par une transaction.</p>
</div>
<div class="paragraph data-line-77">
<p>Si un UTXO est sup√©rieur √† la valeur souhait√©e d&#8217;une transaction, il doit toujours √™tre consomm√© dans son int√©gralit√© et le changement doit √™tre g√©n√©r√© dans la transaction. En d&#8217;autres termes, si vous avez un UTXO d&#8217;une valeur de 20 bitcoins et que vous souhaitez payer seulement 1 bitcoin, votre transaction doit consommer l&#8217;int√©gralit√© de l&#8217;UTXO de 20 bitcoins et produire deux sorties : une payant 1 bitcoin au destinataire souhait√© et une autre payant 19 bitcoin en √©change. retour dans votre portefeuille. En raison de la nature indivisible des sorties de transaction, la plupart des transactions bitcoin devront g√©n√©rer du change.</p>
</div>
<div class="paragraph data-line-79">
<p>Imaginez une cliente qui ach√®te une boisson √† 1,50 $, puise dans son portefeuille et essaie de trouver une combinaison de pi√®ces et de billets de banque pour couvrir le co√ªt de 1,50 $. L&#8217;acheteur choisira la monnaie exacte si disponible, par exemple un billet d&#8217;un dollar et deux quarts (un quart vaut 0,25 $), ou une combinaison de coupures plus petites (six quarts), ou si n√©cessaire, une unit√© plus grande comme un billet de 5 $. Si elle remet trop d&#8217;argent, disons 5 $, au propri√©taire du magasin, elle s&#8217;attendra √† 3,50 $ de monnaie, qu&#8217;elle remettra dans son portefeuille et qu&#8217;elle disposera pour de futures transactions.</p>
</div>
<div class="paragraph data-line-81">
<p>De m√™me, une transaction bitcoin doit √™tre cr√©√©e √† partir de l&#8217;UTXO d&#8217;un utilisateur dans toutes les d√©nominations disponibles pour cet utilisateur. Les utilisateurs ne peuvent pas couper un UTXO en deux, pas plus qu&#8217;ils ne peuvent couper un billet d&#8217;un dollar en deux et l&#8217;utiliser comme monnaie. L&#8217;application de portefeuille de l&#8217;utilisateur s√©lectionne g√©n√©ralement √† partir de l&#8217;UTXO disponible de l&#8217;utilisateur pour composer un montant sup√©rieur ou √©gal au montant de transaction souhait√©.</p>
</div>
<div class="paragraph data-line-83">
<p>Comme dans la vraie vie, l&#8217;application bitcoin peut utiliser plusieurs strat√©gies pour satisfaire le montant de l&#8217;achat¬†: combiner plusieurs unit√©s plus petites, trouver la monnaie exacte ou utiliser une seule unit√© sup√©rieure √† la valeur de la transaction et rendre la monnaie. Tout cet assemblage complexe d&#8217;UTXO d√©pensables est effectu√© automatiquement par le portefeuille de l&#8217;utilisateur et est invisible pour les utilisateurs. Cela n&#8217;est pertinent que si vous construisez par programme des transactions brutes √† partir d&#8217;UTXO.</p>
</div>
<div class="paragraph data-line-85">
<p>Une transaction consomme des sorties de transaction non d√©pens√©es pr√©c√©demment enregistr√©es et cr√©e de nouvelles sorties de transaction qui peuvent √™tre consomm√©es par une transaction future. De cette fa√ßon, des morceaux de valeur bitcoin passent d&#8217;un propri√©taire √† l&#8217;autre dans une cha√Æne de transactions consommant et cr√©ant des UTXO.</p>
</div>
<div class="paragraph data-line-87">
<p>L&#8217;exception √† la cha√Æne de sortie et d&#8217;entr√©e est une type sp√©cial de transaction appel√© transaction <em>coinbase</em>, qui est la premi√®re transaction de chaque bloc. Cette transaction y est plac√©e par le mineur &quot;gagnant&quot; et cr√©e un tout nouveau bitcoin payable √† ce mineur en r√©compense de l&#8217;exploitation mini√®re. Cette transaction coinbase sp√©ciale ne consomme pas d&#8217;UTXO ; √† la place, il a un type sp√©cial d&#8217;entr√©e appel√© &quot;coinbase&quot;. C&#8217;est ainsi que la masse mon√©taire du bitcoin est cr√©√©e pendant le processus de minage, comme nous le verrons dans <a href="#mining">[mining]</a>.</p>
</div>
<div class="admonitionblock tip data-line-90">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-91">
<p>Qu&#8217;est-ce qui vient en premier¬†? Entr√©es ou sorties, la poule ou l&#8217;≈ìuf ? Strictement parlant, les sorties viennent en premier parce que les transactions coinbase, qui g√©n√®rent de nouveaux bitcoins, n&#8217;ont pas d&#8217;entr√©es et cr√©ent des sorties √† partir de rien.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3 data-line-95">
<h4 id="tx_outs">Sorties des transactions</h4>
<div class="paragraph data-line-97">
<p>Chaque transaction bitcoin cr√©e des sorties, qui sont enregistr√©es sur le grand livre bitcoin. Presque toutes ces sorties, √† une exception pr√®s (voir <a href="#op_return">[op_return]</a>) cr√©ent des morceaux de bitcoin utilisables appel√©s UTXO, qui sont ensuite reconnus par l&#8217;ensemble du r√©seau et disponibles pour que le propri√©taire les d√©pense lors d&#8217;une future transaction.</p>
</div>
<div class="paragraph data-line-99">
<p>Les UTXO sont suivis par chaque client Bitcoin √† n≈ìud complet dans l&#8217;ensemble UTXO. Les nouvelles transactions consomment (d√©pensent) une ou plusieurs de ces sorties de l&#8217;ensemble UTXO.</p>
</div>
<div class="paragraph data-line-101">
<p>Les sorties de transaction se composent de deux parties¬†:</p>
</div>
<div class="ulist data-line-103">
<ul>
<li class="data-line-103">
<p>Un montant de bitcoin, libell√© en <em>satoshis</em>, la plus petite unit√© de bitcoin</p>
</li>
<li class="data-line-104">
<p>Un puzzle cryptographique qui d√©termine les conditions requises pour passer la sortie</p>
</li>
</ul>
</div>
<div class="paragraph data-line-106">
<p>Le puzzle cryptographique est √©galement connu sous le nom de <em>script de verrouillage</em>, un <em>script de t√©moin</em> ou un scriptPubKey.</p>
</div>
<div class="paragraph data-line-108">
<p>Le langage de script de transaction, utilis√© dans le script de verrouillage mentionn√© pr√©c√©demment, est d√©crit en d√©tail dans <a href="#tx_script">Scripts de transaction et langage de script</a>.</p>
</div>
<div class="paragraph data-line-110">
<p>Maintenant, regardons la transaction d&#8217;Alice (montr√©e pr√©c√©demment dans <a href="#transactions_behind_the_scenes">Transactions: Dans les coulisses</a>) et voir si nous pouvons identifier les sorties. Dans l&#8217;encodage JSON, les sorties sont dans un tableau (liste) nomm√© vout¬†:</p>
</div>
<div class="listingblock data-line-113">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"vout": [
  {
    "value": 0.01500000,
    "scriptPubKey": "OP_DUP OP_HASH160 ab68025513c3dbd2f7b92a94e0581f5d50f654e7 OP_EQUALVERIFY
    OP_CHECKSIG"
  },
  {
    "value": 0.08450000,
    "scriptPubKey": "OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG",
  }
]</code></pre>
</div>
</div>
<div class="paragraph data-line-127">
<p>Comme vous pouvez le voir, la transaction contient deux sorties. Chaque sortie est d√©finie par une valeur et un puzzle cryptographique. Dans l&#8217;encodage indiqu√© par Bitcoin Core, la valeur est indiqu√©e en bitcoin, mais dans la transaction elle-m√™me, elle est enregistr√©e sous la forme d&#8217;un entier libell√© en satoshis. La deuxi√®me partie de chaque sortie est le puzzle cryptographique qui fixe les conditions de d√©penses. Bitcoin Core le montre comme scriptPubKey et nous montre une repr√©sentation lisible par l&#8217;homme du script.</p>
</div>
<div class="paragraph data-line-129">
<p>Le sujet du verrouillage et du d√©verrouillage de l&#8217;UTXO sera abord√© plus tard, dans <a href="#tx_lock_unlock">Construction du script (Verrouiller + D√©verrouiller)</a>. Le langage de script utilis√© pour le script dans scriptPubKey est d√©crit dans <a href="#tx_script">Scripts de transaction et langage de script</a>. Mais avant d&#8217;approfondir ces sujets, nous devons comprendre la structure globale des entr√©es et sorties des transactions.</p>
</div>
<div class="sect4 data-line-131">
<h5 id="_s√©rialisation_des_transactions_sorties">S√©rialisation des transactions: sorties</h5>
<div class="paragraph data-line-133">
<p>Lorsque les transactions sont transmises sur le r√©seau ou √©chang√©es entre applications, elles sont <em>s√©rialis√©es</em>. La s√©rialisation est le processus de conversion de la repr√©sentation interne d&#8217;une structure de donn√©es dans un format qui peut √™tre transmis un octet √† la fois, √©galement appel√© flux d&#8217;octets. La s√©rialisation est le plus souvent utilis√©e pour coder des structures de donn√©es √† transmettre sur un r√©seau ou √† stocker dans un fichier. Le format de s√©rialisation d&#8217;une sortie de transaction est affich√© dans <a href="#tx_out_structure">S√©rialisation des sorties de transaction</a>.</p>
</div>
<table id="tx_out_structure" class="tableblock frame-all grid-all stretch data-line-138">
<caption class="title">Table 1. S√©rialisation des sorties de transaction</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Taille</th>
<th class="tableblock halign-left valign-top">Champ</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">8 octets (petit-boutiste)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Montant</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Valeur du bitcoin en satoshis (10<sup>-8</sup> bitcoin)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1‚Äì9 octets (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taille du script de verrouillage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Longueur du script de verrouillage en octets, √† suivre</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Variable</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Script de verrouillage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un script d√©finissant les conditions n√©cessaires pour d√©penser la sortie</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-145">
<p>La plupart des biblioth√®ques et frameworks bitcoin ne stockent pas les transactions en interne sous forme de flux d&#8217;octets, car cela n√©cessiterait une analyse complexe chaque fois que vous auriez besoin d&#8217;acc√©der √† un seul champ. Pour plus de commodit√© et de lisibilit√©, les biblioth√®ques bitcoin stockent les transactions en interne dans des structures de donn√©es (g√©n√©ralement des structures orient√©es objet).</p>
</div>
<div class="paragraph data-line-147">
<p>Le processus de conversion de la repr√©sentation de flux d&#8217;octets d&#8217;une transaction en donn√©es de repr√©sentation interne d&#8217;une biblioth√®que est appel√©e <em>d√©s√©rialisation</em> ou <em>analyse des transactions</em>. Le processus de reconversion en un flux d&#8217;octets pour la transmission sur le r√©seau, pour le hachage ou pour le stockage sur disque est appel√© <em>s√©rialisation</em>. La plupart des biblioth√®ques bitcoin ont des fonctions int√©gr√©es pour la s√©rialisation et la d√©s√©rialisation des transactions.</p>
</div>
<div class="paragraph data-line-149">
<p>Voyez si vous pouvez d√©coder manuellement la transaction d&#8217;Alice √† partir de la forme hexad√©cimale s√©rialis√©e, en trouvant certains des √©l√©ments que nous avons vus pr√©c√©demment. La section contenant les deux sorties est mise en surbrillance dans <a href="#example_6_1">Transaction d&#8217;Alice, s√©rialis√©e et pr√©sent√©e en notation hexad√©cimale</a> pour vous aider :</p>
</div>
<div id="example_6_1" class="exampleblock data-line-153">
<div class="title">Example 1. Transaction d&#8217;Alice, s√©rialis√©e et pr√©sent√©e en notation hexad√©cimale</div>
<div class="content">
<div class="paragraph data-line-154">
<p>0100000001186f9f998a5aa6f048e51dd8419a14d8a0f1a8a2836dd73
4d2804fe65fa35779000000008b483045022100884d142d86652a3f47
ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039
ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813
01410484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade84
16ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc1
7b4a10fa336a8d752adfffffffff02<strong>60e31600000000001976a914ab6</strong>
<strong>8025513c3dbd2f7b92a94e0581f5d50f654e788acd0ef800000000000</strong>
<strong>1976a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac</strong>
00000000</p>
</div>
</div>
</div>
<div class="paragraph data-line-166">
<p>Voici quelques conseils¬†:</p>
</div>
<div class="ulist data-line-168">
<ul>
<li class="data-line-168">
<p>Il y a deux sorties dans la section en surbrillance, chacune s√©rialis√©e comme indiqu√© dans <a href="#tx_out_structure">S√©rialisation des sorties de transaction</a>.</p>
</li>
<li class="data-line-169">
<p>La valeur de 0,015 bitcoin est de 1 500 000 satoshis. C&#8217;est 16 e3 60 en hexad√©cimal.</p>
</li>
<li class="data-line-170">
<p>Dans la transaction s√©rialis√©e, la valeur 16 e3 60 est encod√©e dans l&#8217;ordre d&#8217;octets petit-boutiste (octet le moins significatif en premier), elle ressemble donc √† 60 e3 16.</p>
</li>
<li class="data-line-171">
<p>La longueur de scriptPubKey est de 25¬†octets, soit 19 en hexad√©cimal.</p>
</li>
</ul>
</div>
</div>
</div>
<div class="sect3 data-line-174">
<h4 id="tx_inputs">Entr√©es de transactions</h4>
<div class="paragraph data-line-176">
<p> Les entr√©es de transaction identifient (par r√©f√©rence) quel UTXO sera consomm√© et fournissent une preuve de propri√©t√© via un script de d√©verrouillage.</p>
</div>
<div class="paragraph data-line-178">
<p>Pour construire une transaction, un portefeuille s√©lectionne parmi l&#8217;UTXO qu&#8217;il contr√¥le, l&#8217;UTXO avec une valeur suffisante pour effectuer le paiement demand√©. Parfois un UTXO suffit, d&#8217;autres fois plus d&#8217;un est n√©cessaire. Pour chaque UTXO qui sera consomm√© pour effectuer ce paiement, le portefeuille cr√©e une entr√©e pointant vers l&#8217;UTXO et le d√©verrouille avec un script de d√©verrouillage.</p>
</div>
<div class="paragraph data-line-180">
<p>Examinons plus en d√©tail les composants d&#8217;une entr√©e. La premi√®re partie d&#8217;une entr√©e est un pointeur vers un UTXO par r√©f√©rence au hachage de transaction et √† un index de sortie, qui identifie l&#8217;UTXO sp√©cifique dans cette transaction. La deuxi√®me partie est un script de d√©verrouillage, que le portefeuille construit afin de satisfaire aux conditions de d√©penses d√©finies dans l&#8217;UTXO. Le plus souvent, le script de d√©verrouillage est une signature num√©rique et une cl√© publique prouvant la propri√©t√© du bitcoin. Cependant, ce ne sont pas tous les scripts de d√©verrouillage qui contiennent une signature. La troisi√®me partie est un num√©ro de s√©quence, qui sera discut√© plus tard.</p>
</div>
<div class="paragraph data-line-182">
<p>Consid√©rez notre exemple dans <a href="#transactions_behind_the_scenes">Transactions: Dans les coulisses</a>. Les entr√©es de transaction sont un tableau (liste) appel√© vin¬†:</p>
</div>
<div id="vin" class="listingblock data-line-187">
<div class="title">Les entr√©es de transaction dans la transaction d&#8217;Alice</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"vin": [
  {
    "txid": "7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18",
    "vout": 0,
    "scriptSig" : "3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf",
    "sequence": 4294967295
  }
]</code></pre>
</div>
</div>
<div class="paragraph data-line-198">
<p>Comme vous pouvez le voir, il n&#8217;y a qu&#8217;une seule entr√©e dans la liste (car un UTXO contenait une valeur suffisante pour effectuer ce paiement). L&#8217;entr√©e contient quatre √©l√©ments¬†:</p>
</div>
<div class="ulist data-line-200">
<ul>
<li class="data-line-200">
<p>Un ID de transaction, faisant r√©f√©rence √† la transaction qui contient l&#8217;UTXO d√©pens√©</p>
</li>
<li class="data-line-201">
<p>Un index de sortie (vout), identifiant quel UTXO de cette transaction est r√©f√©renc√© (le premier est z√©ro)</p>
</li>
<li class="data-line-202">
<p>Un scriptSig, qui satisfait aux conditions impos√©es √† l&#8217;UTXO, le d√©verrouillant pour les d√©penses</p>
</li>
<li class="data-line-203">
<p>Un num√©ro de s√©quence (√† discuter plus tard)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-205">
<p>Dans la transaction d&#8217;Alice, l&#8217;entr√©e pointe vers l&#8217;ID de transaction¬†:</p>
</div>
<div class="listingblock data-line-207">
<div class="content">
<pre>7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18</pre>
</div>
</div>
<div class="paragraph data-line-211">
<p>et l&#8217;indice de sortie 0 (c&#8217;est-√†-dire le premier UTXO cr√©√© par cette transaction). Le script de d√©verrouillage est construit par le portefeuille d&#8217;Alice en r√©cup√©rant d&#8217;abord l&#8217;UTXO r√©f√©renc√©, en examinant son script de verrouillage, puis en l&#8217;utilisant pour cr√©er le script de d√©verrouillage n√©cessaire pour le satisfaire.</p>
</div>
<div class="paragraph data-line-213">
<p>En regardant simplement l&#8217;entr√©e, vous avez peut-√™tre remarqu√© que nous ne savons rien de cet UTXO, √† part une r√©f√©rence √† la transaction parent qui le contient. Nous ne connaissons pas sa valeur (montant en satoshi), et nous ne connaissons pas le script de verrouillage qui fixe les conditions pour le d√©penser. Pour retrouver ces informations, il faut r√©cup√©rer l&#8217;UTXO r√©f√©renc√© en r√©cup√©rant la transaction m√®re qui le contient. Notez que parce que la valeur de l&#8217;entr√©e n&#8217;est pas explicitement indiqu√©e, nous devons √©galement utiliser l&#8217;UTXO r√©f√©renc√© afin de calculer les frais qui seront pay√©s dans cette transaction (voir <a href="#tx_fees">Frais de transaction</a>).</p>
</div>
<div class="paragraph data-line-215">
<p>Ce n&#8217;est pas seulement le portefeuille d&#8217;Alice qui doit r√©cup√©rer l&#8217;UTXO r√©f√©renc√© dans les entr√©es. Une fois cette transaction diffus√©e sur le r√©seau, chaque n≈ìud de validation devra √©galement r√©cup√©rer l&#8217;UTXO r√©f√©renc√© dans les entr√©es de transaction afin de valider la transaction.</p>
</div>
<div class="paragraph data-line-217">
<p>Les transactions en elles-m√™mes semblent incompl√®tes car elles manquent de contexte. Elles r√©f√©rencent l&#8217;UTXO dans leurs entr√©es mais sans r√©cup√©rer cet UTXO on ne peut pas conna√Ætre la valeur des entr√©es ni leurs conditions de verrouillage. Lors de l&#8217;√©criture d&#8217;un logiciel bitcoin, chaque fois que vous d√©codez une transaction dans le but de la valider ou de compter les frais ou de v√©rifier le script de d√©verrouillage, votre code devra d&#8217;abord r√©cup√©rer l&#8217;UTXO r√©f√©renc√© de la blockchain afin de construire le contexte implicite mais non pr√©sent dans les r√©f√©rences UTXO des entr√©es. Par exemple, pour calculer le montant pay√© en frais, vous devez conna√Ætre la somme des valeurs des entr√©es et des sorties. Mais sans r√©cup√©rer les UTXO r√©f√©renc√©s dans les entr√©es, vous ne connaissez pas leur valeur. Ainsi, une op√©ration apparemment simple comme le comptage des frais dans une seule transaction implique en fait plusieurs √©tapes et des donn√©es provenant de plusieurs transactions.</p>
</div>
<div class="paragraph data-line-219">
<p>Nous pouvons utiliser la m√™me s√©quence de commandes avec Bitcoin Core que celle que nous avons utilis√©e lors de la r√©cup√©ration de la transaction d&#8217;Alice (getrawtransaction et decoderawtransaction). Avec cela, nous pouvons obtenir l&#8217;UTXO r√©f√©renc√© dans l&#8217;entr√©e de la transaction d&#8217;Alice et jeter un ≈ìil¬†:</p>
</div>
<div id="alice_input_tx" class="listingblock data-line-224">
<div class="title">UTXO de la transaction pr√©c√©dente, r√©f√©renc√© dans l&#8217;entr√©e de la transaction d&#8217;Alice</div>
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"vout": [
   {
     "value": 0.10000000,
     "scriptPubKey": "OP_DUP OP_HASH160 7f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a8 OP_EQUALVERIFY OP_CHECKSIG"
   }
 ]</code></pre>
</div>
</div>
<div class="paragraph data-line-233">
<p>On voit que cet UTXO a une valeur de 0.1 BTC et qu&#8217;il a un script de verrouillage (scriptPubKey) qui contient &quot;OP_DUP OP_HASH160&#8230;&#8203;&quot;.</p>
</div>
<div class="admonitionblock tip data-line-236">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-237">
<p>Pour bien comprendre la transaction d&#8217;Alice, nous avons d√ª r√©cup√©rer la transaction pr√©c√©dente r√©f√©renc√©e en entr√©e. Une fonction qui r√©cup√®re les transactions pr√©c√©dentes et les sorties de transaction non d√©pens√©es est tr√®s courante et existe dans presque toutes les biblioth√®ques et API Bitcoin.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect4 data-line-240">
<h5 id="_s√©rialisation_des_transactions_entr√©es">S√©rialisation des transactions: entr√©es</h5>
<div class="paragraph data-line-242">
<p>Lorsque les transactions sont s√©rialis√©es pour √™tre transmises sur le r√©seau, leurs entr√©es sont cod√©es dans un flux d&#8217;octets comme indiqu√© dans <a href="#tx_in_structure">S√©rialisation des entr√©es de transaction</a>.</p>
</div>
<table id="tx_in_structure" class="tableblock frame-all grid-all stretch data-line-247">
<caption class="title">Table 2. S√©rialisation des entr√©es de transaction</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Taille</th>
<th class="tableblock halign-left valign-top">Champ</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hachage de transaction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pointeur vers la transaction contenant l&#8217;UTXO √† d√©penser</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indice de sortie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Le num√©ro d&#8217;index de l&#8217;UTXO √† d√©penser¬†; le premier est 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1‚Äì9 octets (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taille du script de d√©verrouillage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Longueur du script de d√©verrouillage en octets √† suivre</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">D√©verrouillage-Script</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un script remplissant les conditions du script de verrouillage UTXO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Num√©ro de s√©quence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Utilis√© pour le temps de verrouillage ou d√©sactiv√© (0xFFFFFFFF)</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-256">
<p>Comme pour les sorties, voyons si nous pouvons trouver les entr√©es de la transaction d&#8217;Alice au format s√©rialis√©. Tout d&#8217;abord, les entr√©es d√©cod√©es¬†:</p>
</div>
<div class="listingblock data-line-259">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">"vin": [
  {
    "txid": "7957a35fe64f80d234d76d83a2a8f1a0d8149a41d81de548f0a65a8a999f6f18",
    "vout": 0,
    "scriptSig" : "3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813[ALL] 0484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade8416ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc17b4a10fa336a8d752adf",
    "sequence": 4294967295
  }
],</code></pre>
</div>
</div>
<div class="paragraph data-line-270">
<p>Voyons maintenant si nous pouvons identifier ces champs dans le codage hexad√©cimal s√©rialis√© dans <a href="#example_6_2">Transaction d&#8217;Alice, s√©rialis√©e et pr√©sent√©e en notation hexad√©cimale</a>¬†:</p>
</div>
<div id="example_6_2" class="exampleblock data-line-274">
<div class="title">Example 2. Transaction d&#8217;Alice, s√©rialis√©e et pr√©sent√©e en notation hexad√©cimale</div>
<div class="content">
<div class="paragraph data-line-275">
<p>0100000001<strong>186f9f998a5aa6f048e51dd8419a14d8a0f1a8a2836dd73</strong>
<strong>4d2804fe65fa35779000000008b483045022100884d142d86652a3f47</strong>
<strong>ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039</strong>
<strong>ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813</strong>
<strong>01410484ecc0d46f1918b30928fa0e4ed99f16a0fb4fde0735e7ade84</strong>
<strong>16ab9fe423cc5412336376789d172787ec3457eee41c04f4938de5cc1</strong>
<strong>7b4a10fa336a8d752adfffffffff</strong>0260e31600000000001976a914ab6
8025513c3dbd2f7b92a94e0581f5d50f654e788acd0ef800000000000
1976a9147f9b1a7fb68d60c536c2fd8aeaa53a8f3cc025a888ac00000
000</p>
</div>
</div>
</div>
<div class="paragraph data-line-287">
<p>Astuces:</p>
</div>
<div class="ulist data-line-289">
<ul>
<li class="data-line-289">
<p>L&#8217;ID de transaction est s√©rialis√© dans l&#8217;ordre inverse des octets, il commence donc par (hex) 18 et se termine par 79</p>
</li>
<li class="data-line-290">
<p>L&#8217;index de sortie est un groupe de z√©ros de 4 octets, facile √† identifier</p>
</li>
<li class="data-line-291">
<p>La longueur du scriptSig est de 139 octets, soit 8b en hexad√©cimal</p>
</li>
<li class="data-line-292">
<p>Le num√©ro de s√©quence est d√©fini sur FFFFFFFF, encore une fois facile √† identifier</p>
</li>
</ul>
</div>
<div class="paragraph data-line-294">
<p>ScriptSig est un type sp√©cifique de script de d√©verrouillage qui, lorsqu&#8217;il est s√©rialis√© pour √™tre transmis sur le r√©seau, les entr√©es sont cod√©es dans un flux d&#8217;octets, comme indiqu√© dans <a href="#scriptsig_in_structure">S√©rialisation des entr√©es ScriptSig</a>. La s√©rialisation du champ signature est d√©taill√©e dans <a href="#seralization_of_signatures_der">S√©rialisation des signatures (DER)</a>. Le champ de signature comprend √©galement un type de hachage de signature (SIGHASH), qui est d√©taill√© dans <a href="#sighash_types">Types de hachage de signature (SIGHASH)</a>.</p>
</div>
<table id="scriptsig_in_structure" class="tableblock frame-all grid-all stretch data-line-299">
<caption class="title">Table 3. S√©rialisation des entr√©es ScriptSig</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Taille</th>
<th class="tableblock halign-left valign-top">Champ</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1‚Äì9 octets (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taille signature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Longueur de la signature en octets √† suivre</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">signature</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Une signature produite par le portefeuille de l&#8217;utilisateur √† partir de sa cl√© priv√©e, qui comprend un SIGHASH</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1‚Äì9 octets (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taille de la cl√© publique</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Longueur de la cl√© publique en octets √† suivre</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cl√© publique</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La cl√© publique, non hach√©e</p></td>
</tr>
</tbody>
</table>
</div>
</div>
<div class="sect3 data-line-308">
<h4 id="tx_fees">Frais de transaction</h4>
<div class="paragraph data-line-310">
<p>La plupart des transactions incluent des frais de transaction, qui r√©mun√®rent les mineurs de bitcoins pour la s√©curisation du r√©seau. Les frais servent √©galement de m√©canisme de s√©curit√© eux-m√™mes, en rendant √©conomiquement impossible pour les attaquants d&#8217;inonder le r√©seau de transactions. L&#8217;exploitation mini√®re et les frais et r√©compenses per√ßus par les mineurs sont discut√©s plus en d√©tail dans <a href="#mining">[mining]</a>.</p>
</div>
<div class="paragraph data-line-312">
<p>Cette section examine comment les frais de transaction sont inclus dans une transaction typique. La plupart des portefeuilles calculent et incluent automatiquement les frais de transaction. Toutefois, si vous cr√©ez des transactions par programmation ou √† l&#8217;aide d&#8217;une interface de ligne de commande, vous devez comptabiliser et inclure manuellement ces frais.</p>
</div>
<div class="paragraph data-line-314">
<p>Les frais de transaction servent d&#8217;incitation √† inclure (exploiter) une transaction dans le bloc suivant et √©galement de dissuasion contre les abus du syst√®me en imposant un petit co√ªt sur chaque transaction. Les frais de transaction sont per√ßus par le mineur qui exploite le bloc qui enregistre la transaction sur la cha√Æne de blocs.</p>
</div>
<div class="paragraph data-line-316">
<p>Les frais de transaction sont calcul√©s en fonction de la taille de la transaction en kilo-octets, et non de la valeur de la transaction en bitcoin. Dans l&#8217;ensemble, les frais de transaction sont fix√©s en fonction des forces du march√© au sein du r√©seau Bitcoin. Les mineurs hi√©rarchisent les transactions en fonction de nombreux crit√®res diff√©rents, y compris les frais, et peuvent m√™me traiter les transactions gratuitement dans certaines circonstances. Les frais de transaction affectent la priorit√© de traitement, ce qui signifie qu&#8217;une transaction avec des frais suffisants est susceptible d&#8217;√™tre incluse dans le prochain bloc min√©, alors qu&#8217;une transaction avec des frais insuffisants ou nuls peut √™tre retard√©e, trait√©e au mieux apr√®s quelques blocs, ou pas trait√© du tout. Les frais de transaction ne sont pas obligatoires et les transactions sans frais peuvent √©ventuellement √™tre trait√©es¬†; cependant, l&#8217;inclusion des frais de transaction encourage le traitement prioritaire.</p>
</div>
<div class="paragraph data-line-318">
<p>Au fil du temps, la fa√ßon dont les frais de transaction sont calcul√©s et leur effet sur la hi√©rarchisation des transactions ont √©volu√©. Au d√©part, les frais de transaction √©taient fixes et constants sur l&#8217;ensemble du r√©seau. Progressivement, la structure tarifaire s&#8217;est assouplie et peut √™tre influenc√©e par les forces du march√©, en fonction de la capacit√© du r√©seau et du volume des transactions. Depuis au moins le d√©but de 2016, les limites de capacit√© en bitcoin ont cr√©√© une concurrence entre les transactions, entra√Ænant des frais plus √©lev√©s et faisant des transactions gratuites une chose du pass√©. Les transactions sans frais ou √† tr√®s faibles frais sont rarement min√©es et parfois ne seront m√™me pas propag√©es sur le r√©seau.</p>
</div>
<div class="paragraph data-line-320">
<p>Dans Bitcoin Core, les politiques de relais des frais sont d√©finies par l&#8217;option minrelaytxfee. Le minrelaytxfee par d√©faut actuel est de 0,00001 bitcoin ou un centi√®me de millibitcoin par kilooctet. Par cons√©quent, par d√©faut, les transactions dont les frais sont inf√©rieurs √† 0,00001 bitcoin sont trait√©es comme gratuites et ne sont relay√©es que s&#8217;il y a de la place dans le mempool ; sinon, ils sont supprim√©s. Les n≈ìuds Bitcoin peuvent remplacer la politique de relais de frais par d√©faut en ajustant la valeur de minrelaytxfee.</p>
</div>
<div class="paragraph data-line-322">
<p>Tout service bitcoin qui cr√©e des transactions, y compris les portefeuilles, les √©changes, les applications de vente au d√©tail, etc., <em>doit</em> impl√©menter des frais dynamiques. Les frais dynamiques peuvent √™tre mis en ≈ìuvre via un service tiers d&#8217;estimation des frais ou avec un algorithme d&#8217;estimation des frais int√©gr√©. Si vous n&#8217;√™tes pas s√ªr, commencez par un service tiers et, √† mesure que vous acqu√©rez de l&#8217;exp√©rience, concevez et impl√©mentez votre propre algorithme si vous souhaitez supprimer la d√©pendance tierce.</p>
</div>
<div class="paragraph data-line-324">
<p>Les algorithmes d&#8217;estimation des frais calculent les frais appropri√©s, en fonction de la capacit√© et des frais offerts par les transactions ¬´ concurrentes ¬ª. Ces algorithmes vont du simple (frais moyens ou m√©dians dans le dernier bloc) au sophistiqu√© (analyse statistique). Ils estiment les frais n√©cessaires (en satoshis par octet) qui donneront √† une transaction une forte probabilit√© d&#8217;√™tre s√©lectionn√©e et incluse dans un certain nombre de blocs. La plupart des services offrent aux utilisateurs la possibilit√© de choisir des frais de priorit√© √©lev√©s, moyens ou faibles. Une priorit√© √©lev√©e signifie que les utilisateurs paient des frais plus √©lev√©s, mais la transaction est susceptible d&#8217;√™tre incluse dans le bloc suivant. Une priorit√© moyenne et faible signifie que les utilisateurs paient des frais de transaction moins √©lev√©s, mais que la confirmation des transactions peut prendre beaucoup plus de temps.</p>
</div>
<div class="paragraph data-line-326">
<p>De nombreuses applications de portefeuille utilisent des services tiers pour le calcul des frais. Un service populaire est <a href="https://bitcoinfees.earn.com/" data-href="https://bitcoinfees.earn.com/"><em>https://bitcoinfees.earn.com/</em></a>, qui fournit une API et un graphique visuel montrant les frais en satoshi/octet pour diff√©rentes priorit√©s.</p>
</div>
<div class="admonitionblock tip data-line-329">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-330">
<p>Les frais statiques ne sont plus viables sur le r√©seau Bitcoin. Les portefeuilles qui fixent des frais statiques produiront une mauvaise exp√©rience utilisateur car les transactions seront souvent &quot;bloqu√©es&quot; et resteront non confirm√©es. Les utilisateurs qui ne comprennent pas les transactions et les frais en bitcoins sont constern√©s par les transactions &quot;bloqu√©es&quot; car ils pensent avoir perdu leur argent.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-333">
<p>Le graphique en <a href="#bitcoinfeesearncom">Service d&#8217;estimation des frais bitcoinfees.earn.com</a> affiche l&#8217;estimation en temps r√©el des frais par incr√©ments de 10 satoshi/octet et le temps de confirmation attendu (en minutes et en nombre de blocs) pour les transactions avec des frais dans chaque plage. Pour chaque fourchette de frais (par exemple, 61 √† 70¬†satoshi/octet), deux barres horizontales indiquent le nombre de transactions non confirm√©es (1¬†405) et le nombre total de transactions au cours des derni√®res 24¬†heures (102¬†975), avec des frais compris dans cette fourchette. Sur la base du graphique, les frais de haute priorit√© recommand√©s √† ce moment √©taient de 80 satoshi/octet, des frais susceptibles d&#8217;entra√Æner l&#8217;inclusion de la transaction dans le bloc suivant (d√©lai de bloc nul). Pour la perspective, la taille m√©diane des transactions est de 226 octets, donc les frais recommand√©s pour cette taille de transaction seraient de 18 080 satoshis (0,00018080 BTC).</p>
</div>
<div class="paragraph data-line-335">
<p>Les donn√©es d&#8217;estimation des frais peuvent √™tre r√©cup√©r√©es via une simple API HTTP REST, √† l&#8217;adresse <a href="https://bitcoinfees.earn.com/api/v1/fees/recommended" data-href="https://bitcoinfees.earn.com/api/v1/fees/recommended">https://bitcoinfees.earn.com/api/v1/fees/recommended </a>. Par exemple, sur la ligne de commande en utilisant la commande curl¬†:</p>
</div>
<div class="listingblock data-line-338">
<div class="title">Utilisation de l&#8217;API d&#8217;estimation des frais</div>
<div class="content">
<pre>$ curl https://bitcoinfees.earn.com/api/v1/fees/recommended

{"fastestFee":80,"halfHourFee":80,"hourFee":60}</pre>
</div>
</div>
<div class="paragraph data-line-344">
<p>L&#8217;API renvoie un objet JSON avec l&#8217;estimation actuelle des frais pour la confirmation la plus rapide (fastestFee), la confirmation dans les trois blocs (halfHourFee) et six blocs (hourFee), en satoshi par octet.</p>
</div>
<div id="bitcoinfeesearncom" class="imageblock data-line-348">
<div class="content">
<img src="images/mbc2_0602.png" alt="Service d&#8217;estimation des frais bitcoinfees.earn.com">
</div>
<div class="title">Figure 3. Service d&#8217;estimation des frais bitcoinfees.earn.com</div>
</div>
</div>
<div class="sect3 data-line-350">
<h4 id="_ajout_de_frais_aux_transactions">Ajout de frais aux transactions</h4>
<div class="paragraph data-line-352">
<p>La structure de donn√©es des transactions n&#8217;a pas de champ pour les frais. Au lieu de cela, les frais sont implicites comme la diff√©rence entre la somme des entr√©es et la somme des sorties. Tout montant exc√©dentaire qui reste apr√®s que toutes les sorties ont √©t√© d√©duites de toutes les entr√©es est la redevance per√ßue par les mineurs¬†:</p>
</div>
<div id="tx_fee_equation" class="listingblock data-line-356">
<div class="title">Les frais de transaction sont implicites, comme l&#8217;exc√©dent des intrants moins les extrants¬†:</div>
<div class="content">
<pre>Frais = Somme(intrants) - Somme(extrants)</pre>
</div>
</div>
<div class="paragraph data-line-360">
<p>Il s&#8217;agit d&#8217;un √©l√©ment quelque peu d√©routant des transactions et d&#8217;un point important √† comprendre, car si vous construisez vos propres transactions, vous devez vous assurer de ne pas inclure par inadvertance des frais tr√®s importants en sous-d√©pensant les intrants. Cela signifie que vous devez comptabiliser toutes les entr√©es, si n√©cessaire en cr√©ant du change, ou vous finirez par donner un tr√®s gros pourboire aux mineurs¬†!</p>
</div>
<div class="paragraph data-line-362">
<p>Par exemple, si vous consommez un UTXO de 20¬†bitcoins pour effectuer un paiement de 1¬†bitcoin, vous devez inclure une sortie de modification de 19¬†bitcoins dans votre portefeuille. Sinon, le &quot;reste&quot; de 19 bitcoins sera compt√© comme des frais de transaction et sera collect√© par le mineur qui exploite votre transaction dans un bloc. Bien que vous receviez un traitement prioritaire et rendiez un mineur tr√®s heureux, ce n&#8217;est probablement pas ce que vous vouliez.</p>
</div>
<div class="admonitionblock warning data-line-365">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-366">
<p> Si vous oubliez d&#8217;ajouter une sortie de modification dans une transaction construite manuellement, vous paierez la modification en tant que frais de transaction. Dire &quot;Gardez la monnaie¬†!&quot; au mineur n&#8217;est peut-√™tre pas ce que vous vouliez vraiment.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-369">
<p> Voyons comment cela fonctionne en pratique, en examinant √† nouveau l&#8217;achat de caf√© d&#8217;Alice. Alice veut d√©penser 0,015 bitcoin pour payer son caf√©. Pour s&#8217;assurer que cette transaction est trait√©e rapidement, elle voudra inclure des frais de transaction, disons 0,0005. Cela signifie que le co√ªt total de la transaction sera de 0,0155. Son portefeuille doit donc se procurer un ensemble d&#8217;UTXO qui totalise 0,0155 bitcoin ou plus et, si n√©cessaire, cr√©er de la monnaie. Disons que son portefeuille dispose d&#8217;un UTXO de 0,1 bitcoin. Elle devra donc consommer cet UTXO, cr√©er une sortie pour le comptoir √† caf√© de Bob pour 0,015, et une seconde sortie avec 0,0845 bitcoin en retour vers son propre portefeuille, laissant 0,0005 bitcoin non allou√©, comme frais implicites pour la transaction.</p>
</div>
<div class="paragraph data-line-371">
<p>Regardons maintenant un sc√©nario diff√©rent. Eugenia, directrice de notre association caritative pour enfants aux Philippines, a organis√© une collecte de fonds pour acheter des manuels scolaires pour les enfants. Elle a re√ßu plusieurs milliers de petits dons de personnes du monde entier, totalisant 50 bitcoins, donc son portefeuille est plein de tr√®s petits paiements (UTXO). Maintenant, elle veut acheter des centaines de manuels scolaires aupr√®s d&#8217;un √©diteur local, en payant en bitcoins.</p>
</div>
<div class="paragraph data-line-373">
<p>Alors que l&#8217;application de portefeuille d&#8217;Eugenia tente de construire une seule transaction de paiement plus importante, elle doit s&#8217;approvisionner √† partir de l&#8217;ensemble UTXO disponible, qui est compos√© de nombreux montants plus petits. Cela signifie que la transaction r√©sultante proviendra de plus d&#8217;une centaine d&#8217;UTXO de petite valeur en tant qu&#8217;entr√©es et d&#8217;une seule sortie, payant l&#8217;√©diteur du livre. Une transaction avec autant d&#8217;entr√©es sera sup√©rieure √† un kilo-octet, peut-√™tre plusieurs kilo-octets. En cons√©quence, cela n√©cessitera des frais beaucoup plus √©lev√©s que la transaction de taille m√©diane.</p>
</div>
<div class="paragraph data-line-375">
<p>L&#8217;application de portefeuille d&#8217;Eugenia calculera les frais appropri√©s en mesurant la taille de la transaction et en la multipliant par les frais par kilo-octet. De nombreux portefeuilles surpayeront les frais pour les transactions plus importantes afin de s&#8217;assurer que la transaction est trait√©e rapidement. Les frais plus √©lev√©s ne sont pas dus au fait qu&#8217;Eugenia d√©pense plus d&#8217;argent, mais au fait que sa transaction est plus complexe et plus volumineuse - les frais sont ind√©pendants de la valeur en bitcoins de la transaction.</p>
</div>
</div>
</div>
<div class="sect2 pagebreak-before less_space_h1 data-line-379">
<h3 id="tx_script">Scripts de transaction et langage de script</h3>
<div class="paragraph data-line-381">
<p>Le langage de script de transaction bitcoin, appel√© <em>Script</em> , est un langage d&#8217;ex√©cution bas√© sur une pile de notation polonaise invers√©e (RPN) de type Forth. Si cela ressemble √† du charabia, vous n&#8217;avez probablement pas √©tudi√© les langages de programmation des ann√©es 1960, mais ce n&#8217;est pas grave, nous vous expliquerons tout dans ce chapitre. Le script de verrouillage plac√© sur un UTXO et le script de d√©verrouillage sont √©crits dans ce langage de script. Lorsqu&#8217;une transaction est valid√©e, le script de d√©verrouillage de chaque entr√©e est ex√©cut√© parall√®lement au script de verrouillage correspondant pour voir s&#8217;il satisfait √† la condition de d√©pense.</p>
</div>
<div class="paragraph data-line-383">
<p>Script est un langage tr√®s simple qui a √©t√© con√ßu pour √™tre limit√© dans sa port√©e et √™tre ex√©cutable sur une gamme de mat√©riel et peut √™tre aussi simple qu&#8217;un p√©riph√©rique int√©gr√©. Il n√©cessite un traitement minimal et ne peut pas faire la plupart des choses fantaisistes que les langages de programmation modernes peuvent faire. Pour son utilisation dans la validation de monnaie programmable, il s&#8217;agit d&#8217;une fonction de s√©curit√© d√©lib√©r√©e.</p>
</div>
<div class="paragraph data-line-385">
<p>Aujourd&#8217;hui, la plupart des transactions trait√©es via le r√©seau Bitcoin ont la forme &quot;Paiement √† l&#8217;adresse Bitcoin de Bob&quot; et sont bas√©es sur un script appel√© Pay-to-Script Public-Key-Hash. Cependant, les transactions bitcoin ne se limitent pas au script &quot;Paiement √† l&#8217;adresse Bitcoin de Bob&quot;. En fait, les scripts de verrouillage peuvent √™tre √©crits pour exprimer une grande vari√©t√© de conditions complexes. Afin de comprendre ces scripts plus complexes, nous devons d&#8217;abord comprendre les bases des scripts de transaction et du langage de script.</p>
</div>
<div class="paragraph data-line-387">
<p>Dans cette section, nous d√©montrerons les composants de base du langage de script de transaction bitcoin et montrerons comment il peut √™tre utilis√© pour exprimer des conditions simples de d√©penses et comment ces conditions peuvent √™tre satisfaites en d√©verrouillant des scripts.</p>
</div>
<div class="admonitionblock tip data-line-390">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-391">
<p>La validation des transactions Bitcoin n&#8217;est pas bas√©e sur un mod√®le statique, mais est plut√¥t obtenue gr√¢ce √† l&#8217;ex√©cution d&#8217;un langage de script. Ce langage permet d&#8217;exprimer une vari√©t√© presque infinie de conditions. C&#8217;est ainsi que le bitcoin obtient le pouvoir de &quot;l&#8217;argent programmable&quot;.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="sect3 data-line-395">
<h4 id="_incompl√©tude_de_turing">Incompl√©tude de Turing</h4>
<div class="paragraph data-line-397">
<p>Le langage de script de transaction bitcoin contient de nombreux op√©rateurs, mais est d√©lib√©r√©ment limit√© d&#8217;une mani√®re importante¬†: il n&#8217;y a pas de boucles ou de capacit√©s de contr√¥le de flux complexes autres que le contr√¥le de flux conditionnel. Cela garantit que le langage n&#8217;est pas <em>Turing complet</em>, ce qui signifie que les scripts ont une complexit√© limit√©e et des temps d&#8217;ex√©cution pr√©visibles. Le script n&#8217;est pas un langage universel. Ces limitations garantissent que le langage ne peut pas √™tre utilis√© pour cr√©er une boucle infinie ou une autre forme de &quot;bombe logique&quot; qui pourrait √™tre int√©gr√©e dans une transaction de mani√®re √† provoquer une attaque par d√©ni de service contre le r√©seau Bitcoin. N&#8217;oubliez pas que chaque transaction est valid√©e par chaque n≈ìud complet du r√©seau Bitcoin. Un langage limit√© emp√™che le m√©canisme de validation des transactions d&#8217;√™tre utilis√© comme une vuln√©rabilit√©.</p>
</div>
</div>
<div class="sect3 data-line-399">
<h4 id="_v√©rification_sans_√©tat">V√©rification sans √©tat</h4>
<div class="paragraph data-line-401">
<p>Le langage de script de transaction bitcoin est sans √©tat, en ce sens qu&#8217;il n&#8217;y a pas d&#8217;√©tat avant l&#8217;ex√©cution du script, ou d&#8217;√©tat enregistr√© apr√®s l&#8217;ex√©cution du script. Par cons√©quent, toutes les informations n√©cessaires √† l&#8217;ex√©cution d&#8217;un script sont contenues dans le script. Un script s&#8217;ex√©cutera de mani√®re pr√©visible de la m√™me mani√®re sur n&#8217;importe quel syst√®me. Si votre syst√®me v√©rifie un script, vous pouvez √™tre s√ªr que tous les autres syst√®mes du r√©seau Bitcoin v√©rifieront √©galement le script, ce qui signifie qu&#8217;une transaction valide est valide pour tout le monde et tout le monde le sait. Cette pr√©visibilit√© des r√©sultats est un avantage essentiel du syst√®me Bitcoin.</p>
</div>
</div>
<div class="sect3 data-line-404">
<h4 id="tx_lock_unlock">Construction du script (Verrouiller + D√©verrouiller)</h4>
<div class="paragraph data-line-406">
<p>Le moteur de validation des transactions de Bitcoin s&#8217;appuie sur deux types de scripts pour valider les transactions : un script de verrouillage et un script de d√©verrouillage.</p>
</div>
<div class="paragraph data-line-408">
<p>Un script de verrouillage est une condition de d√©pense plac√©e sur une sortie¬†: il sp√©cifie les conditions qui doivent √™tre remplies pour d√©penser la production √† l&#8217;avenir. Historiquement, le script de verrouillage √©tait appel√© <em>scriptPubKey</em>, car il contenait g√©n√©ralement une cl√© publique ou une adresse Bitcoin (hachage de cl√© publique). Dans ce livre, nous l&#8217;appelons un &quot;script de verrouillage&quot; pour reconna√Ætre l&#8217;√©ventail de possibilit√©s beaucoup plus large de cette technologie de script. Dans la plupart des applications bitcoin, ce que nous appelons un script de verrouillage appara√Ætra dans le code source sous la forme scriptPubKey. Vous verrez √©galement le script de verrouillage appel√© <em>script de t√©moin</em> (voir <a href="#segwit">[segwit]</a>) ou plus g√©n√©ralement comme un <em>casse-t√™te cryptographique</em>. Ces termes signifient tous la m√™me chose, √† diff√©rents niveaux d&#8217;abstraction.</p>
</div>
<div class="paragraph data-line-410">
<p>Un script de d√©verrouillage est un script qui ¬´ r√©sout ¬ª, ou satisfait, les conditions plac√©es sur une sortie par un script de verrouillage et permet √† la sortie d&#8217;√™tre d√©pens√©e. Les scripts de d√©verrouillage font partie de chaque entr√©e de transaction. Ils contiennent la plupart du temps une signature num√©rique produite par le portefeuille de l&#8217;utilisateur √† partir de sa cl√© priv√©e. Historiquement, le script de d√©verrouillage s&#8217;appelait <em>scriptSig</em>, car il contenait g√©n√©ralement une signature num√©rique. Dans la plupart des applications bitcoin, le code source fait r√©f√©rence au script de d√©verrouillage sous la forme scriptSig. Vous verrez √©galement le script de d√©verrouillage appel√© <em>t√©moin</em> (voir <a href="#segwit">[segwit]</a>). Dans ce livre, nous l&#8217;appelons un &quot;script de d√©verrouillage&quot; pour reconna√Ætre la gamme beaucoup plus large d&#8217;exigences de script de verrouillage, car ce n&#8217;est pas tous les scripts de d√©verrouillage qui doivent contenir des signatures.</p>
</div>
<div class="paragraph data-line-412">
<p>Chaque n≈ìud de validation Bitcoin validera les transactions en ex√©cutant les scripts de verrouillage et de d√©verrouillage ensemble. Chaque entr√©e contient un script de d√©verrouillage et fait r√©f√©rence √† un UTXO existant pr√©c√©demment. Le logiciel de validation copiera le script de d√©verrouillage, r√©cup√©rera l&#8217;UTXO r√©f√©renc√© par l&#8217;entr√©e et copiera le script de verrouillage √† partir de cet UTXO. Les scripts de d√©verrouillage et de verrouillage sont ensuite ex√©cut√©s en s√©quence. L&#8217;entr√©e est valide si le script de d√©verrouillage satisfait les conditions du script de verrouillage (voir <a href="#script_exec">Ex√©cution s√©par√©e des scripts de d√©verrouillage et de verrouillage</a>). Toutes les entr√©es sont valid√©es ind√©pendamment, dans le cadre de la validation globale de la transaction.</p>
</div>
<div class="paragraph data-line-414">
<p>Notez que l&#8217;UTXO est enregistr√© en permanence dans la blockchain, et est donc invariable et n&#8217;est pas affect√© par les tentatives infructueuses de le d√©penser par r√©f√©rence dans une nouvelle transaction. Seule une transaction valide qui satisfait correctement les conditions de la sortie entra√Æne que la sortie est consid√©r√©e comme &quot;d√©pens√©e&quot; et retir√©e de l&#8217;ensemble des sorties de transaction non d√©pens√©es (ensemble UTXO).</p>
</div>
<div class="paragraph data-line-416">
<p><a href="#scriptSig_and_scriptPubKey">Combiner scriptSig et scriptPubKey pour √©valuer un script de transaction</a> est un exemple des scripts de d√©verrouillage et de verrouillage pour le type de transaction bitcoin le plus courant (un paiement √† un hachage de cl√© publique), montrant le script combin√© r√©sultant de la concat√©nation des scripts de d√©verrouillage et de verrouillage avant la validation du script.</p>
</div>
<div id="scriptSig_and_scriptPubKey" class="imageblock data-line-420">
<div class="content">
<img src="images/mbc2_0603.png" alt="&quot;scriptSig_and_scriptPubKey&quot;">
</div>
<div class="title">Figure 4. Combiner scriptSig et scriptPubKey pour √©valuer un script de transaction</div>
</div>
<div class="sect4 data-line-422">
<h5 id="_la_pile_dex√©cution_de_script">La pile d&#8217;ex√©cution de script</h5>
<div class="paragraph data-line-424">
<p>Le langage de script de Bitcoin est appel√© un langage bas√© sur la pile car il utilise une structure de donn√©es appel√©e <em>pile</em>. Une pile est une structure de donn√©es tr√®s simple qui peut √™tre visualis√©e comme une pile de cartes. Une pile permet deux op√©rations : push et pop. Push ajoute un √©l√©ment au sommet de la pile. Pop supprime l&#8217;√©l√©ment du haut de la pile. Les op√©rations sur une pile ne peuvent agir que sur l&#8217;√©l√©ment le plus haut de la pile. Une structure de donn√©es de pile est √©galement appel√©e file d&#8217;attente Last-In-First-Out (dernier entr√©, premier sorti), ou &quot;LIFO&quot;.</p>
</div>
<div class="paragraph data-line-426">
<p>Le langage de script ex√©cute le script en traitant chaque √©l√©ment de gauche √† droite. Les nombres (constantes de donn√©es) sont pouss√©s sur la pile. Les op√©rateurs poussent ou sortent un ou plusieurs param√®tres de la pile, agissent sur eux et peuvent pousser un r√©sultat sur la pile. Par exemple, OP_ADD fera sortir deux √©l√©ments de la pile, les ajoutera et poussera la somme r√©sultante sur la pile.</p>
</div>
<div class="paragraph data-line-428">
<p>Les op√©rateurs conditionnels √©valuent une condition, produisant un r√©sultat bool√©en VRAI (TRUE) ou FAUX (FALSE). Par exemple, OP_EQUAL d√©pile deux √©l√©ments de la pile et pousse TRUE (TRUE est repr√©sent√© par le nombre 1) s&#8217;ils sont √©gaux ou FALSE (repr√©sent√© par z√©ro) s&#8217;ils ne sont pas √©gaux. Les scripts de transaction Bitcoin contiennent g√©n√©ralement un op√©rateur conditionnel, afin qu&#8217;ils puissent produire le r√©sultat TRUE qui signifie une transaction valide.</p>
</div>
</div>
<div class="sect4 data-line-430">
<h5 id="_un_script_simple">Un script simple</h5>
<div class="paragraph data-line-432">
<p>Appliquons maintenant ce que nous avons appris sur les scripts et les piles √† quelques exemples simples.</p>
</div>
<div class="paragraph data-line-434">
<p>Dans <a href="#simplemath_script">La validation du script Bitcoin en calculs simples</a>, le script 2 3 OP_ADD 5 OP_EQUAL d√©montre l&#8217;op√©rateur d&#8217;addition arithm√©tique OP_ADD, additionnant deux nombres et mettant le r√©sultat sur la pile, suivi de l&#8217;op√©rateur conditionnel OP_EQUAL, qui v√©rifie que la somme r√©sultante est √©gale √† 5. Par souci de bri√®vet√©, le pr√©fixe OP_ est omis dans l&#8217;exemple √©tape par √©tape. Pour plus de d√©tails sur les op√©rateurs de script et les fonctions disponibles, voir <a href="#tx_script_ops">[tx_script_ops]</a>.</p>
</div>
<div class="paragraph data-line-436">
<p>Bien que la plupart des scripts de verrouillage se r√©f√®rent √† un hachage de cl√© publique (essentiellement, une adresse Bitcoin), n√©cessitant ainsi une preuve de propri√©t√© pour d√©penser les fonds, le script n&#8217;a pas besoin d&#8217;√™tre aussi complexe. Toute combinaison de scripts de verrouillage et de d√©verrouillage donnant une valeur TRUE est valide. L&#8217;arithm√©tique simple que nous avons utilis√©e comme exemple de langage de script est √©galement un script de verrouillage valide qui peut √™tre utilis√© pour verrouiller une sortie de transaction.</p>
</div>
<div class="paragraph data-line-438">
<p>Utilisez une partie de l&#8217;exemple de script arithm√©tique comme script de verrouillage¬†:</p>
</div>
<div class="listingblock data-line-440">
<div class="content">
<pre>3 OP_ADD 5 OP_EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-444">
<p>qui peut √™tre satisfaite par une transaction contenant une entr√©e avec le script de d√©verrouillage¬†:</p>
</div>
<div class="listingblock data-line-446">
<div class="content">
<pre>2</pre>
</div>
</div>
<div class="paragraph data-line-450">
<p>Le logiciel de validation combine les scripts de verrouillage et de d√©verrouillage et le script r√©sultant est¬†:</p>
</div>
<div class="listingblock data-line-452">
<div class="content">
<pre>2 3 OP_ADD 5 OP_EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-456">
<p>Comme nous l&#8217;avons vu dans l&#8217;exemple √©tape par √©tape dans <a href="#simplemath_script">La validation du script Bitcoin en calculs simples</a>, lorsque ce script est ex√©cut√©, le r√©sultat est OP_TRUE, rendant la transaction valide. Non seulement il s&#8217;agit d&#8217;un script de verrouillage de sortie de transaction valide, mais l&#8217;UTXO r√©sultant pourrait √™tre d√©pens√© par toute personne ayant les comp√©tences en arithm√©tique pour savoir que le nombre 2 satisfait le script.</p>
</div>
<div class="admonitionblock tip data-line-459">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-460">
<p>Les transactions sont valides si le premier r√©sultat de la pile est TRUE (not√© {0x01}), toute autre valeur diff√©rente de z√©ro, autre que OP_0, ou si la pile est vide apr√®s l&#8217;ex√©cution du script. Les transactions ne sont pas valides si la valeur sup√©rieure de la pile est FALSE (une valeur vide de longueur nulle, not√©e {}) ou si l&#8217;ex√©cution du script est arr√™t√©e explicitement par un op√©rateur, tel que OP_VERIFY, OP_RETURN ou un terminateur conditionnel tel que OP_ENDIF. Voir <a href="#tx_script_ops">[tx_script_ops]</a> pour plus de d√©tails.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="simplemath_script" class="imageblock data-line-465">
<div class="content">
<img src="images/mbc2_0604.png" alt="&quot;TxScriptSimpleMathExample&quot;">
</div>
<div class="title">Figure 5. La validation du script Bitcoin en calculs simples</div>
</div>
<div class="paragraph pagebreak-before data-line-468">
<p>Ce qui suit est un script l√©g√®rement plus complexe, qui calcule 2 + 7 - 3 + 1. Notez que lorsque le script contient plusieurs op√©rateurs √† la suite, la pile permet aux r√©sultats d&#8217;un op√©rateur d&#8217;√™tre appliqu√©s par l&#8217;op√©rateur suivant¬†:</p>
</div>
<div class="listingblock data-line-470">
<div class="content">
<pre>2 7 OP_ADD 3 OP_SUB 1 OP_ADD 7 OP_EQUAL</pre>
</div>
</div>
<div class="paragraph data-line-474">
<p>Essayez de valider vous-m√™me le script pr√©c√©dent √† l&#8217;aide d&#8217;un crayon et de papier. Lorsque l&#8217;ex√©cution du script se termine, vous devriez vous retrouver avec la valeur TRUE sur la pile.</p>
</div>
</div>
<div class="sect4 data-line-477">
<h5 id="script_exec">Ex√©cution s√©par√©e des scripts de d√©verrouillage et de verrouillage</h5>
<div class="paragraph data-line-479">
<p>Dans le client Bitcoin d&#8217;origine, les scripts de d√©verrouillage et de verrouillage √©taient concat√©n√©s et ex√©cut√©s en s√©quence. Pour des raisons de s√©curit√©, cela a √©t√© modifi√© en 2010, en raison d&#8217;une vuln√©rabilit√© qui permettait √† un script de d√©verrouillage malform√© de pousser des donn√©es sur la pile et de corrompre le script de verrouillage. Dans l&#8217;impl√©mentation actuelle, les scripts sont ex√©cut√©s s√©par√©ment avec la pile transf√©r√©e entre les deux ex√©cutions, comme d√©crit ci-apr√®s.</p>
</div>
<div class="paragraph data-line-481">
<p>Tout d&#8217;abord, le script de d√©verrouillage est ex√©cut√© √† l&#8217;aide du moteur d&#8217;ex√©cution de la pile. Si le script de d√©verrouillage est ex√©cut√© sans erreur (par exemple, s&#8217;il ne reste plus de pointeurs &quot; pendants&quot;), la pile principale est copi√©e et le script de verrouillage est ex√©cut√©. Si le r√©sultat de l&#8217;ex√©cution du script de verrouillage avec les donn√©es de la pile copi√©es √† partir du script de d√©verrouillage est &quot;TRUE&quot;, le script de d√©verrouillage a r√©ussi √† r√©soudre les conditions impos√©es par le script de verrouillage et, par cons√©quent, l&#8217;entr√©e est une autorisation valide de d√©penser l&#8217;UTXO. S&#8217;il reste un r√©sultat autre que &quot;TRUE&quot; apr√®s l&#8217;ex√©cution du script combin√©, l&#8217;entr√©e est invalide car elle n&#8217;a pas satisfait aux conditions de d√©penses plac√©es sur l&#8217;UTXO.</p>
</div>
</div>
</div>
<div class="sect3 data-line-485">
<h4 id="p2pkh">Pay-to-Public-Key-Hash (P2PKH)</h4>
<div class="paragraph data-line-487">
<p>La grande majorit√© des transactions trait√©es sur le r√©seau Bitcoin d√©pensent des sorties verrouill√©es avec un script Pay-to-Public-Key-Hash ou &quot;P2PKH&quot;. Ces sorties contiennent un script de verrouillage qui verrouille la sortie sur un hachage de cl√© publique, plus commun√©ment appel√© adresse Bitcoin. Une sortie verrouill√©e par un script P2PKH peut √™tre d√©verrouill√©e (pass√©e) en pr√©sentant une cl√© publique et une signature num√©rique cr√©√©e par la cl√© priv√©e correspondante (voir <a href="#digital_sigs">Signatures num√©riques (ECDSA)</a>).</p>
</div>
<div class="paragraph data-line-489">
<p>Par exemple, regardons √† nouveau le paiement d&#8217;Alice au comptoir √† caf√© de Bob. Alice a effectu√© un paiement de 0,015 bitcoin √† l&#8217;adresse Bitcoin du comptoir. Cette sortie de transaction aurait un script de verrouillage de la forme¬†:</p>
</div>
<div class="listingblock data-line-491">
<div class="content">
<pre>OP_DUP OP_HASH160 &lt;Cafe Public Key Hash&gt; OP_EQUALVERIFY OP_CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-495">
<p>Le Cafe Public Key Hash √©quivaut √† l&#8217;adresse Bitcoin du caf√©, sans l&#8217;encodage Base58Check. La plupart des applications afficheraient le <em>hachage de la cl√© publique</em> en codage hexad√©cimal et non le format familier de l&#8217;adresse Bitcoin Base58Check qui commence par un &quot;1&quot;.</p>
</div>
<div class="paragraph data-line-497">
<p>Le script de verrouillage pr√©c√©dent peut se contenter d&#8217;un script de d√©verrouillage de la forme :</p>
</div>
<div class="listingblock data-line-499">
<div class="content">
<pre>&lt;Cafe Signature&gt; &lt;Cafe Public Key&gt;</pre>
</div>
</div>
<div class="paragraph data-line-503">
<p>Les deux scripts ensemble formeraient le script de validation combin√© suivant¬†:</p>
</div>
<div class="listingblock data-line-505">
<div class="content">
<pre>&lt;Cafe Signature&gt; &lt;Cafe Public Key&gt; OP_DUP OP_HASH160
&lt;Cafe Public Key Hash&gt; OP_EQUALVERIFY OP_CHECKSIG</pre>
</div>
</div>
<div class="paragraph data-line-510">
<p>Lorsqu&#8217;il est ex√©cut√©, ce script combin√© sera √©valu√© √† TRUE si, et seulement si, le script de d√©verrouillage correspond aux conditions d√©finies par le script de verrouillage. En d&#8217;autres termes, le r√©sultat sera VRAI si le script de d√©verrouillage a une signature valide de la cl√© priv√©e du comptoir qui correspond au hachage de la cl√© publique d√©fini comme encombrement.</p>
</div>
<div class="paragraph data-line-512">
<p>Les figures <a data-type="xref" href="#P2PubKHash1" data-xrefstyle="select: labelnumber">#P2PubKHash1</a> et <a data-type="xref" href="#P2PubKHash2" data-xrefstyle="select: labelnumber">#P2PubKHash2</a> montrent (en deux parties) une ex√©cution pas √† pas du script combin√©, qui prouvera qu&#8217;il s&#8217;agit d&#8217;une transaction valide.</p>
</div>
<div id="P2PubKHash1" class="imageblock data-line-516">
<div class="content">
<img src="images/mbc2_0605.png" alt="Tx_Script_P2PubKeyHash_1">
</div>
<div class="title">Figure 6. √âvaluer un script pour une transaction P2PKH (partie 1 sur 2)</div>
</div>
<div id="P2PubKHash2" class="imageblock data-line-520">
<div class="content">
<img src="images/mbc2_0606.png" alt="Tx_Script_P2PubKeyHash_2">
</div>
<div class="title">Figure 7. √âvaluer un script pour une transaction P2PKH (partie 2 sur 2)</div>
</div>
</div>
</div>
<div class="sect2 data-line-523">
<h3 id="digital_sigs">Signatures num√©riques (ECDSA)</h3>
<div class="paragraph data-line-525">
<p>Jusqu&#8217;√† pr√©sent, nous n&#8217;avons approfondi aucun d√©tail sur les &quot;signatures num√©riques&quot;. Dans cette section, nous examinons le fonctionnement des signatures num√©riques et comment elles peuvent pr√©senter la preuve de la propri√©t√© d&#8217;une cl√© priv√©e sans r√©v√©ler cette cl√© priv√©e.</p>
</div>
<div class="paragraph data-line-527">
<p>L&#8217;algorithme de signature num√©rique utilis√© dans le bitcoin est l'<em>Elliptic Curve Digital Signature Algorithm</em>, ou <em>ECDSA</em>. ECDSA est l&#8217;algorithme utilis√© pour les signatures num√©riques bas√©es sur des paires de cl√©s priv√©es/publiques √† courbe elliptique, comme d√©crit dans <a href="#elliptic_curve">[elliptic_curve]</a>. ECDSA est utilis√© par les fonctions de script OP_CHECKSIG, OP_CHECKSIGVERIFY, OP_CHECKMULTISIG et OP_CHECKMULTISIGVERIFY. Chaque fois que vous les voyez dans un script de verrouillage, le script de d√©verrouillage doit contenir une signature ECDSA.</p>
</div>
<div class="paragraph data-line-529">
<p> Une signature num√©rique a trois objectifs en bitcoin. Premi√®rement, la signature prouve que le propri√©taire de la cl√© priv√©e, qui est implicitement le propri√©taire des fonds, a <em>autoris√©</em> la d√©pense de ces fonds. Deuxi√®mement, la preuve de l&#8217;autorisation est <em>ind√©niable</em> (non-r√©pudiable). Troisi√®mement, la signature prouve que la transaction (ou des parties sp√©cifiques de la transaction) n&#8217;a pas et <em>ne peut pas √™tre modifi√©e</em> par qui que ce soit apr√®s avoir √©t√© sign√©e.</p>
</div>
<div class="paragraph data-line-531">
<p>Notez que chaque entr√©e de transaction est sign√©e ind√©pendamment. Ceci est essentiel, car ni les signatures ni les entr√©es ne doivent appartenir ou √™tre appliqu√©es par les m√™mes &quot;propri√©taires&quot;. En fait, un sch√©ma de transaction sp√©cifique appel√© &quot;CoinJoin&quot; utilise ce fait pour cr√©er des transactions multipartites pour la confidentialit√©.</p>
</div>
<div class="admonitionblock note data-line-534">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-535">
<p>Chaque entr√©e de transaction et toute signature qu&#8217;elle peut contenir est <em>compl√®tement</em> ind√©pendante de toute autre entr√©e ou signature. Plusieurs parties peuvent collaborer pour construire des transactions et signer une seule entr√©e chacune.</p>
</div>
</td>
</tr>
</table>
</div>
<div id="digital_signature_definition" class="sidebarblock data-line-540">
<div class="content">
<div class="title">D√©finition de Wikipedia d&#8217;une &quot;signature num√©rique&quot;</div>
<div class="paragraph data-line-541">
<p>Une signature num√©rique est un sch√©ma math√©matique permettant de d√©montrer l&#8217;authenticit√© d&#8217;un message ou de documents num√©riques. Une signature num√©rique valide donne au destinataire des raisons de croire que le message a √©t√© cr√©√© par un exp√©diteur connu (authentification), que l&#8217;exp√©diteur ne peut pas nier avoir envoy√© le message (non-r√©pudiable) et que le message n&#8217;a pas √©t√© alt√©r√© en transit (int√©grit√©).</p>
</div>
<div class="paragraph data-line-543">
<p><em>Source: <a href="https://en.wikipedia.org/wiki/Digital_signature" class="undefined" data-href="https://en.wikipedia.org/wiki/Digital_signature">https://en.wikipedia.org/wiki/Digital_signature</a></em></p>
</div>
</div>
</div>
<div class="sect3 data-line-546">
<h4 id="_comment_fonctionnent_les_signatures_num√©riques">Comment fonctionnent les signatures num√©riques</h4>
<div class="paragraph data-line-548">
<p>Une signature num√©rique est un <em>sch√©ma math√©matique</em> qui se compose de deux parties. La premi√®re partie est un algorithme de cr√©ation d&#8217;une signature, √† l&#8217;aide d&#8217;une cl√© priv√©e (la cl√© de signature), √† partir d&#8217;un message (la transaction). La deuxi√®me partie est un algorithme qui permet √† quiconque de v√©rifier la signature, √©tant donn√© √©galement le message et une cl√© publique.</p>
</div>
<div class="sect4 data-line-550">
<h5 id="_cr√©ation_dune_signature_num√©rique">Cr√©ation d&#8217;une signature num√©rique</h5>
<div class="paragraph data-line-552">
<p>Dans l&#8217;impl√©mentation de l&#8217;algorithme ECDSA par bitcoin, le &quot;message&quot; sign√© est la transaction, ou plus pr√©cis√©ment un hachage d&#8217;un sous-ensemble sp√©cifique des donn√©es de la transaction (voir <a href="#sighash_types">Types de hachage de signature (SIGHASH)</a>). La cl√© de signature est la cl√© priv√©e de l&#8217;utilisateur. Le r√©sultat est la signature :</p>
</div>
<div class="paragraph data-line-554">
<p>\(\(Sig = F_{sig}(F_{hash}(m), dA)\)\)</p>
</div>
<div class="paragraph data-line-556">
<p>o√π:</p>
</div>
<div class="ulist data-line-558">
<ul>
<li class="data-line-558">
<p><em>dA</em> est la cl√© priv√©e de signature</p>
</li>
<li class="data-line-559">
<p><em>m</em> est la transaction (ou une partie de celle-ci)</p>
</li>
<li class="data-line-560">
<p><em>F</em><sub><em>hash</em></sub> est la fonction de hachage</p>
</li>
<li class="data-line-561">
<p><em>F</em><sub><em>sig</em></sub> est l&#8217;algorithme de signature</p>
</li>
<li class="data-line-562">
<p><em>Sig</em> est la signature r√©sultante</p>
</li>
</ul>
</div>
<div class="paragraph data-line-564">
<p>Plus de d√©tails sur les math√©matiques d&#8217;ECDSA peuvent √™tre trouv√©s dans <a href="#ecdsa_math">Math√©matiques ECDSA</a>.</p>
</div>
<div class="paragraph data-line-566">
<p>La fonction <em>F</em><sub><em>sig</em></sub> produit une signature Sig compos√©e de deux valeurs, commun√©ment appel√©es R et S¬†:</p>
</div>
<div class="listingblock data-line-568">
<div class="content">
<pre>Sig = (R, S)</pre>
</div>
</div>
<div class="paragraph data-line-572">
<p> Maintenant que les deux valeurs R et S ont √©t√© calcul√©es, elles sont s√©rialis√©es en un flux d&#8217;octets √† l&#8217;aide d&#8217;un sch√©ma de codage standard international appel√© <em>Distinguished Encoding Rules</em>, ou <em>DER</em> (ou r√®gles d&#8217;encodage distingu√©s).</p>
</div>
</div>
<div class="sect4 data-line-575">
<h5 id="seralization_of_signatures_der">S√©rialisation des signatures (DER)</h5>
<div class="paragraph data-line-577">
<p>Regardons la transaction Alice cr√©√©e √† nouveau. Dans l&#8217;entr√©e de transaction, il y a un script de d√©verrouillage qui contient la signature encod√©e DER suivante du portefeuille d&#8217;Alice¬†:</p>
</div>
<div class="listingblock data-line-579">
<div class="content">
<pre>3045022100884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb02204b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e38133</pre>
</div>
</div>
<div class="paragraph data-line-583">
<p>Cette signature est un flux d&#8217;octets s√©rialis√© des valeurs R et S produites par le portefeuille d&#8217;Alice pour prouver qu&#8217;elle poss√®de la cl√© priv√©e autoris√©e √† d√©penser cette sortie. Le format de s√©rialisation se compose de neuf √©l√©ments comme suit¬†:</p>
</div>
<div class="ulist data-line-585">
<ul>
<li class="data-line-585">
<p>0x30‚Äîindiquant le d√©but d&#8217;une s√©quence DER</p>
</li>
<li class="data-line-586">
<p>0x45‚Äîla longueur de la s√©quence (69 octets)</p>
</li>
<li class="data-line-587">
<p>0x02‚Äîune valeur enti√®re suit</p>
</li>
<li class="data-line-588">
<p>0x21‚Äîla longueur de l&#8217;entier (33 octets)</p>
</li>
<li class="data-line-589">
<p>R‚Äî00884d142d86652a3f47ba4746ec719bbfbd040a570b1deccbb6498c75c4ae24cb</p>
</li>
<li class="data-line-590">
<p>0x02‚Äîun autre entier suit</p>
</li>
<li class="data-line-591">
<p>0x20‚Äîla longueur de l&#8217;entier (32 octets)</p>
</li>
<li class="data-line-592">
<p>S‚Äî4b9f039ff08df09cbe9f6addac960298cad530a863ea8f53982c09db8f6e3813</p>
</li>
<li class="data-line-593">
<p>Un suffixe (0x01) indiquant le type de hachage utilis√© (SIGHASH_ALL)</p>
</li>
</ul>
</div>
<div class="paragraph data-line-595">
<p>Voyez si vous pouvez d√©coder la signature s√©rialis√©e (encod√©e en DER) d&#8217;Alice en utilisant cette liste. Les nombres importants sont R et S¬†; le reste des donn√©es fait partie du sch√©ma de codage DER.</p>
</div>
</div>
</div>
<div class="sect3 data-line-597">
<h4 id="_v√©rification_de_la_signature">V√©rification de la signature</h4>
<div class="paragraph data-line-599">
<p>Pour v√©rifier la signature, il faut avoir la signature (R et S), la transaction s√©rialis√©e, et la cl√© publique (qui correspond √† la cl√© priv√©e utilis√©e pour cr√©er la signature). Essentiellement, la v√©rification d&#8217;une signature signifie &quot;Seul le propri√©taire de la cl√© priv√©e qui a g√©n√©r√© cette cl√© publique pourrait avoir produit cette signature sur cette transaction.&quot;</p>
</div>
<div class="paragraph data-line-601">
<p>L&#8217;algorithme de v√©rification de signature prend le message (un hachage de la transaction ou de parties de celui-ci), la cl√© publique du signataire et la signature (valeurs R et S), et renvoie TRUE si la signature est valide pour ce message et cette cl√© publique.</p>
</div>
</div>
<div class="sect3 data-line-604">
<h4 id="sighash_types">Types de hachage de signature (SIGHASH)</h4>
<div class="paragraph data-line-606">
<p>Les signatures num√©riques sont appliqu√©es aux messages, qui dans le cas du bitcoin, sont les transactions elles-m√™mes. La signature implique un <em>engagement</em> du signataire sur des donn√©es de transaction sp√©cifiques. Dans sa forme la plus simple, la signature s&#8217;applique √† l&#8217;ensemble de la transaction, engageant ainsi toutes les entr√©es, sorties et autres champs de transaction. Cependant, une signature ne peut s&#8217;engager que sur un sous-ensemble des donn√©es d&#8217;une transaction, ce qui est utile pour un certain nombre de sc√©narios, comme nous le verrons dans cette section.</p>
</div>
<div class="paragraph data-line-608">
<p>Les signatures Bitcoin ont un moyen d&#8217;indiquer quelle partie des donn√©es d&#8217;une transaction est incluse dans le hachage sign√© par la cl√© priv√©e √† l&#8217;aide d&#8217;un drapeau SIGHASH. Le drapeau SIGHASH est un octet unique ajout√© √† la signature. Chaque signature a un drapeau SIGHASH et le drapeau peut √™tre diff√©rent d&#8217;une entr√©e √† l&#8217;autre. Une transaction avec trois entr√©es sign√©es peut avoir trois signatures avec des drapeaux SIGHASH diff√©rents, chaque signature signant (committant) diff√©rentes parties de la transaction.</p>
</div>
<div class="paragraph data-line-610">
<p>N&#8217;oubliez pas que chaque entr√©e peut contenir une signature dans son script de d√©verrouillage. Par cons√©quent, une transaction qui contient plusieurs entr√©es peut avoir des signatures avec diff√©rents indicateurs SIGHASH qui valident diff√©rentes parties de la transaction dans chacune des entr√©es. Notez √©galement que les transactions bitcoin peuvent contenir des entr√©es de diff√©rents &quot;propri√©taires&quot;, qui ne peuvent signer qu&#8217;une seule entr√©e dans une transaction partiellement construite (et invalide), collaborant avec d&#8217;autres pour rassembler toutes les signatures n√©cessaires pour effectuer une transaction valide. De nombreux types d&#8217;indicateurs SIGHASH n&#8217;ont de sens que si vous pensez √† plusieurs participants collaborant en dehors du r√©seau Bitcoin et mettant √† jour une transaction partiellement sign√©e.</p>
</div>
<div class="paragraph pagebreak-before data-line-613">
<p>Il existe trois indicateurs SIGHASH¬†: ALL, NONE et SINGLE, comme indiqu√© dans <a href="#sighash_types_and_their">Types SIGHASH et leurs significations</a>.</p>
</div>
<table id="sighash_types_and_their" class="tableblock frame-all grid-all stretch data-line-618">
<caption class="title">Table 4. Types SIGHASH et leurs significations</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Drapeau SIGHASH</th>
<th class="tableblock halign-left valign-top">Valeur</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x01</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La signature s&#8217;applique √† toutes les entr√©es et sorties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NONE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x02</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La signature s&#8217;applique √† toutes les entr√©es, aucune des sorties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SINGLE</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x03</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La signature s&#8217;applique √† toutes les entr√©es mais uniquement √† la sortie avec le m√™me num√©ro d&#8217;index que l&#8217;entr√©e sign√©e</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-625">
<p>De plus, il existe un drapeau modificateur SIGHASH_ANYONECANPAY, qui peut √™tre combin√© avec chacun des drapeaux pr√©c√©dents. Lorsque ANYONECANPAY est d√©fini, une seule entr√©e est sign√©e, laissant le reste (et leurs num√©ros de s√©quence) ouverts pour modification. Le ANYONECANPAY a la valeur 0x80 et est appliqu√© par OR au niveau du bit, ce qui donne les drapeaux combin√©s comme indiqu√© dans <a href="#sighash_types_with_modifiers">Types SIGHASH avec modificateurs et leurs significations</a>.</p>
</div>
<table id="sighash_types_with_modifiers" class="tableblock frame-all grid-all stretch data-line-630">
<caption class="title">Table 5. Types SIGHASH avec modificateurs et leurs significations</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<thead>
<tr>
<th class="tableblock halign-left valign-top">Drapeau SIGHASH</th>
<th class="tableblock halign-left valign-top">Valeur</th>
<th class="tableblock halign-left valign-top">Description</th>
</tr>
</thead>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">ALL|ANYONECANPAY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x81</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La signature s&#8217;applique √† une entr√©e et √† toutes les sorties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">NONE|ANYONECANPAY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x82</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La signature s&#8217;applique √† une entr√©e, aucune des sorties</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">SINGLE|ANYONECANPAY</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">0x83</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La signature s&#8217;applique √† une entr√©e et √† la sortie avec le m√™me num√©ro d&#8217;index</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-637">
<p>Ces combinaisons de drapeaux sont r√©sum√©es dans <a href="#sighash_combinations">R√©sum√© des diff√©rentes combinaisons de sighash</a>.</p>
</div>
<div id="sighash_combinations" class="imageblock data-line-641">
<div class="content">
<img src="images/sighash_combinations.png" alt="&quot;R√©sum√© des diff√©rentes combinaisons de drapeaux SIGHASH&quot;">
</div>
<div class="title">Figure 8. R√©sum√© des diff√©rentes combinaisons de sighash</div>
</div>
<div class="paragraph data-line-643">
<p>La fa√ßon dont les drapeaux SIGHASH sont appliqu√©s lors de la signature et de la v√©rification est qu&#8217;une copie de la transaction est faite et que certains champs √† l&#8217;int√©rieur sont tronqu√©s (mis √† z√©ro et vid√©s). La transaction r√©sultante est s√©rialis√©e. Le drapeau SIGHASH est ajout√© √† la fin de la transaction s√©rialis√©e et le r√©sultat est hach√©. Le hachage lui-m√™me est le &quot;message&quot; qui est sign√©. Selon l&#8217;indicateur SIGHASH utilis√©, diff√©rentes parties de la transaction sont tronqu√©es. Le hachage r√©sultant d√©pend de diff√©rents sous-ensembles de donn√©es dans la transaction. En incluant le SIGHASH comme derni√®re √©tape avant le hachage, la signature valide √©galement le type SIGHASH, de sorte qu&#8217;il ne peut pas √™tre modifi√© (par exemple, par un mineur).</p>
</div>
<div class="admonitionblock note data-line-646">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-647">
<p>Tous les types SIGHASH signent le champ nLocktime de la transaction (voir <a href="#transaction_locktime_nlocktime">[transaction_locktime_nlocktime]</a>). De plus, le type SIGHASH lui-m√™me est ajout√© √† la transaction avant sa signature, de sorte qu&#8217;il ne peut pas √™tre modifi√© une fois sign√©.</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-650">
<p>Dans l&#8217;exemple de la transaction d&#8217;Alice (voir la liste dans <a href="#seralization_of_signatures_der">S√©rialisation des signatures (DER)</a>), nous avons vu que la derni√®re partie de la signature cod√©e en DER √©tait 01, qui est le drapeau SIGHASH_ALL. Cela verrouille les donn√©es de transaction, de sorte que la signature d&#8217;Alice valide l&#8217;√©tat de toutes les entr√©es et sorties. C&#8217;est la forme de signature la plus courante.</p>
</div>
<div class="paragraph data-line-652">
<p>Examinons quelques-uns des autres types de SIGHASH et comment ils peuvent √™tre utilis√©s dans la pratique¬†:</p>
</div>
<div class="dlist data-line-654">
<dl>
<dt class="hdlist1">ALL|ANYONECANPAY </dt>
<dd>
<p>Cette construction peut √™tre utilis√©e pour effectuer une transaction de type &quot;financement participatif&quot;. les fonds peuvent construire une transaction avec une seule sortie. La sortie unique paie le montant &quot;objectif&quot; √† la collecte de fonds. Une telle transaction n&#8217;est √©videmment pas valide, car elle n&#8217;a pas d&#8217;entr√©es. Cependant, d&#8217;autres peuvent maintenant la modifier en ajoutant une entr√©e de leur propre, en tant que don. Ils signent leur propre entr√©e avec ALL|ANYONECANPAY. √Ä moins que suffisamment d&#8217;entr√©es ne soient rassembl√©es pour atteindre la valeur de la sortie, la transaction n&#8217;est pas valide. Chaque don est un &quot;engagement&quot;, qui ne peut pas √™tre collect√© par le collecteur de fonds jusqu&#8217;√† ce que le montant total de l&#8217;objectif soit atteint.</p>
</dd>
<dt class="hdlist1">NONE </dt>
<dd>
<p>Cette construction peut √™tre utilis√©e pour cr√©er un &quot;ch√®que au porteur&quot; ou un &quot;ch√®que en blanc&quot; d&#8217;un montant sp√©cifique. Il s&#8217;engage sur l&#8217;entr√©e, mais permet de modifier le script de verrouillage de sortie. N&#8217;importe qui peut √©crire sa propre adresse Bitcoin dans le script de verrouillage de sortie et racheter la transaction. Cependant, la valeur de sortie elle-m√™me est verrouill√©e par la signature.</p>
</dd>
<dt class="hdlist1">NONE|ANYONECANPAY </dt>
<dd>
<p>Cette construction peut √™tre utilis√©e pour construire un &quot;collecteur de poussi√®re&quot;. Les utilisateurs qui ont de minuscules UTXO dans leur portefeuille ne peuvent pas les d√©penser car le co√ªt des frais d√©passe la valeur de la poussi√®re. Avec ce type de signature, la poussi√®re UTXO peut √™tre donn√©e √† quiconque pour l&#8217;agr√©ger et la d√©penser quand il le souhaite.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-660">
<p>Il y a quelques propositions pour modifier ou √©tendre le syst√®me SIGHASH. L&#8217;une de ces propositions est <em>Bitmask Sighash Modes</em> de Glenn Willen de Blockstream, dans le cadre du projet Elements. Cela vise √† cr√©er un remplacement flexible pour les types SIGHASH qui permet &quot;des masques de bits arbitraires et r√©inscriptibles par des mineurs d&#8217;entr√©es et de sorties&quot; qui peuvent exprimer &quot;des sch√©mas de pr√©-engagement contractuels plus complexes, tels que des offres sign√©es avec changement dans un √©change d&#8217;actifs distribu√©&quot;.</p>
</div>
<div class="admonitionblock note data-line-663">
<table>
<tr>
<td class="icon">
<div class="title">Note</div>
</td>
<td class="content">
<div class="paragraph data-line-664">
<p>Vous ne verrez pas les drapeaux SIGHASH pr√©sent√©s comme une option dans l&#8217;application de portefeuille d&#8217;un utilisateur. √Ä quelques exceptions pr√®s, les portefeuilles construisent des scripts P2PKH et signent avec les drapeaux SIGHASH_ALL. Pour utiliser un indicateur SIGHASH diff√©rent, vous devrez √©crire un logiciel pour construire et signer des transactions. Plus important encore, les drapeaux SIGHASH peuvent √™tre utilis√©s par des applications bitcoin √† usage sp√©cial qui permettent de nouvelles utilisations.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-668">
<h4 id="ecdsa_math">Math√©matiques ECDSA</h4>
<div class="paragraph data-line-670">
<p>Comme mentionn√© pr√©c√©demment, les signatures sont cr√©√©es par une fonction math√©matique <em>F</em><sub><em>sig</em></sub> qui produit une signature compos√©e de deux valeurs <em>R</em> et <em>S</em>. Dans cette section, nous examinons la fonction <em>F</em><sub><em>sig</em></sub> plus en d√©tail.</p>
</div>
<div class="paragraph data-line-672">
<p>L&#8217;algorithme de signature g√©n√®re d&#8217;abord une paire de cl√©s publiques priv√©es <em>√©ph√©m√®res</em> (temporaires). Cette paire de cl√©s temporaire est utilis√©e dans le calcul des valeurs <em>R</em> et <em>S</em>, apr√®s une transformation impliquant la cl√© priv√©e de signature et le hachage de la transaction.</p>
</div>
<div class="paragraph data-line-674">
<p>La paire de cl√©s temporaire est bas√©e sur un nombre al√©atoire <em>k</em>, qui est utilis√© comme cl√© priv√©e temporaire. √Ä partir de <em>k</em>, nous g√©n√©rons la cl√© publique temporaire correspondante <em>P</em> (calcul√©e comme <em>P = k*G</em>, de la m√™me mani√®re que les cl√©s publiques bitcoin sont d√©riv√©es¬†; voir <a href="#pubkey">[pubkey]</a>). La valeur <em>R</em> de la signature num√©rique est alors la coordonn√©e x de la cl√© publique √©ph√©m√®re <em>P</em>.</p>
</div>
<div class="paragraph data-line-676">
<p>A partir de l√†, l&#8217;algorithme calcule la valeur <em>S</em> de la signature, telle que¬†:</p>
</div>
<div class="paragraph data-line-678">
<p><em>S</em> = <em>k</em><sup>-1</sup> (<em>Hash</em>(<em>m</em>) + <em>dA</em> * <em>R</em>) <em>mod n</em></p>
</div>
<div class="paragraph data-line-680">
<p>o√π:</p>
</div>
<div class="ulist data-line-682">
<ul>
<li class="data-line-682">
<p><em>k</em> est la cl√© priv√©e √©ph√©m√®re</p>
</li>
<li class="data-line-683">
<p><em>R</em> est la coordonn√©e x de la cl√© publique √©ph√©m√®re</p>
</li>
<li class="data-line-684">
<p><em>dA</em> est la cl√© priv√©e de signature</p>
</li>
<li class="data-line-685">
<p><em>m</em> est les donn√©es de transaction</p>
</li>
<li class="data-line-686">
<p><em>n</em> est l&#8217;ordre premier de la courbe elliptique</p>
</li>
</ul>
</div>
<div class="paragraph data-line-688">
<p>La v√©rification est l&#8217;inverse de la fonction de g√©n√©ration de signature, utilisant les valeurs <em>R</em>, <em>S</em> et la cl√© publique pour calculer une valeur <em>P</em>, qui est un point sur la courbe elliptique (la cl√© publique √©ph√©m√®re utilis√©e dans la cr√©ation de signature)¬†:</p>
</div>
<div class="paragraph data-line-690">
<p><em>P</em> = <em>S</em><sup>-1</sup> * <em>Hash</em>(<em>m</em>) * <em>G</em> + <em>S</em><sup>-1</sup> * <em>R</em> * <em>Qa</em></p>
</div>
<div class="paragraph data-line-692">
<p>o√π:</p>
</div>
<div class="ulist data-line-694">
<ul>
<li class="data-line-694">
<p><em>R</em> et <em>S</em> sont les valeurs de signature</p>
</li>
<li class="data-line-695">
<p><em>Qa</em> est la cl√© publique d&#8217;Alice</p>
</li>
<li class="data-line-696">
<p><em>m</em> est les donn√©es de transaction qui ont √©t√© sign√©es</p>
</li>
<li class="data-line-697">
<p><em>G</em> est le point g√©n√©rateur de la courbe elliptique</p>
</li>
</ul>
</div>
<div class="paragraph data-line-699">
<p>Si la coordonn√©e x du point calcul√© <em>P</em> est √©gale √† <em>R</em>, alors le v√©rificateur peut conclure que la signature est valide.</p>
</div>
<div class="paragraph data-line-701">
<p>Notez qu&#8217;en v√©rifiant la signature, la cl√© priv√©e n&#8217;est ni connue ni r√©v√©l√©e.</p>
</div>
<div class="admonitionblock tip data-line-704">
<table>
<tr>
<td class="icon">
<div class="title">Tip</div>
</td>
<td class="content">
<div class="paragraph data-line-705">
<p>ECDSA est n√©cessairement un calcul assez compliqu√©; une explication compl√®te est au-del√† de la port√©e de ce livre. Un certain nombre d&#8217;excellents guides en ligne vous guident √©tape par √©tape¬†: recherchez &quot;ECDSA expliqu√©&quot; ou essayez celui-ci¬†: <a href="https://bit.ly/2r0HhGB" class="undefined" data-href="https://bit.ly/2r0HhGB">https://bit.ly/2r0HhGB</a>.</p>
</div>
</td>
</tr>
</table>
</div>
</div>
<div class="sect3 data-line-708">
<h4 id="_limportance_du_caract√®re_al√©atoire_dans_les_signatures">L&#8217;importance du caract√®re al√©atoire dans les signatures</h4>
<div class="paragraph data-line-710">
<p>Comme nous l&#8217;avons vu dans <a href="#ecdsa_math">Math√©matiques ECDSA</a>, l&#8217;algorithme de g√©n√©ration de signature utilise une cl√© al√©atoire <em>k</em>, comme base d&#8217;un couple cl√© priv√©e/publique √©ph√©m√®re. La valeur de <em>k</em> n&#8217;est pas importante, <em>tant qu&#8217;elle est al√©atoire</em>. Si la m√™me valeur <em>k</em> est utilis√©e pour produire deux signatures sur diff√©rents messages (transactions), alors la signature <em>cl√© priv√©e</em> peut √™tre calcul√©e par n&#8217;importe qui. La r√©utilisation de la m√™me valeur pour <em>k</em> dans un algorithme de signature conduit √† l&#8217;exposition de la cl√© priv√©e¬†!</p>
</div>
<div class="admonitionblock warning data-line-713">
<table>
<tr>
<td class="icon">
<div class="title">Warning</div>
</td>
<td class="content">
<div class="paragraph data-line-714">
<p>Si la m√™me valeur <em>k</em> est utilis√©e dans l&#8217;algorithme de signature sur deux transactions diff√©rentes, la cl√© priv√©e peut √™tre calcul√©e et expos√©e au monde¬†!</p>
</div>
</td>
</tr>
</table>
</div>
<div class="paragraph data-line-717">
<p>Ce n&#8217;est pas seulement une possibilit√© th√©orique. Nous avons vu ce probl√®me conduire √† l&#8217;exposition de cl√©s priv√©es dans quelques impl√©mentations diff√©rentes d&#8217;algorithmes de signature de transaction en bitcoin. Des personnes se sont fait voler des fonds en raison de la r√©utilisation par inadvertance d&#8217;une valeur <em>k</em>. La raison la plus courante de r√©utilisation d&#8217;une valeur <em>k</em> est un g√©n√©rateur de nombres al√©atoires mal initialis√©.</p>
</div>
<div class="paragraph data-line-719">
<p>Pour √©viter cette vuln√©rabilit√©, la meilleure pratique de l&#8217;industrie est de ne pas g√©n√©rer <em>k</em> avec un g√©n√©rateur de nombres al√©atoires sem√© d&#8217;entropie, mais plut√¥t d&#8217;utiliser un processus d√©terministe-al√©atoire sem√© avec les donn√©es de transaction elles-m√™mes. Cela garantit que chaque transaction produit un <em>k</em> diff√©rent. L&#8217;algorithme standard de l&#8217;industrie pour l&#8217;initialisation d√©terministe de <em>k</em> est d√©fini dans <a href="https://tools.ietf.org/html/rfc6979" data-href="https://tools.ietf.org/html/rfc6979">RFC 6979</a>, publi√© par l&#8217;Internet Engineering Task Force.</p>
</div>
<div class="paragraph data-line-721">
<p>Si vous impl√©mentez un algorithme pour signer des transactions en bitcoin, vous <em>devez</em> utiliser la RFC 6979 ou un algorithme d√©terministe-al√©atoire similaire pour vous assurer de g√©n√©rer un <em>k</em> diff√©rent pour chaque transaction.</p>
</div>
</div>
</div>
<div class="sect2 data-line-723">
<h3 id="_adresses_bitcoin_soldes_et_autres_abstractions">Adresses Bitcoin, soldes et autres abstractions</h3>
<div class="paragraph data-line-725">
<p>Nous avons commenc√© ce chapitre avec la d√©couverte que les transactions sont tr√®s diff√©rentes &quot;dans les coulisses&quot; de la fa√ßon dont elles sont pr√©sent√©es dans les portefeuilles, les explorateurs de cha√Æne de blocs, et d&#8217;autres applications destin√©es aux utilisateurs. De nombreux concepts simplistes et familiers des chapitres pr√©c√©dents, tels que les adresses et les soldes Bitcoin, semblent √™tre absents de la structure de transaction. Nous avons vu que les transactions ne contiennent pas d&#8217;adresses Bitcoin en soi, mais fonctionnent plut√¥t via des scripts qui verrouillent et d√©verrouillent des valeurs discr√®tes de bitcoin. Les soldes ne sont pr√©sents nulle part dans ce syst√®me et pourtant, chaque application de portefeuille affiche bien en √©vidence le solde du portefeuille de l&#8217;utilisateur.</p>
</div>
<div class="paragraph data-line-727">
<p>Maintenant que nous avons explor√© ce qui est r√©ellement inclus dans une transaction bitcoin, nous pouvons examiner comment les abstractions de niveau sup√©rieur sont d√©riv√©es des composants apparemment primitifs de la transaction.</p>
</div>
<div class="paragraph data-line-729">
<p>Regardons √† nouveau comment la transaction d&#8217;Alice a √©t√© pr√©sent√©e sur un explorateur de blocs populaire (<a href="#alice_transaction_to_bobs_cafe">Transaction d&#8217;Alice au Bob&#8217;s Caf√©</a>).</p>
</div>
<div id="alice_transaction_to_bobs_cafe" class="imageblock data-line-733">
<div class="content">
<img src="images/mbc2_0208.png" alt="Alice Coffee Transaction">
</div>
<div class="title">Figure 9. Transaction d&#8217;Alice au Bob&#8217;s Caf√©</div>
</div>
<div class="paragraph data-line-735">
<p>Sur le c√¥t√© gauche de la transaction, l&#8217;explorateur de explorateur de cha√Æne de blocs affiche l&#8217;adresse Bitcoin d&#8217;Alice comme &quot;exp√©diteur&quot;. En fait, cette information n&#8217;est pas dans la transaction elle-m√™me. Lorsque l&#8217;explorateur de blockchain fait r√©f√©rence √† la transaction, il fait √©galement r√©f√©rence √† la transaction pr√©c√©dente associ√©e √† l&#8217;entr√©e et extrait la premi√®re sortie de cette transaction plus ancienne. Dans cette sortie se trouve un script de verrouillage qui verrouille l&#8217;UTXO sur le hachage de la cl√© publique d&#8217;Alice (un script P2PKH). L&#8217;explorateur de blockchain a extrait le hachage de la cl√© publique et l&#8217;a encod√© √† l&#8217;aide de l&#8217;encodage Base58Check pour produire et afficher l&#8217;adresse Bitcoin qui repr√©sente cette cl√© publique.</p>
</div>
<div class="paragraph data-line-737">
<p>De m√™me, sur le c√¥t√© droit, l&#8217;explorateur de blockchain affiche les deux sorties¬†; le premier √† l&#8217;adresse Bitcoin de Bob et le second √† l&#8217;adresse Bitcoin d&#8217;Alice (comme change). Encore une fois, pour cr√©er ces adresses Bitcoin, l&#8217;explorateur de blockchain a extrait le script de verrouillage de chaque sortie, l&#8217;a reconnu comme un script P2PKH et a extrait le hachage de cl√© publique de l&#8217;int√©rieur. Enfin, l&#8217;explorateur de blockchain a r√©encod√© chaque hachage de cl√© publique avec Base58Check pour produire et afficher les adresses Bitcoin.</p>
</div>
<div class="paragraph data-line-739">
<p>Si vous deviez cliquer sur l&#8217;adresse Bitcoin de Bob, l&#8217;explorateur de blockchain vous montrerait la vue dans <a href="#the_balance_of_bobs_bitcoin_address">Le solde de l&#8217;adresse Bitcoin de Bob</a>.</p>
</div>
<div id="the_balance_of_bobs_bitcoin_address" class="imageblock data-line-743">
<div class="content">
<img src="images/mbc2_0608.png" alt="&quot;Le solde de l&#8217;adresse Bitcoin de Bob&quot;">
</div>
<div class="title">Figure 10. Le solde de l&#8217;adresse Bitcoin de Bob</div>
</div>
<div class="paragraph data-line-745">
<p>L&#8217;explorateur de la cha√Æne de blocs affiche le solde de l&#8217;adresse Bitcoin de Bob. Mais nulle part dans le syst√®me Bitcoin il n&#8217;y a un concept de &quot;solde&quot;. Au lieu de cela, les valeurs affich√©es ici sont construites par l&#8217;explorateur de explorateur de cha√Æne de blocs comme suit.</p>
</div>
<div class="paragraph data-line-747">
<p>Pour construire le montant &quot;Total re√ßu&quot;, l&#8217;explorateur de explorateur de la cha√Æne de blocs d√©codera d&#8217;abord l&#8217;encodage Base58Check de l&#8217;adresse Bitcoin pour r√©cup√©rer le hachage 160 bits de la cl√© publique de Bob qui est encod√© dans l&#8217;adresse. Ensuite, l&#8217;explorateur de blockchain recherchera dans la base de donn√©es des transactions, √† la recherche de sorties avec des scripts de verrouillage P2PKH contenant le hachage de la cl√© publique de Bob. En additionnant la valeur de toutes les sorties, l&#8217;explorateur de la cha√Æne de blocs peut produire la valeur totale re√ßue.</p>
</div>
<div class="paragraph data-line-749">
<p>Construire le solde actuel (affich√© comme &quot;Solde final&quot;) n√©cessite un peu plus de travail. L&#8217;explorateur de la cha√Æne de blocs conserve une base de donn√©es distincte des sorties actuellement non d√©pens√©es, l&#8217;ensemble UTXO. Pour maintenir cette base de donn√©es, l&#8217;explorateur de la cha√Æne de blocs doit surveiller le r√©seau Bitcoin, ajouter les UTXO nouvellement cr√©√©s et supprimer les UTXO d√©pens√©s, en temps r√©el, tels qu&#8217;ils apparaissent dans les transactions non confirm√©es. Il s&#8217;agit d&#8217;un processus compliqu√© qui d√©pend du suivi des transactions au fur et √† mesure qu&#8217;elles se propagent, ainsi que du maintien d&#8217;un consensus avec le r√©seau Bitcoin pour s&#8217;assurer que la cha√Æne correcte est suivie. Parfois, l&#8217;explorateur de la cha√Æne de blocs est d√©synchronis√© et sa perspective de l&#8217;ensemble UTXO est incompl√®te ou incorrecte.</p>
</div>
<div class="paragraph data-line-751">
<p>√Ä partir de l&#8217;ensemble UTXO, l&#8217;explorateur de la cha√Æne de blocs r√©sume la valeur de toutes les sorties non d√©pens√©es faisant r√©f√©rence au hachage de la cl√© publique de Bob et produit le num√©ro &quot;Solde final&quot; affich√© √† l&#8217;utilisateur.</p>
</div>
<div class="paragraph data-line-753">
<p>Afin de produire cette image unique, avec ces deux &quot;soldes&quot;, l&#8217;explorateur de la cha√Æne de blocs doit indexer et rechercher parmi des dizaines, des centaines, voire des centaines de milliers de transactions.</p>
</div>
<div class="paragraph data-line-755">
<p>En r√©sum√©, les informations pr√©sent√©es aux utilisateurs via les applications de portefeuille, les explorateurs de cha√Ænes de blocs et d&#8217;autres interfaces utilisateur Bitcoin sont souvent compos√©es d&#8217;abstractions de niveau sup√©rieur qui sont d√©riv√©es en recherchant de nombreuses transactions diff√©rentes, en inspectant leur contenu et en manipulant les donn√©es qu&#8217;elles contiennent. En pr√©sentant cette vision simpliste des transactions bitcoin qui ressemblent √† des ch√®ques bancaires d&#8217;un exp√©diteur √† un destinataire, ces applications doivent extraire de nombreux d√©tails sous-jacents. Ils se concentrent principalement sur les types de transactions courants¬†: P2PKH avec des signatures SIGHASH_ALL sur chaque entr√©e. Ainsi, alors que les applications bitcoin peuvent pr√©senter plus de 80% de toutes les transactions de mani√®re facile √† lire, elles sont parfois bloqu√©es par des transactions qui s&#8217;√©cartent de la norme. Les transactions qui contiennent des scripts de verrouillage plus complexes, ou diff√©rents indicateurs SIGHASH, ou de nombreuses entr√©es et sorties, d√©montrent la simplicit√© et la faiblesse de ces abstractions.</p>
</div>
<div class="paragraph data-line-757">
<p>Chaque jour, des centaines de transactions qui ne contiennent pas de sorties P2PKH sont confirm√©es sur la cha√Æne de blocs. Les explorateurs de cha√Æne de blocs les pr√©sentent souvent avec des messages d&#8217;avertissement rouges indiquant qu&#8217;ils ne peuvent pas d√©coder une adresse.</p>
</div>
<div class="paragraph data-line-759">
<p>Comme nous le verrons au chapitre suivant, il ne s&#8217;agit pas n√©cessairement de transactions √©tranges. Ce sont des transactions qui contiennent des scripts de verrouillage plus complexes que le P2PKH commun. Nous apprendrons ensuite √† d√©coder et √† comprendre des scripts plus complexes et les applications qu&#8217;ils prennent en charge.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-03-18 23:42:37 -0400
</div>
</div>
</body>
</html>