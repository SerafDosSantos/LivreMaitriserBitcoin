<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="generator" content="Asciidoctor 2.0.17">
<title>Minage et Consensus</title>
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700">
<style>
/*! Asciidoctor default stylesheet | MIT License | https://asciidoctor.org */
/* Uncomment the following line when using as a custom stylesheet */
/* @import "https://fonts.googleapis.com/css?family=Open+Sans:300,300italic,400,400italic,600,600italic%7CNoto+Serif:400,400italic,700,700italic%7CDroid+Sans+Mono:400,700"; */
html{font-family:sans-serif;-webkit-text-size-adjust:100%}
a{background:none}
a:focus{outline:thin dotted}
a:active,a:hover{outline:0}
h1{font-size:2em;margin:.67em 0}
b,strong{font-weight:bold}
abbr{font-size:.9em}
abbr[title]{cursor:help;border-bottom:1px dotted #dddddf;text-decoration:none}
dfn{font-style:italic}
hr{height:0}
mark{background:#ff0;color:#000}
code,kbd,pre,samp{font-family:monospace;font-size:1em}
pre{white-space:pre-wrap}
q{quotes:"\201C" "\201D" "\2018" "\2019"}
small{font-size:80%}
sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}
sup{top:-.5em}
sub{bottom:-.25em}
img{border:0}
svg:not(:root){overflow:hidden}
figure{margin:0}
audio,video{display:inline-block}
audio:not([controls]){display:none;height:0}
fieldset{border:1px solid silver;margin:0 2px;padding:.35em .625em .75em}
legend{border:0;padding:0}
button,input,select,textarea{font-family:inherit;font-size:100%;margin:0}
button,input{line-height:normal}
button,select{text-transform:none}
button,html input[type=button],input[type=reset],input[type=submit]{-webkit-appearance:button;cursor:pointer}
button[disabled],html input[disabled]{cursor:default}
input[type=checkbox],input[type=radio]{padding:0}
button::-moz-focus-inner,input::-moz-focus-inner{border:0;padding:0}
textarea{overflow:auto;vertical-align:top}
table{border-collapse:collapse;border-spacing:0}
*,::before,::after{box-sizing:border-box}
html,body{font-size:100%}
body{background:#fff;color:rgba(0,0,0,.8);padding:0;margin:0;font-family:"Noto Serif","DejaVu Serif",serif;line-height:1;position:relative;cursor:auto;-moz-tab-size:4;-o-tab-size:4;tab-size:4;word-wrap:anywhere;-moz-osx-font-smoothing:grayscale;-webkit-font-smoothing:antialiased}
a:hover{cursor:pointer}
img,object,embed{max-width:100%;height:auto}
object,embed{height:100%}
img{-ms-interpolation-mode:bicubic}
.left{float:left!important}
.right{float:right!important}
.text-left{text-align:left!important}
.text-right{text-align:right!important}
.text-center{text-align:center!important}
.text-justify{text-align:justify!important}
.hide{display:none}
img,object,svg{display:inline-block;vertical-align:middle}
textarea{height:auto;min-height:50px}
select{width:100%}
.subheader,.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{line-height:1.45;color:#7a2518;font-weight:400;margin-top:0;margin-bottom:.25em}
div,dl,dt,dd,ul,ol,li,h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6,pre,form,p,blockquote,th,td{margin:0;padding:0}
a{color:#2156a5;text-decoration:underline;line-height:inherit}
a:hover,a:focus{color:#1d4b8f}
a img{border:0}
p{line-height:1.6;margin-bottom:1.25em;text-rendering:optimizeLegibility}
p aside{font-size:.875em;line-height:1.35;font-style:italic}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{font-family:"Open Sans","DejaVu Sans",sans-serif;font-weight:300;font-style:normal;color:#ba3925;text-rendering:optimizeLegibility;margin-top:1em;margin-bottom:.5em;line-height:1.0125em}
h1 small,h2 small,h3 small,#toctitle small,.sidebarblock>.content>.title small,h4 small,h5 small,h6 small{font-size:60%;color:#e99b8f;line-height:0}
h1{font-size:2.125em}
h2{font-size:1.6875em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.375em}
h4,h5{font-size:1.125em}
h6{font-size:1em}
hr{border:solid #dddddf;border-width:1px 0 0;clear:both;margin:1.25em 0 1.1875em}
em,i{font-style:italic;line-height:inherit}
strong,b{font-weight:bold;line-height:inherit}
small{font-size:60%;line-height:inherit}
code{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;font-weight:400;color:rgba(0,0,0,.9)}
ul,ol,dl{line-height:1.6;margin-bottom:1.25em;list-style-position:outside;font-family:inherit}
ul,ol{margin-left:1.5em}
ul li ul,ul li ol{margin-left:1.25em;margin-bottom:0}
ul.square li ul,ul.circle li ul,ul.disc li ul{list-style:inherit}
ul.square{list-style-type:square}
ul.circle{list-style-type:circle}
ul.disc{list-style-type:disc}
ol li ul,ol li ol{margin-left:1.25em;margin-bottom:0}
dl dt{margin-bottom:.3125em;font-weight:bold}
dl dd{margin-bottom:1.25em}
blockquote{margin:0 0 1.25em;padding:.5625em 1.25em 0 1.1875em;border-left:1px solid #ddd}
blockquote,blockquote p{line-height:1.6;color:rgba(0,0,0,.85)}
@media screen and (min-width:768px){h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2}
h1{font-size:2.75em}
h2{font-size:2.3125em}
h3,#toctitle,.sidebarblock>.content>.title{font-size:1.6875em}
h4{font-size:1.4375em}}
table{background:#fff;margin-bottom:1.25em;border:1px solid #dedede;word-wrap:normal}
table thead,table tfoot{background:#f7f8f7}
table thead tr th,table thead tr td,table tfoot tr th,table tfoot tr td{padding:.5em .625em .625em;font-size:inherit;color:rgba(0,0,0,.8);text-align:left}
table tr th,table tr td{padding:.5625em .625em;font-size:inherit;color:rgba(0,0,0,.8)}
table tr.even,table tr.alt{background:#f8f8f7}
table thead tr th,table tfoot tr th,table tbody tr td,table tr td,table tfoot tr td{line-height:1.6}
h1,h2,h3,#toctitle,.sidebarblock>.content>.title,h4,h5,h6{line-height:1.2;word-spacing:-.05em}
h1 strong,h2 strong,h3 strong,#toctitle strong,.sidebarblock>.content>.title strong,h4 strong,h5 strong,h6 strong{font-weight:400}
.center{margin-left:auto;margin-right:auto}
.stretch{width:100%}
.clearfix::before,.clearfix::after,.float-group::before,.float-group::after{content:" ";display:table}
.clearfix::after,.float-group::after{clear:both}
:not(pre).nobreak{word-wrap:normal}
:not(pre).nowrap{white-space:nowrap}
:not(pre).pre-wrap{white-space:pre-wrap}
:not(pre):not([class^=L])>code{font-size:.9375em;font-style:normal!important;letter-spacing:0;padding:.1em .5ex;word-spacing:-.15em;background:#f7f7f8;border-radius:4px;line-height:1.45;text-rendering:optimizeSpeed}
pre{color:rgba(0,0,0,.9);font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;line-height:1.45;text-rendering:optimizeSpeed}
pre code,pre pre{color:inherit;font-size:inherit;line-height:inherit}
pre>code{display:block}
pre.nowrap,pre.nowrap pre{white-space:pre;word-wrap:normal}
em em{font-style:normal}
strong strong{font-weight:400}
.keyseq{color:rgba(51,51,51,.8)}
kbd{font-family:"Droid Sans Mono","DejaVu Sans Mono",monospace;display:inline-block;color:rgba(0,0,0,.8);font-size:.65em;line-height:1.45;background:#f7f7f7;border:1px solid #ccc;border-radius:3px;box-shadow:0 1px 0 rgba(0,0,0,.2),inset 0 0 0 .1em #fff;margin:0 .15em;padding:.2em .5em;vertical-align:middle;position:relative;top:-.1em;white-space:nowrap}
.keyseq kbd:first-child{margin-left:0}
.keyseq kbd:last-child{margin-right:0}
.menuseq,.menuref{color:#000}
.menuseq b:not(.caret),.menuref{font-weight:inherit}
.menuseq{word-spacing:-.02em}
.menuseq b.caret{font-size:1.25em;line-height:.8}
.menuseq i.caret{font-weight:bold;text-align:center;width:.45em}
b.button::before,b.button::after{position:relative;top:-1px;font-weight:400}
b.button::before{content:"[";padding:0 3px 0 2px}
b.button::after{content:"]";padding:0 2px 0 3px}
p a>code:hover{color:rgba(0,0,0,.9)}
#header,#content,#footnotes,#footer{width:100%;margin:0 auto;max-width:62.5em;*zoom:1;position:relative;padding-left:.9375em;padding-right:.9375em}
#header::before,#header::after,#content::before,#content::after,#footnotes::before,#footnotes::after,#footer::before,#footer::after{content:" ";display:table}
#header::after,#content::after,#footnotes::after,#footer::after{clear:both}
#content{margin-top:1.25em}
#content::before{content:none}
#header>h1:first-child{color:rgba(0,0,0,.85);margin-top:2.25rem;margin-bottom:0}
#header>h1:first-child+#toc{margin-top:8px;border-top:1px solid #dddddf}
#header>h1:only-child,body.toc2 #header>h1:nth-last-child(2){border-bottom:1px solid #dddddf;padding-bottom:8px}
#header .details{border-bottom:1px solid #dddddf;line-height:1.45;padding-top:.25em;padding-bottom:.25em;padding-left:.25em;color:rgba(0,0,0,.6);display:flex;flex-flow:row wrap}
#header .details span:first-child{margin-left:-.125em}
#header .details span.email a{color:rgba(0,0,0,.85)}
#header .details br{display:none}
#header .details br+span::before{content:"\00a0\2013\00a0"}
#header .details br+span.author::before{content:"\00a0\22c5\00a0";color:rgba(0,0,0,.85)}
#header .details br+span#revremark::before{content:"\00a0|\00a0"}
#header #revnumber{text-transform:capitalize}
#header #revnumber::after{content:"\00a0"}
#content>h1:first-child:not([class]){color:rgba(0,0,0,.85);border-bottom:1px solid #dddddf;padding-bottom:8px;margin-top:0;padding-top:1rem;margin-bottom:1.25rem}
#toc{border-bottom:1px solid #e7e7e9;padding-bottom:.5em}
#toc>ul{margin-left:.125em}
#toc ul.sectlevel0>li>a{font-style:italic}
#toc ul.sectlevel0 ul.sectlevel1{margin:.5em 0}
#toc ul{font-family:"Open Sans","DejaVu Sans",sans-serif;list-style-type:none}
#toc li{line-height:1.3334;margin-top:.3334em}
#toc a{text-decoration:none}
#toc a:active{text-decoration:underline}
#toctitle{color:#7a2518;font-size:1.2em}
@media screen and (min-width:768px){#toctitle{font-size:1.375em}
body.toc2{padding-left:15em;padding-right:0}
#toc.toc2{margin-top:0!important;background:#f8f8f7;position:fixed;width:15em;left:0;top:0;border-right:1px solid #e7e7e9;border-top-width:0!important;border-bottom-width:0!important;z-index:1000;padding:1.25em 1em;height:100%;overflow:auto}
#toc.toc2 #toctitle{margin-top:0;margin-bottom:.8rem;font-size:1.2em}
#toc.toc2>ul{font-size:.9em;margin-bottom:0}
#toc.toc2 ul ul{margin-left:0;padding-left:1em}
#toc.toc2 ul.sectlevel0 ul.sectlevel1{padding-left:0;margin-top:.5em;margin-bottom:.5em}
body.toc2.toc-right{padding-left:0;padding-right:15em}
body.toc2.toc-right #toc.toc2{border-right-width:0;border-left:1px solid #e7e7e9;left:auto;right:0}}
@media screen and (min-width:1280px){body.toc2{padding-left:20em;padding-right:0}
#toc.toc2{width:20em}
#toc.toc2 #toctitle{font-size:1.375em}
#toc.toc2>ul{font-size:.95em}
#toc.toc2 ul ul{padding-left:1.25em}
body.toc2.toc-right{padding-left:0;padding-right:20em}}
#content #toc{border:1px solid #e0e0dc;margin-bottom:1.25em;padding:1.25em;background:#f8f8f7;border-radius:4px}
#content #toc>:first-child{margin-top:0}
#content #toc>:last-child{margin-bottom:0}
#footer{max-width:none;background:rgba(0,0,0,.8);padding:1.25em}
#footer-text{color:hsla(0,0%,100%,.8);line-height:1.44}
#content{margin-bottom:.625em}
.sect1{padding-bottom:.625em}
@media screen and (min-width:768px){#content{margin-bottom:1.25em}
.sect1{padding-bottom:1.25em}}
.sect1:last-child{padding-bottom:0}
.sect1+.sect1{border-top:1px solid #e7e7e9}
#content h1>a.anchor,h2>a.anchor,h3>a.anchor,#toctitle>a.anchor,.sidebarblock>.content>.title>a.anchor,h4>a.anchor,h5>a.anchor,h6>a.anchor{position:absolute;z-index:1001;width:1.5ex;margin-left:-1.5ex;display:block;text-decoration:none!important;visibility:hidden;text-align:center;font-weight:400}
#content h1>a.anchor::before,h2>a.anchor::before,h3>a.anchor::before,#toctitle>a.anchor::before,.sidebarblock>.content>.title>a.anchor::before,h4>a.anchor::before,h5>a.anchor::before,h6>a.anchor::before{content:"\00A7";font-size:.85em;display:block;padding-top:.1em}
#content h1:hover>a.anchor,#content h1>a.anchor:hover,h2:hover>a.anchor,h2>a.anchor:hover,h3:hover>a.anchor,#toctitle:hover>a.anchor,.sidebarblock>.content>.title:hover>a.anchor,h3>a.anchor:hover,#toctitle>a.anchor:hover,.sidebarblock>.content>.title>a.anchor:hover,h4:hover>a.anchor,h4>a.anchor:hover,h5:hover>a.anchor,h5>a.anchor:hover,h6:hover>a.anchor,h6>a.anchor:hover{visibility:visible}
#content h1>a.link,h2>a.link,h3>a.link,#toctitle>a.link,.sidebarblock>.content>.title>a.link,h4>a.link,h5>a.link,h6>a.link{color:#ba3925;text-decoration:none}
#content h1>a.link:hover,h2>a.link:hover,h3>a.link:hover,#toctitle>a.link:hover,.sidebarblock>.content>.title>a.link:hover,h4>a.link:hover,h5>a.link:hover,h6>a.link:hover{color:#a53221}
details,.audioblock,.imageblock,.literalblock,.listingblock,.stemblock,.videoblock{margin-bottom:1.25em}
details{margin-left:1.25rem}
details>summary{cursor:pointer;display:block;position:relative;line-height:1.6;margin-bottom:.625rem;outline:none;-webkit-tap-highlight-color:transparent}
details>summary::-webkit-details-marker{display:none}
details>summary::before{content:"";border:solid transparent;border-left:solid;border-width:.3em 0 .3em .5em;position:absolute;top:.5em;left:-1.25rem;transform:translateX(15%)}
details[open]>summary::before{border:solid transparent;border-top:solid;border-width:.5em .3em 0;transform:translateY(15%)}
details>summary::after{content:"";width:1.25rem;height:1em;position:absolute;top:.3em;left:-1.25rem}
.admonitionblock td.content>.title,.audioblock>.title,.exampleblock>.title,.imageblock>.title,.listingblock>.title,.literalblock>.title,.stemblock>.title,.openblock>.title,.paragraph>.title,.quoteblock>.title,table.tableblock>.title,.verseblock>.title,.videoblock>.title,.dlist>.title,.olist>.title,.ulist>.title,.qlist>.title,.hdlist>.title{text-rendering:optimizeLegibility;text-align:left;font-family:"Noto Serif","DejaVu Serif",serif;font-size:1rem;font-style:italic}
table.tableblock.fit-content>caption.title{white-space:nowrap;width:0}
.paragraph.lead>p,#preamble>.sectionbody>[class=paragraph]:first-of-type p{font-size:1.21875em;line-height:1.6;color:rgba(0,0,0,.85)}
.admonitionblock>table{border-collapse:separate;border:0;background:none;width:100%}
.admonitionblock>table td.icon{text-align:center;width:80px}
.admonitionblock>table td.icon img{max-width:none}
.admonitionblock>table td.icon .title{font-weight:bold;font-family:"Open Sans","DejaVu Sans",sans-serif;text-transform:uppercase}
.admonitionblock>table td.content{padding-left:1.125em;padding-right:1.25em;border-left:1px solid #dddddf;color:rgba(0,0,0,.6);word-wrap:anywhere}
.admonitionblock>table td.content>:last-child>:last-child{margin-bottom:0}
.exampleblock>.content{border:1px solid #e6e6e6;margin-bottom:1.25em;padding:1.25em;background:#fff;border-radius:4px}
.exampleblock>.content>:first-child{margin-top:0}
.exampleblock>.content>:last-child{margin-bottom:0}
.sidebarblock{border:1px solid #dbdbd6;margin-bottom:1.25em;padding:1.25em;background:#f3f3f2;border-radius:4px}
.sidebarblock>:first-child{margin-top:0}
.sidebarblock>:last-child{margin-bottom:0}
.sidebarblock>.content>.title{color:#7a2518;margin-top:0;text-align:center}
.exampleblock>.content>:last-child>:last-child,.exampleblock>.content .olist>ol>li:last-child>:last-child,.exampleblock>.content .ulist>ul>li:last-child>:last-child,.exampleblock>.content .qlist>ol>li:last-child>:last-child,.sidebarblock>.content>:last-child>:last-child,.sidebarblock>.content .olist>ol>li:last-child>:last-child,.sidebarblock>.content .ulist>ul>li:last-child>:last-child,.sidebarblock>.content .qlist>ol>li:last-child>:last-child{margin-bottom:0}
.literalblock pre,.listingblock>.content>pre{border-radius:4px;overflow-x:auto;padding:1em;font-size:.8125em}
@media screen and (min-width:768px){.literalblock pre,.listingblock>.content>pre{font-size:.90625em}}
@media screen and (min-width:1280px){.literalblock pre,.listingblock>.content>pre{font-size:1em}}
.literalblock pre,.listingblock>.content>pre:not(.highlight),.listingblock>.content>pre[class=highlight],.listingblock>.content>pre[class^="highlight "]{background:#f7f7f8}
.literalblock.output pre{color:#f7f7f8;background:rgba(0,0,0,.9)}
.listingblock>.content{position:relative}
.listingblock code[data-lang]::before{display:none;content:attr(data-lang);position:absolute;font-size:.75em;top:.425rem;right:.5rem;line-height:1;text-transform:uppercase;color:inherit;opacity:.5}
.listingblock:hover code[data-lang]::before{display:block}
.listingblock.terminal pre .command::before{content:attr(data-prompt);padding-right:.5em;color:inherit;opacity:.5}
.listingblock.terminal pre .command:not([data-prompt])::before{content:"$"}
.listingblock pre.highlightjs{padding:0}
.listingblock pre.highlightjs>code{padding:1em;border-radius:4px}
.listingblock pre.prettyprint{border-width:0}
.prettyprint{background:#f7f7f8}
pre.prettyprint .linenums{line-height:1.45;margin-left:2em}
pre.prettyprint li{background:none;list-style-type:inherit;padding-left:0}
pre.prettyprint li code[data-lang]::before{opacity:1}
pre.prettyprint li:not(:first-child) code[data-lang]::before{display:none}
table.linenotable{border-collapse:separate;border:0;margin-bottom:0;background:none}
table.linenotable td[class]{color:inherit;vertical-align:top;padding:0;line-height:inherit;white-space:normal}
table.linenotable td.code{padding-left:.75em}
table.linenotable td.linenos,pre.pygments .linenos{border-right:1px solid;opacity:.35;padding-right:.5em;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}
pre.pygments span.linenos{display:inline-block;margin-right:.75em}
.quoteblock{margin:0 1em 1.25em 1.5em;display:table}
.quoteblock:not(.excerpt)>.title{margin-left:-1.5em;margin-bottom:.75em}
.quoteblock blockquote,.quoteblock p{color:rgba(0,0,0,.85);font-size:1.15rem;line-height:1.75;word-spacing:.1em;letter-spacing:0;font-style:italic;text-align:justify}
.quoteblock blockquote{margin:0;padding:0;border:0}
.quoteblock blockquote::before{content:"\201c";float:left;font-size:2.75em;font-weight:bold;line-height:.6em;margin-left:-.6em;color:#7a2518;text-shadow:0 1px 2px rgba(0,0,0,.1)}
.quoteblock blockquote>.paragraph:last-child p{margin-bottom:0}
.quoteblock .attribution{margin-top:.75em;margin-right:.5ex;text-align:right}
.verseblock{margin:0 1em 1.25em}
.verseblock pre{font-family:"Open Sans","DejaVu Sans",sans-serif;font-size:1.15rem;color:rgba(0,0,0,.85);font-weight:300;text-rendering:optimizeLegibility}
.verseblock pre strong{font-weight:400}
.verseblock .attribution{margin-top:1.25rem;margin-left:.5ex}
.quoteblock .attribution,.verseblock .attribution{font-size:.9375em;line-height:1.45;font-style:italic}
.quoteblock .attribution br,.verseblock .attribution br{display:none}
.quoteblock .attribution cite,.verseblock .attribution cite{display:block;letter-spacing:-.025em;color:rgba(0,0,0,.6)}
.quoteblock.abstract blockquote::before,.quoteblock.excerpt blockquote::before,.quoteblock .quoteblock blockquote::before{display:none}
.quoteblock.abstract blockquote,.quoteblock.abstract p,.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{line-height:1.6;word-spacing:0}
.quoteblock.abstract{margin:0 1em 1.25em;display:block}
.quoteblock.abstract>.title{margin:0 0 .375em;font-size:1.15em;text-align:center}
.quoteblock.excerpt>blockquote,.quoteblock .quoteblock{padding:0 0 .25em 1em;border-left:.25em solid #dddddf}
.quoteblock.excerpt,.quoteblock .quoteblock{margin-left:0}
.quoteblock.excerpt blockquote,.quoteblock.excerpt p,.quoteblock .quoteblock blockquote,.quoteblock .quoteblock p{color:inherit;font-size:1.0625rem}
.quoteblock.excerpt .attribution,.quoteblock .quoteblock .attribution{color:inherit;font-size:.85rem;text-align:left;margin-right:0}
p.tableblock:last-child{margin-bottom:0}
td.tableblock>.content{margin-bottom:1.25em;word-wrap:anywhere}
td.tableblock>.content>:last-child{margin-bottom:-1.25em}
table.tableblock,th.tableblock,td.tableblock{border:0 solid #dedede}
table.grid-all>*>tr>*{border-width:1px}
table.grid-cols>*>tr>*{border-width:0 1px}
table.grid-rows>*>tr>*{border-width:1px 0}
table.frame-all{border-width:1px}
table.frame-ends{border-width:1px 0}
table.frame-sides{border-width:0 1px}
table.frame-none>colgroup+*>:first-child>*,table.frame-sides>colgroup+*>:first-child>*{border-top-width:0}
table.frame-none>:last-child>:last-child>*,table.frame-sides>:last-child>:last-child>*{border-bottom-width:0}
table.frame-none>*>tr>:first-child,table.frame-ends>*>tr>:first-child{border-left-width:0}
table.frame-none>*>tr>:last-child,table.frame-ends>*>tr>:last-child{border-right-width:0}
table.stripes-all>*>tr,table.stripes-odd>*>tr:nth-of-type(odd),table.stripes-even>*>tr:nth-of-type(even),table.stripes-hover>*>tr:hover{background:#f8f8f7}
th.halign-left,td.halign-left{text-align:left}
th.halign-right,td.halign-right{text-align:right}
th.halign-center,td.halign-center{text-align:center}
th.valign-top,td.valign-top{vertical-align:top}
th.valign-bottom,td.valign-bottom{vertical-align:bottom}
th.valign-middle,td.valign-middle{vertical-align:middle}
table thead th,table tfoot th{font-weight:bold}
tbody tr th{background:#f7f8f7}
tbody tr th,tbody tr th p,tfoot tr th,tfoot tr th p{color:rgba(0,0,0,.8);font-weight:bold}
p.tableblock>code:only-child{background:none;padding:0}
p.tableblock{font-size:1em}
ol{margin-left:1.75em}
ul li ol{margin-left:1.5em}
dl dd{margin-left:1.125em}
dl dd:last-child,dl dd:last-child>:last-child{margin-bottom:0}
li p,ul dd,ol dd,.olist .olist,.ulist .ulist,.ulist .olist,.olist .ulist{margin-bottom:.625em}
ul.checklist,ul.none,ol.none,ul.no-bullet,ol.no-bullet,ol.unnumbered,ul.unstyled,ol.unstyled{list-style-type:none}
ul.no-bullet,ol.no-bullet,ol.unnumbered{margin-left:.625em}
ul.unstyled,ol.unstyled{margin-left:0}
li>p:empty:only-child::before{content:"";display:inline-block}
ul.checklist>li>p:first-child{margin-left:-1em}
ul.checklist>li>p:first-child>.fa-square-o:first-child,ul.checklist>li>p:first-child>.fa-check-square-o:first-child{width:1.25em;font-size:.8em;position:relative;bottom:.125em}
ul.checklist>li>p:first-child>input[type=checkbox]:first-child{margin-right:.25em}
ul.inline{display:flex;flex-flow:row wrap;list-style:none;margin:0 0 .625em -1.25em}
ul.inline>li{margin-left:1.25em}
.unstyled dl dt{font-weight:400;font-style:normal}
ol.arabic{list-style-type:decimal}
ol.decimal{list-style-type:decimal-leading-zero}
ol.loweralpha{list-style-type:lower-alpha}
ol.upperalpha{list-style-type:upper-alpha}
ol.lowerroman{list-style-type:lower-roman}
ol.upperroman{list-style-type:upper-roman}
ol.lowergreek{list-style-type:lower-greek}
.hdlist>table,.colist>table{border:0;background:none}
.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}
td.hdlist1,td.hdlist2{vertical-align:top;padding:0 .625em}
td.hdlist1{font-weight:bold;padding-bottom:1.25em}
td.hdlist2{word-wrap:anywhere}
.literalblock+.colist,.listingblock+.colist{margin-top:-.5em}
.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}
.colist td:not([class]):first-child img{max-width:none}
.colist td:not([class]):last-child{padding:.25em 0}
.thumb,.th{line-height:0;display:inline-block;border:4px solid #fff;box-shadow:0 0 0 1px #ddd}
.imageblock.left{margin:.25em .625em 1.25em 0}
.imageblock.right{margin:.25em 0 1.25em .625em}
.imageblock>.title{margin-bottom:0}
.imageblock.thumb,.imageblock.th{border-width:6px}
.imageblock.thumb>.title,.imageblock.th>.title{padding:0 .125em}
.image.left,.image.right{margin-top:.25em;margin-bottom:.25em;display:inline-block;line-height:0}
.image.left{margin-right:.625em}
.image.right{margin-left:.625em}
a.image{text-decoration:none;display:inline-block}
a.image object{pointer-events:none}
sup.footnote,sup.footnoteref{font-size:.875em;position:static;vertical-align:super}
sup.footnote a,sup.footnoteref a{text-decoration:none}
sup.footnote a:active,sup.footnoteref a:active{text-decoration:underline}
#footnotes{padding-top:.75em;padding-bottom:.75em;margin-bottom:.625em}
#footnotes hr{width:20%;min-width:6.25em;margin:-.25em 0 .75em;border-width:1px 0 0}
#footnotes .footnote{padding:0 .375em 0 .225em;line-height:1.3334;font-size:.875em;margin-left:1.2em;margin-bottom:.2em}
#footnotes .footnote a:first-of-type{font-weight:bold;text-decoration:none;margin-left:-1.05em}
#footnotes .footnote:last-of-type{margin-bottom:0}
#content #footnotes{margin-top:-.625em;margin-bottom:0;padding:.75em 0}
div.unbreakable{page-break-inside:avoid}
.big{font-size:larger}
.small{font-size:smaller}
.underline{text-decoration:underline}
.overline{text-decoration:overline}
.line-through{text-decoration:line-through}
.aqua{color:#00bfbf}
.aqua-background{background:#00fafa}
.black{color:#000}
.black-background{background:#000}
.blue{color:#0000bf}
.blue-background{background:#0000fa}
.fuchsia{color:#bf00bf}
.fuchsia-background{background:#fa00fa}
.gray{color:#606060}
.gray-background{background:#7d7d7d}
.green{color:#006000}
.green-background{background:#007d00}
.lime{color:#00bf00}
.lime-background{background:#00fa00}
.maroon{color:#600000}
.maroon-background{background:#7d0000}
.navy{color:#000060}
.navy-background{background:#00007d}
.olive{color:#606000}
.olive-background{background:#7d7d00}
.purple{color:#600060}
.purple-background{background:#7d007d}
.red{color:#bf0000}
.red-background{background:#fa0000}
.silver{color:#909090}
.silver-background{background:#bcbcbc}
.teal{color:#006060}
.teal-background{background:#007d7d}
.white{color:#bfbfbf}
.white-background{background:#fafafa}
.yellow{color:#bfbf00}
.yellow-background{background:#fafa00}
span.icon>.fa{cursor:default}
a span.icon>.fa{cursor:inherit}
.admonitionblock td.icon [class^="fa icon-"]{font-size:2.5em;text-shadow:1px 1px 2px rgba(0,0,0,.5);cursor:default}
.admonitionblock td.icon .icon-note::before{content:"\f05a";color:#19407c}
.admonitionblock td.icon .icon-tip::before{content:"\f0eb";text-shadow:1px 1px 2px rgba(155,155,0,.8);color:#111}
.admonitionblock td.icon .icon-warning::before{content:"\f071";color:#bf6900}
.admonitionblock td.icon .icon-caution::before{content:"\f06d";color:#bf3400}
.admonitionblock td.icon .icon-important::before{content:"\f06a";color:#bf0000}
.conum[data-value]{display:inline-block;color:#fff!important;background:rgba(0,0,0,.8);border-radius:50%;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}
.conum[data-value] *{color:#fff!important}
.conum[data-value]+b{display:none}
.conum[data-value]::after{content:attr(data-value)}
pre .conum[data-value]{position:relative;top:-.125em}
b.conum *{color:inherit!important}
.conum:not([data-value]):empty{display:none}
dt,th.tableblock,td.content,div.footnote{text-rendering:optimizeLegibility}
h1,h2,p,td.content,span.alt,summary{letter-spacing:-.01em}
p strong,td.content strong,div.footnote strong{letter-spacing:-.005em}
p,blockquote,dt,td.content,span.alt,summary{font-size:1.0625rem}
p{margin-bottom:1.25rem}
.sidebarblock p,.sidebarblock dt,.sidebarblock td.content,p.tableblock{font-size:1em}
.exampleblock>.content{background:#fffef7;border-color:#e0e0dc;box-shadow:0 1px 4px #e0e0dc}
.print-only{display:none!important}
@page{margin:1.25cm .75cm}
@media print{*{box-shadow:none!important;text-shadow:none!important}
html{font-size:80%}
a{color:inherit!important;text-decoration:underline!important}
a.bare,a[href^="#"],a[href^="mailto:"]{text-decoration:none!important}
a[href^="http:"]:not(.bare)::after,a[href^="https:"]:not(.bare)::after{content:"(" attr(href) ")";display:inline-block;font-size:.875em;padding-left:.25em}
abbr[title]{border-bottom:1px dotted}
abbr[title]::after{content:" (" attr(title) ")"}
pre,blockquote,tr,img,object,svg{page-break-inside:avoid}
thead{display:table-header-group}
svg{max-width:100%}
p,blockquote,dt,td.content{font-size:1em;orphans:3;widows:3}
h2,h3,#toctitle,.sidebarblock>.content>.title{page-break-after:avoid}
#header,#content,#footnotes,#footer{max-width:none}
#toc,.sidebarblock,.exampleblock>.content{background:none!important}
#toc{border-bottom:1px solid #dddddf!important;padding-bottom:0!important}
body.book #header{text-align:center}
body.book #header>h1:first-child{border:0!important;margin:2.5em 0 1em}
body.book #header .details{border:0!important;display:block;padding:0!important}
body.book #header .details span:first-child{margin-left:0!important}
body.book #header .details br{display:block}
body.book #header .details br+span::before{content:none!important}
body.book #toc{border:0!important;text-align:left!important;padding:0!important;margin:0!important}
body.book #toc,body.book #preamble,body.book h1.sect0,body.book .sect1>h2{page-break-before:always}
.listingblock code[data-lang]::before{display:block}
#footer{padding:0 .9375em}
.hide-on-print{display:none!important}
.print-only{display:block!important}
.hide-for-print{display:none!important}
.show-for-print{display:inherit!important}}
@media amzn-kf8,print{#header>h1:first-child{margin-top:1.25rem}
.sect1{padding:0!important}
.sect1+.sect1{border:0}
#footer{background:none}
#footer-text{color:rgba(0,0,0,.6);font-size:.9em}}
@media amzn-kf8{#header,#content,#footnotes,#footer{padding:0}}
</style>
</head>
<body class="article data-line-1">
<div id="header">
</div>
<div id="content">
<div class="sect1 data-line-2">
<h2 id="mining">Minage et Consensus</h2>
<div class="sectionbody">
<div class="sect2 data-line-5">
<h3 id="_présentation">Présentation</h3>
<div class="paragraph data-line-7">
<p>Le mot &quot;exploitation minière&quot; est quelque peu trompeur. En évoquant l&#39;extraction de métaux précieux, il focalise notre attention sur la récompense du minage, le nouveau bitcoin créé dans chaque bloc. Bien que l&#39;exploitation minière soit incitée par cette récompense, l&#39;objectif principal de l&#39;exploitation minière n&#39;est pas la récompense ou la génération de nouvelles pièces. Si vous considérez l&#39;exploitation minière uniquement comme le processus par lequel les pièces sont créées, vous confondez les moyens (incitations) avec le but du processus. Le minage est le mécanisme qui sous-tend la chambre de compensation décentralisée, par laquelle les transactions sont validées et compensées. Le minage est l&#39;invention qui rend le bitcoin spécial, un mécanisme de sécurité décentralisé qui est à la base de l&#39;argent numérique P2P.</p>
</div>
<div class="paragraph data-line-9">
<p>L&#39;exploitation minière <em>sécurise le système Bitcoin</em> et permet l&#39;émergence d&#39;un <em>consensus à l&#39;échelle du réseau sans autorité centrale</em>.  La récompense des pièces nouvellement frappées et des frais de transaction est un système d&#39;incitation qui aligne les actions des mineurs sur la sécurité du réseau, tout en mettant en œuvre simultanément l&#39;offre monétaire.</p>
</div>
<div class="exampleblock data-line-12">
<div class="content">
<div class="paragraph data-line-13">
<p>Le but du minage n&#39;est pas la création de nouveaux bitcoins. C&#39;est le système d&#39;incitation. Le minage est le mécanisme par lequel la <em>sécurité</em> du bitcoin est <em>décentralisée</em>.</p>
</div>
</div>
</div>
<div class="paragraph data-line-16">
<p>Les mineurs valident les nouvelles transactions et les enregistrent dans le grand livre mondial. Un nouveau bloc, contenant les transactions qui se sont produites depuis le dernier bloc, est &quot;miné&quot; toutes les 10 minutes en moyenne, ajoutant ainsi ces transactions à la blockchain. Les transactions qui font partie d&#39;un bloc et ajoutées à la blockchain sont considérées comme &quot;confirmées&quot;, ce qui permet aux nouveaux propriétaires de bitcoin de dépenser le bitcoin qu&#39;ils ont reçu dans ces transactions.</p>
</div>
<div class="paragraph data-line-18">
<p> Les mineurs reçoivent deux types de récompenses en échange de la sécurité fournie par le minage : de nouvelles pièces créées avec chaque nouveau bloc, également appelées <em>récompense de bloc</em> ou <em>récompense de coinbase</em>, et les frais de transaction de toutes les transactions incluses dans le bloc. Pour gagner cette récompense, les mineurs s&#39;affrontent pour résoudre un problème mathématique difficile basé sur un algorithme de hachage cryptographique. La solution au problème, appelée Proof-of-Work, est incluse dans le nouveau bloc et agit comme preuve que le mineur a déployé des efforts informatiques importants. La compétition pour résoudre l&#39;algorithme Proof-of-Work pour gagner la récompense et le droit d&#39;enregistrer les transactions sur la blockchain est la base du modèle de sécurité de Bitcoin.</p>
</div>
<div class="paragraph data-line-20">
<p>Le processus est appelé minage parce que la récompense (nouvelle génération de pièces) est conçue pour simuler des rendements décroissants, tout comme le minage de métaux précieux. La masse monétaire de Bitcoin est créée par l&#39;exploitation minière, de la même manière qu&#39;une banque centrale émet de la nouvelle monnaie en imprimant des billets de banque. La quantité maximale de bitcoins nouvellement créés qu&#39;un mineur peut ajouter à un bloc diminue environ tous les quatre ans (ou précisément tous les 210 000 blocs). Il a commencé à 50 bitcoins par bloc en janvier 2009 et a été réduit de moitié à 25 bitcoins par bloc en novembre 2012. Il a été réduit de moitié à 12,5 bitcoins en juillet 2016 et de nouveau à 6,25 bitcoins en mai 2020. Sur la base de cette formule, les récompenses de minage de bitcoins diminuent de façon exponentielle. jusqu&#39;à environ l&#39;an 2140, lorsque tous les bitcoins (20,99999998 millions) auront été émis. Après 2140, aucun nouveau bitcoin ne sera émis.</p>
</div>
<div class="paragraph data-line-22">
<p>Les mineurs de Bitcoin gagnent également des frais sur les transactions. Chaque transaction comprend généralement des frais de transaction, sous la forme d&#39;un surplus de bitcoin entre les entrées et les sorties de la transaction. Le mineur de bitcoin gagnant peut &quot;garder la monnaie&quot; sur les transactions incluses dans le bloc gagnant. Aujourd&#39;hui, les frais représentent 0,5% ou moins des revenus d&#39;un mineur de bitcoin, la grande majorité provenant du bitcoin nouvellement créé. Cependant, à mesure que la récompense de bloc diminue avec le temps et que le nombre de transactions par bloc augmente, une plus grande proportion des revenus de minage de bitcoins proviendra des frais. Progressivement, la récompense minière sera dominée par les frais de transaction, qui constitueront la principale incitation pour les mineurs. Après 2140, la quantité de nouveaux bitcoins dans chaque bloc tombe à zéro et l&#39;extraction de bitcoins ne sera encouragée que par les frais de transaction.</p>
</div>
<div class="paragraph data-line-24">
<p>Dans ce chapitre, nous examinerons d&#39;abord l&#39;exploitation minière en tant que mécanisme d&#39;approvisionnement monétaire, puis nous examinerons la fonction la plus importante de l&#39;exploitation minière : le mécanisme de consensus décentralisé qui sous-tend la sécurité du bitcoin.</p>
</div>
<div class="paragraph data-line-26">
<p>Pour comprendre l&#39;exploitation minière et le consensus, nous suivrons la transaction d&#39;Alice telle qu&#39;elle est reçue et ajoutée à un bloc par l&#39;équipement minier de Jing. Ensuite, nous suivrons le bloc tel qu&#39;il est extrait, ajouté à la blockchain et accepté par le réseau Bitcoin à travers le processus de consensus émergent.</p>
</div>
<div class="sect3 data-line-28">
<h4 id="_économie_bitcoin_et_création_de_devises">Économie Bitcoin et création de devises</h4>
<div class="paragraph data-line-30">
<p>Bitcoin sont &quot;frappés&quot; lors de la création de chaque bloc à un taux fixe et décroissant. Chaque bloc, généré en moyenne toutes les 10 minutes, contient des bitcoins entièrement nouveaux, créés à partir de rien. Tous les 210 000 blocs, soit environ tous les quatre ans, le taux d&#39;émission des devises est diminué de 50 %. Pendant les quatre premières années de fonctionnement du réseau, chaque bloc contenait 50 nouveaux bitcoins.</p>
</div>
<div class="paragraph data-line-32">
<p>En novembre 2012, le nouveau taux d&#39;émission de bitcoins a été réduit à 25 bitcoins par bloc. En juillet 2016, il a été réduit à 12,5 bitcoins par bloc, et en mai 2020, il a de nouveau été réduit à 6,25 bitcoins par bloc. Le taux de nouvelles pièces diminue ainsi de manière exponentielle sur 32 &quot;halvings&quot; jusqu&#39;au bloc 6 720 000 (miné environ en 2137), lorsqu&#39;il atteint l&#39;unité monétaire minimale de 1 satoshi. Enfin, après 6,93 millions de blocs, en 2140 environ, près de 2 099 999 997 690 000 satoshis, soit près de 21 millions de bitcoins, seront émis. Par la suite, les blocs ne contiendront plus de nouveaux bitcoins et les mineurs seront récompensés uniquement par les frais de transaction. &lt;&lt;bitcoin_money_supply&gt; &gt; montre le bitcoin total en circulation au fil du temps, à mesure que l&#39;émission de devises diminue.</p>
</div>
<div id="bitcoin_money_supply" class="dlist data-line-36">
<div class="title">Offre de monnaie bitcoin au fil du temps basée sur un taux d&#39;émission géométriquement décroissant</div>
<dl>
<dt class="hdlist1">image </dt>
<dd>
<p>images/mbc2_1001.png[&quot;BitcoinMoneySupply&quot;]</p>
</dd>
</dl>
</div>
<div class="exampleblock data-line-39">
<div class="content">
<div class="paragraph data-line-40">
<p>Le nombre maximum de pièces minées est la <em>limite supérieure</em> des récompenses minières possibles pour le bitcoin. En pratique, un mineur peut intentionnellement exploiter un bloc en prenant moins que la récompense complète. Ces blocs ont déjà été extraits et d&#39;autres pourraient l&#39;être à l&#39;avenir, ce qui entraînerait une émission totale inférieure de la monnaie.</p>
</div>
</div>
</div>
<div class="paragraph data-line-43">
<p>Dans l&#39;exemple de code dans &lt;&lt;max_money&gt; &gt;, nous calculons le montant total de bitcoin qui sera émis.</p>
</div>
<div id="max_money" class="exampleblock data-line-47">
<div class="title">Example 1. Un script pour calculer la quantité totale de bitcoins qui sera émise</div>
<div class="content">
<div class="listingblock data-line-49">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">inclure::code/max_money.py[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-54">
<p>&lt;&lt;max_money_run&gt; &gt; affiche la sortie produite en exécutant ce script.</p>
</div>
<div id="max_money_run" class="exampleblock data-line-58">
<div class="title">Example 2. Exécuter le script max_money.py</div>
<div class="content">
<div class="listingblock data-line-60">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ python max_money.py
Total BTC à créer : 2100000000000000.0 Satoshis</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-66">
<p>L&#39;émission finie et décroissante crée une masse monétaire fixe qui résiste à l&#39;inflation. Contrairement à une monnaie fiduciaire, qui peut être imprimée en nombre infini par une banque centrale, le bitcoin ne peut jamais être gonflé par l&#39;impression.</p>
</div>
<div class="sidebarblock data-line-69">
<div class="content">
<div class="title">Argent déflationniste</div>
<div class="paragraph data-line-70">
<p> La conséquence la plus importante et la plus débattue d&#39;une émission monétaire fixe et décroissante est que la monnaie a tendance à être intrinsèquement déflationniste. La déflation est le phénomène d&#39;appréciation de la valeur due à une inadéquation entre l&#39;offre et la demande qui fait monter la valeur (et le taux de change) d&#39;une monnaie. Le contraire de l&#39;inflation, la déflation des prix, signifie que l&#39;argent a plus de pouvoir d&#39;achat au fil du temps.</p>
</div>
<div class="paragraph data-line-72">
<p>De nombreux économistes soutiennent qu&#39;une économie déflationniste est une catastrophe qu&#39;il faut éviter à tout prix. En effet, en période de déflation rapide, les gens ont tendance à accumuler de l&#39;argent au lieu de le dépenser, en espérant que les prix chuteront. Un tel phénomène s&#39;est déroulé au cours de la « décennie perdue » du Japon, lorsqu&#39;un effondrement complet de la demande a poussé la monnaie dans une spirale déflationniste.</p>
</div>
<div class="paragraph data-line-74">
<p>Les experts du Bitcoin affirment que la déflation n&#39;est pas mauvaise en soi. La déflation est plutôt associée à un effondrement de la demande car c&#39;est le seul exemple de déflation que nous ayons à étudier. Dans une monnaie fiduciaire avec possibilité d&#39;impression illimitée, il est très difficile d&#39;entrer dans une spirale déflationniste à moins qu&#39;il n&#39;y ait un effondrement complet de la demande et une réticence à imprimer de l&#39;argent. La déflation du bitcoin n&#39;est pas causée par un effondrement de la demande, mais par une offre limitée de manière prévisible.</p>
</div>
<div class="paragraph data-line-76">
<p>L&#39;aspect positif de la déflation, bien sûr, c&#39;est qu&#39;elle est le contraire de l&#39;inflation. L&#39;inflation provoque une dépréciation lente mais inévitable de la monnaie, se traduisant par une forme de taxation cachée qui punit les épargnants afin de renflouer les débiteurs (y compris les plus gros débiteurs, les gouvernements eux-mêmes). Les monnaies sous contrôle gouvernemental souffrent de l&#39;aléa moral d&#39;une émission facile de dette qui peut ensuite être effacée par la dépréciation aux dépens des épargnants.</p>
</div>
<div class="paragraph data-line-78">
<p>Il reste à voir si l&#39;aspect déflationniste de la monnaie est un problème lorsqu&#39;il n&#39;est pas entraîné par une rétraction économique rapide, ou un avantage parce que la protection contre l&#39;inflation et l&#39;avilissement l&#39;emporte largement sur les risques de déflation.</p>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-81">
<h3 id="_consensus_décentralisé">Consensus décentralisé</h3>
<div class="paragraph data-line-83">
<p> Dans le chapitre précédent, nous avons examiné la blockchain, le registre public mondial (liste) de tous transactions, que tout le monde dans le réseau Bitcoin accepte comme enregistrement de propriété faisant autorité.</p>
</div>
<div class="paragraph data-line-85">
<p>Mais comment tout le monde dans le réseau peut-il s&#39;entendre sur une seule « vérité » universelle sur qui possède quoi, sans avoir à faire confiance à personne ? Tous les systèmes de paiement traditionnels dépendent d&#39;un modèle de confiance qui a une autorité centrale fournissant un service de chambre de compensation, vérifiant et compensant essentiellement toutes les transactions. Bitcoin n&#39;a pas d&#39;autorité centrale, mais d&#39;une manière ou d&#39;une autre, chaque nœud complet possède une copie complète d&#39;un grand livre public auquel il peut faire confiance en tant qu&#39;enregistrement faisant autorité. La blockchain n&#39;est pas créée par une autorité centrale, mais est assemblée indépendamment par chaque nœud du réseau. D&#39;une manière ou d&#39;une autre, chaque nœud du réseau, agissant sur les informations transmises via des connexions réseau non sécurisées, peut arriver à la même conclusion et assembler une copie du même registre public que tout le monde. Ce chapitre examine le processus par lequel le réseau Bitcoin parvient à un consensus mondial sans autorité centrale.</p>
</div>
<div class="paragraph data-line-87">
<p>La principale invention de Satoshi Nakamoto est le mécanisme décentralisé de <em>consensus émergent</em>. Emergent, parce que le consensus n&#39;est pas atteint explicitement - il n&#39;y a pas d&#39;élection ou de moment fixe où le consensus se produit. Au lieu de cela, le consensus est un artefact émergent de l&#39;interaction asynchrone de milliers de nœuds indépendants, qui suivent tous des règles simples. Toutes les propriétés du bitcoin, y compris la monnaie, les transactions, les paiements et le modèle de sécurité qui ne dépend pas de l&#39;autorité centrale ou de la confiance, découlent de cette invention.</p>
</div>
<div class="paragraph data-line-89">
<p>Le consensus décentralisé de Bitcoin émerge de l&#39;interaction de quatre processus qui se produisent indépendamment sur les nœuds du réseau :</p>
</div>
<div class="ulist &quot;pagebreak-before&quot; data-line-92">
<ul>
<li class="data-line-92">
<p>Vérification indépendante de chaque transaction, par chaque nœud complet, sur la base d&#39;une liste complète de critères</p>
</li>
<li class="data-line-93">
<p>Agrégation indépendante de ces transactions dans de nouveaux blocs par des nœuds de minage, associée à un calcul démontré via un algorithme de preuve de travail</p>
</li>
<li class="data-line-94">
<p>Vérification indépendante des nouveaux blocs par chaque nœud et assemblage dans une chaîne</p>
</li>
<li class="data-line-95">
<p>Sélection indépendante, par chaque nœud, de la chaîne avec le calcul le plus cumulatif démontré par la preuve de travail</p>
</li>
</ul>
</div>
<div class="paragraph data-line-97">
<p>Dans les prochaines sections, nous examinerons ces processus et la manière dont ils interagissent pour créer la propriété émergente du consensus à l&#39;échelle du réseau qui permet à n&#39;importe quel nœud Bitcoin d&#39;assembler sa propre copie du grand livre public mondial faisant autorité.</p>
</div>
</div>
<div class="sect2 data-line-100">
<h3 id="tx_verification">Vérification indépendante des transactions</h3>
<div class="paragraph data-line-102">
<p>Dans &lt;&lt;transactions&gt; &gt;, nous avons vu comment un logiciel de portefeuille crée des transactions en collectant des UTXO, en fournissant les scripts de déverrouillage appropriés, puis en construisant de nouvelles sorties attribuées à un nouveau propriétaire. La transaction résultante est ensuite envoyée aux nœuds voisins du réseau Bitcoin afin qu&#39;elle puisse être propagée sur l&#39;ensemble du réseau Bitcoin.</p>
</div>
<div class="paragraph data-line-104">
<p>Cependant, avant de transmettre les transactions à ses voisins, chaque nœud Bitcoin qui reçoit une transaction vérifiera d&#39;abord la transaction. Cela garantit que seules les transactions valides sont propagées sur le réseau, tandis que les transactions non valides sont rejetées au premier nœud qui les rencontre.</p>
</div>
<div class="paragraph data-line-106">
<p>Chaque nœud vérifie chaque transaction par rapport à une longue liste de critères :</p>
</div>
<div class="ulist data-line-108">
<ul>
<li class="data-line-108">
<p>La syntaxe et la structure des données de la transaction doivent être correctes.</p>
</li>
<li class="data-line-109">
<p>Ni les listes d&#39;entrées ni de sorties ne sont vides.</p>
</li>
<li class="data-line-110">
<p>La taille de la transaction est inférieure à la taille maximale autorisée pour un bloc excluant les données témoins, comme indiqué dans <a href="https://bit.ly/3t623VL" data-href="https://bit.ly/3t623VL"><em>tx_check.cpp</em></a>.</p>
</li>
<li class="data-line-111">
<p>Chaque valeur de sortie, ainsi que le total, doit être dans la plage de valeurs autorisée (moins de 21 millions de pièces, plus que le seuil de <em>poussière</em>).</p>
</li>
<li class="data-line-112">
<p>Aucune des entrées n&#39;a hash=0, N=–1 (les transactions coinbase ne doivent pas être relayées).</p>
</li>
<li class="data-line-113">
<p>nLocktime est égal à INT_MAX, ou les valeurs nLocktime et nSequence sont satisfaites selon MedianTimePast.</p>
</li>
<li class="data-line-114">
<p>La taille de la transaction en octets est supérieure ou égale à 82.</p>
</li>
<li class="data-line-115">
<p>Le nombre d&#39;opérations de signature (SIGOPS) contenues dans la transaction est inférieur à la limite d&#39;opérations de signature.</p>
</li>
<li class="data-line-116">
<p>Le script de déverrouillage (scriptSig) ne peut pousser que des nombres sur la pile, et le script de verrouillage (scriptPubkey) doit correspondre aux formes IsStandard (cela rejette les transactions &quot;non standard&quot;).</p>
</li>
<li class="data-line-117">
<p>Une transaction correspondante dans le pool ou dans un bloc de la branche principale doit exister.</p>
</li>
<li class="data-line-118">
<p>Pour chaque entrée, si la sortie référencée existe dans une autre transaction du pool, la transaction doit être rejetée.</p>
</li>
<li class="data-line-119">
<p>Pour chaque entrée, regardez dans la branche principale et le pool de transactions pour trouver sa transaction parente. Si la transaction parent est manquante pour une entrée, il s&#39;agira d&#39;une transaction orpheline. Ajouter au pool de transactions orphelines, si une transaction correspondante n&#39;est pas déjà dans le pool.</p>
</li>
<li class="data-line-120">
<p>Pour chaque entrée, si sa transaction parente est une transaction coinbase, elle doit avoir au moins COINBASE_MATURITY (100) confirmations.</p>
</li>
<li class="data-line-121">
<p>Pour chaque entrée, la sortie référencée doit exister et ne peut pas déjà être dépensée.</p>
</li>
<li class="data-line-122">
<p>En utilisant les transactions parentes pour obtenir les valeurs d&#39;entrée, vérifiez que chaque valeur d&#39;entrée, ainsi que la somme, se situent dans la plage de valeurs autorisée (moins de 21 millions de pièces, plus de 0).</p>
</li>
<li class="data-line-123">
<p>Rejeter si la somme des valeurs d&#39;entrée est inférieure à la somme des valeurs de sortie.</p>
</li>
<li class="data-line-124">
<p>Rejeter si les frais de transaction seraient trop bas (minRelayTxFee) pour entrer dans un bloc vide.</p>
</li>
<li class="data-line-125">
<p>Les scripts de déverrouillage pour chaque entrée doivent être validés par rapport aux scripts de verrouillage de sortie correspondants.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-127">
<p>Ces conditions peuvent être vues en détail dans les fonctions AcceptToMemoryPool, CheckTransaction et CheckInputs dans Bitcoin Core. Notez que les conditions changent avec le temps, pour faire face à de nouveaux types d&#39;attaques par déni de service ou parfois pour assouplir les règles afin d&#39;inclure davantage de types de transactions.</p>
</div>
<div class="paragraph data-line-129">
<p>En vérifiant indépendamment chaque transaction lors de sa réception et avant de la propager, chaque nœud crée un pool de transactions valides (mais non confirmées) connu sous le nom de <em>transaction pool</em>, <em>memory pool</em> ou <em>mempool</em>.</p>
</div>
</div>
<div class="sect2 data-line-131">
<h3 id="_nœuds_miniers">Nœuds miniers</h3>
<div class="paragraph data-line-133">
<p>Certains des nœuds du réseau Bitcoin sont des nœuds spécialisés appelés <em>miners</em>. Dans &lt;&lt;ch01_intro_what_is_bitcoin&gt; &gt; nous avons présenté Jing, un étudiant en génie informatique à Shanghai, en Chine, qui est un mineur de bitcoin. Jing gagne du bitcoin en exécutant une &quot;plate-forme minière&quot;, qui est un système informatique spécialisé conçu pour exploiter le bitcoin. Le matériel minier spécialisé de Jing est connecté à un serveur exécutant un nœud Bitcoin complet. Contrairement à Jing, certains mineurs minent sans nœud complet, comme nous le verrons dans &lt;&lt;mining_pools&gt; &gt;. Comme tous les autres nœuds complets, le nœud de Jing reçoit et propage les transactions non confirmées sur le réseau Bitcoin. Le nœud de Jing, cependant, agrège également ces transactions dans de nouveaux blocs.</p>
</div>
<div class="paragraph data-line-135">
<p>Le nœud de Jing est à l&#39;écoute de nouveaux blocs, propagés sur le réseau Bitcoin, comme tous les nœuds. Cependant, l&#39;arrivée d&#39;un nouveau bloc a une signification particulière pour un nœud minier. La compétition entre mineurs se termine effectivement par la propagation d&#39;un nouveau bloc qui fait office d&#39;annonce d&#39;un gagnant. Pour les mineurs, recevoir un nouveau bloc valide signifie que quelqu&#39;un d&#39;autre a gagné la compétition et qu&#39;il a perdu. Cependant, la fin d&#39;un tour d&#39;une compétition est aussi le début du tour suivant. Le nouveau bloc n&#39;est pas seulement un drapeau à damier, marquant la fin de la course ; c&#39;est aussi le pistolet de départ dans la course pour le bloc suivant.</p>
</div>
</div>
<div class="sect2 data-line-137">
<h3 id="_agréger_les_transactions_en_blocs">Agréger les transactions en blocs</h3>
<div class="paragraph data-line-139">
<p> Après avoir validé les transactions, un nœud Bitcoin les ajoutera au <em>memory pool</em>, ou <em>transaction pool</em>, où les transactions attendent jusqu&#39;à ce qu&#39;elles puissent être incluses (exploitées) dans un bloc. Le nœud de Jing collecte, valide et relaie les nouvelles transactions comme n&#39;importe quel autre nœud. Contrairement aux autres nœuds, cependant, le nœud de Jing regroupera ensuite ces transactions dans un <em>bloc candidat</em>.</p>
</div>
<div class="paragraph data-line-141">
<p>Suivons les blocs qui ont été créés à l&#39;époque où Alice achetait une tasse de café au Bob&#39;s Cafe (voir &lt;&lt;cup_of_coffee&gt; &gt;). La transaction d&#39;Alice a été incluse dans le bloc 277 316. Dans le but de démontrer les concepts de ce chapitre, supposons que ce bloc a été miné par le système de minage de Jing et suivons la transaction d&#39;Alice au fur et à mesure qu&#39;elle fait partie de ce nouveau bloc.</p>
</div>
<div class="paragraph data-line-143">
<p>Le nœud minier de Jing maintient une copie locale de la blockchain. Au moment où Alice achète la tasse de café, le nœud de Jing a assemblé une chaîne jusqu&#39;au bloc 277 314. Le nœud de Jing écoute les transactions, essaie d&#39;extraire un nouveau bloc et écoute également les blocs découverts par d&#39;autres nœuds. Comme le nœud de Jing est en train d&#39;exploiter, il reçoit le bloc 277 315 via le réseau Bitcoin. L&#39;arrivée de ce bloc signifie la fin de la compétition pour le bloc 277,315 et le début de la compétition pour créer le bloc 277,316.</p>
</div>
<div class="paragraph data-line-145">
<p>Au cours des 10 minutes précédentes, alors que le nœud de Jing cherchait une solution pour bloquer 277 315, il collectait également des transactions en vue du bloc suivant. À ce jour, il a collecté quelques centaines de transactions dans le pool de mémoire. Lors de la réception du bloc 277,315 et de sa validation, le nœud de Jing le comparera également à toutes les transactions du pool de mémoire et supprimera celles qui étaient incluses dans le bloc 277,315. Quelles que soient les transactions restantes dans le pool de mémoire, elles ne sont pas confirmées et attendent d&#39;être enregistrées dans un nouveau bloc.</p>
</div>
<div class="paragraph data-line-147">
<p>Le nœud de Jing construit immédiatement un nouveau bloc vide, un candidat pour le bloc 277 316. Ce bloc est appelé <em>bloc candidat</em> car ce n&#39;est pas encore un bloc valide, car il ne contient pas de preuve de travail valide. Le bloc ne devient valide que si le mineur réussit à trouver une solution à l&#39;algorithme Proof-of-Work.</p>
</div>
<div class="paragraph data-line-149">
<p>Lorsque le nœud de Jing regroupe toutes les transactions du pool de mémoire, le nouveau bloc candidat contient 418 transactions avec des frais de transaction totaux de 0,09094928 bitcoin. Vous pouvez voir ce bloc dans la blockchain à l&#39;aide de l&#39;interface de ligne de commande du client Bitcoin Core, comme indiqué dans &lt;&lt;block277316&gt; &gt;.</p>
</div>
<div id="block277316" class="exampleblock data-line-153">
<div class="title">Example 3. Utiliser la ligne de commande pour récupérer le bloc 277,316</div>
<div class="content">
<div class="listingblock data-line-155">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ bitcoin-cli getblockhash 277316

0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4

$ bitcoin-cli getblock 0000000000000001b6b9a13b095e96db41c4a928b97ef2d9\
44a9b31b2cc7bdc4</code></pre>
</div>
</div>
<div class="listingblock data-line-166">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    &amp;quot;hachage&amp;quot; : &amp;quot;0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4&amp;quot;,
    &amp;quot;confirmations&amp;quot; : 35561,
    &amp;quot;taille&amp;quot; : 218629,
    &amp;quot;hauteur&amp;quot; : 277316,
    &amp;quot;version 2,
    &amp;quot;merkleroot&amp;quot; : &amp;quot;c91c008c26e50763e9f548bb8b2fc323735f73577effbc55502c51eb4cc7cf2e&amp;quot;,
    &amp;quot;tx&amp;quot; : [
        &amp;quot;d5ada064c6417ca25c4308bd158c34b77e1c0eca2a73cda16c737e7424afba2f&amp;quot;,
        &amp;quot;b268b45c59b39d759614757718b9918caf0ba9d97c56f3b91956ff877c503fbe&amp;quot;,

        ... 417 transactions supplémentaires ...

       ],
    &amp;quot;heure&amp;quot; : 1388185914,
    &amp;quot;nonce&amp;quot; : 924591752,
    &amp;quot;bits&amp;quot; : &amp;quot;1903a30c&amp;quot;,
    &amp;quot;difficulté&amp;quot; : 1180923195.25802612,
    &amp;quot;chaînette&amp;quot; : &amp;quot;00000000000000000000000000000000000000000934695e92aaf53afa1a&amp;quot;,
    &amp;quot;hachage de bloc précédent&amp;quot; : &amp;quot;0000000000000002a7bbd25a417c0374cc55261021e8a9ca74442b01284f0569&amp;quot;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="sect3 data-line-191">
<h4 id="_la_transaction_coinbase">La transaction Coinbase</h4>
<div class="paragraph data-line-193">
<p>La première transaction d&#39;un bloc est une transaction spéciale, appelée <em>coinbase transaction</em>. Cette transaction est construite par le nœud de Jing et contient sa <em>récompense</em> pour l&#39;effort de minage.</p>
</div>
<div class="exampleblock data-line-196">
<div class="content">
<div class="paragraph data-line-197">
<p>Lorsque le bloc 277 316 a été miné, la récompense était de 25 bitcoins par bloc. Depuis, deux périodes de &quot;halving&quot; se sont écoulées. La récompense globale est passée à 12,5 bitcoins en juillet 2016 et à 6,25 bitcoins en mai 2020.</p>
</div>
</div>
</div>
<div class="paragraph data-line-200">
<p>Le nœud de Jing crée la transaction coinbase en tant que paiement sur son propre portefeuille : &quot;Pay Jing&#39;s address 25.09094928 bitcoin.&quot; Le montant total de la récompense que Jing collecte pour l&#39;extraction d&#39;un bloc est la somme de la récompense coinbase (25 nouveaux bitcoins) et des frais de transaction (0,09094928) de toutes les transactions incluses dans le bloc, comme indiqué dans &lt;&lt;generation_tx_example&gt; &gt;.</p>
</div>
<div id="generation_tx_example" class="paragraph data-line-204">
<p>Transaction .Coinbase</p>
</div>
<div class="exampleblock data-line-205">
<div class="content">
<div class="listingblock data-line-206">
<div class="content">
<pre>$ bitcoin-cli getrawtransaction d5ada064c6417ca25c4308bd158c34b77e1c0eca2a73cda16c737e7424afba2f 1</pre>
</div>
</div>
<div class="listingblock &quot;c_less_space&quot; data-line-212">
<div class="content">
<pre class="highlight"><code class="language-json" data-lang="json">{
    &amp;quot;Hex&amp;quot;: &amp;quot;01000000010000000000000000000000000000000000000000000000000000000000000000ffffffff0f03443b0403858402062f503253482fffffffff0110c08d9500000000232102aa970c592640d19de03ff6f329d6fd2eecb023263b9ba5d1b81c29b523da8b21ac00000000&amp;quot;,
    &amp;quot;txid&amp;quot; : &amp;quot;d5ada064c6417ca25c4308bd158c34b77e1c0eca2a73cda16c737e7424afba2f&amp;quot;,
    &amp;quot;version 1,
    &amp;quot;temps de verrouillage&amp;quot; : 0,
    &amp;quot;vin&amp;quot; : [
        {
            &amp;quot;coinbase&amp;quot; : &amp;quot;03443b0403858402062f503253482f&amp;quot;,
            &amp;quot;séquence&amp;quot; : 4294967295
        }
    ],
    &amp;quot;vouter&amp;quot; : [
        {
            &amp;quot;valeur&amp;quot; : 25.09094928,
            &amp;quot;n&amp;quot; : 0,
            &amp;quot;scriptPubKey&amp;quot; : {
                &amp;quot;asm&amp;quot; : &amp;quot;02aa970c592640d19de03ff6f329d6fd2eecb023263b9ba5d1b81c29b523da8b21OP_CHECKSIG&amp;quot;,
                &amp;quot;hex&amp;quot; : &amp;quot;2102aa970c592640d19de03ff6f329d6fd2eecb023263b9ba5d1b81c29b523da8b21ac&amp;quot;,
                &amp;quot;reqSigs&amp;quot; : 1,
                &amp;quot;type&amp;quot; : &amp;quot;pubkey&amp;quot;,
                &amp;quot;adresses&amp;quot; : [
                    &amp;quot;1MxTkeEP2PmHSMze5tUZ1hAV3YTKu2Gh1N&amp;quot;
                ]
            }
        }
    ]
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-243">
<p>Contrairement aux transactions régulières, la transaction coinbase ne consomme pas (dépense) UTXO comme entrées. Au lieu de cela, il n&#39;a qu&#39;une seule entrée, appelée <em>coinbase</em>, qui crée du bitcoin à partir de rien. La transaction coinbase a une sortie, payable à la propre adresse Bitcoin du mineur. La sortie de la transaction coinbase envoie la valeur de 25,09094928 bitcoin à l&#39;adresse Bitcoin du mineur ; dans ce cas c&#39;est 1MxTkeEP2PmHSMze5tUZ1hAV3YTKu2Gh1N.</p>
</div>
</div>
<div class="sect3 data-line-245">
<h4 id="_récompense_et_frais_coinbase">Récompense et frais Coinbase</h4>
<div class="paragraph data-line-247">
<p> transaction coinbase, le nœud de Jing calcule d&#39;abord le montant total des frais de transaction en ajoutant toutes les entrées et sorties des 418 transactions qui ont été ajoutées au bloc. Les frais sont calculés comme suit :</p>
</div>
<div class="listingblock data-line-249">
<div class="content">
<pre>Frais totaux = Somme (entrées) - Somme (sorties)</pre>
</div>
</div>
<div class="paragraph data-line-253">
<p>Dans le bloc 277 316, le total des frais de transaction est de 0,09094928 bitcoin.</p>
</div>
<div class="paragraph data-line-255">
<p>Ensuite, le nœud de Jing calcule la récompense correcte pour le nouveau bloc. La récompense est calculée en fonction de la hauteur du bloc, à partir de 50 bitcoins par bloc et réduite de moitié tous les 210 000 blocs. Parce que ce bloc est à la hauteur 277 316, la récompense correcte est de 25 bitcoins.</p>
</div>
<div class="paragraph data-line-257">
<p>Le calcul peut être vu dans la fonction GetBlockSubsidy dans le client Bitcoin Core, comme indiqué dans &lt;&lt;getblocksubsidy_source&gt; &gt;.</p>
</div>
<div id="getblocksubsidy_source" class="exampleblock data-line-261">
<div class="title">Example 4. Calcul de la récompense de bloc—Fonction GetBlockSubsidy, Bitcoin Core Client, main.cpp</div>
<div class="content">
<div class="listingblock &quot;c_less_space&quot; data-line-264">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">CAmount GetBlockSubsidy(int nHeight, const Consensus ::Params&amp;amp; consensusParams)
{
    int halvings = nHeight / consensusParams.nSubsidyHalvingInterval ;
    // Force la récompense du bloc à zéro lorsque le décalage vers la droite n&amp;#39;est pas défini.
    si (moitiés &amp;gt;= 64)
        renvoie 0 ;

    CAmount nSubsidy = 50 * COIN ;
    // La subvention est réduite de moitié tous les 210 000 blocs, ce qui se produira environ tous les 4 ans.
    nSubvention &amp;gt;&amp;gt;= moitiés ;
    retourner nSubvention ;
}</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-280">
<p>La subvention initiale est calculée en satoshis en multipliant 50 par la constante COIN (100 000 000 satoshis). Cela fixe la récompense initiale (nSubsidy) à 5 milliards de satoshis.</p>
</div>
<div class="paragraph data-line-282">
<p>Ensuite, la fonction calcule le nombre de halvings qui se sont produits en divisant la hauteur actuelle du bloc par l&#39;intervalle de halving (SubsidyHalvingInterval). Dans le cas du bloc 277 316, avec un intervalle de moitié tous les 210 000 blocs, le résultat est 1 moitié.</p>
</div>
<div class="paragraph data-line-284">
<p>Le nombre maximum de moitiés autorisé est de 64, donc le code impose une récompense nulle (ne renvoie que les frais) si les 64 moitiés sont dépassées.</p>
</div>
<div class="paragraph data-line-286">
<p>Ensuite, la fonction utilise l&#39;opérateur binaire de décalage vers la droite pour diviser la récompense (nSubsidy) par deux pour chaque cycle de réduction de moitié. Dans le cas du bloc 277 316, cela entraînerait un décalage binaire vers la droite de la récompense de 5 milliards de satoshis une fois (une réduction de moitié) et donnerait 2,5 milliards de satoshis, soit 25 bitcoins. L&#39;opérateur de décalage binaire vers la droite est utilisé car il est plus efficace que plusieurs divisions répétées. Pour éviter un bogue potentiel, l&#39;opération de décalage est ignorée après 63 moitiés et la subvention est définie sur 0.</p>
</div>
<div class="paragraph data-line-288">
<p>Enfin, la récompense coinbase (nSubsidy) est ajoutée aux frais de transaction (nFees), et la somme est restituée.</p>
</div>
<div class="exampleblock data-line-291">
<div class="content">
<div class="paragraph data-line-292">
<p>Si le nœud minier de Jing écrit la transaction coinbase, qu&#39;est-ce qui empêche Jing de se &quot;récompenser&quot; lui-même 100 ou 1000 bitcoins ? La réponse est qu&#39;une récompense incorrecte aurait pour conséquence que le bloc serait considéré comme invalide par tout le monde, gaspillant l&#39;électricité de Jing utilisée pour la preuve de travail. Jing ne peut dépenser la récompense que si le blocage est accepté par tout le monde.</p>
</div>
</div>
</div>
</div>
<div class="sect3 data-line-295">
<h4 id="_structure_de_la_transaction_coinbase">Structure de la transaction Coinbase</h4>
<div class="paragraph data-line-297">
<p>Avec ces calculs, le nœud de Jing construit ensuite la transaction coinbase pour se payer 25,09094928 bitcoins.</p>
</div>
<div class="paragraph data-line-299">
<p>Comme vous pouvez le voir dans &lt;&lt;generation_tx_example&gt; &gt;, la transaction coinbase a un format spécial. Au lieu d&#39;une entrée de transaction spécifiant un UTXO précédent à dépenser, il a une entrée &quot;coinbase&quot;. Nous avons examiné les entrées de transaction dans &lt;&lt;tx_in_structure&gt; &gt;. Comparons une entrée de transaction régulière avec une entrée de transaction coinbase. &lt;&lt;table_8-1&gt; &gt; montre la structure d&#39;une entrée de transaction normale, tandis que &lt;&lt;table_8-2&gt; &gt; montre la structure de l&#39;entrée de la transaction coinbase.</p>
</div>
<table id="table_8-1" class="tableblock frame-all grid-all stretch data-line-304">
<caption class="title">Table 1. La structure d&#39;une entrée de transaction &quot;normale&quot;</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Champ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hachage de transaction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Pointeur vers la transaction contenant l&#39;UTXO à dépenser</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indice de sortie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Le numéro d&#39;index de l&#39;UTXO à dépenser, le premier est 0</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1–9 octets (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taille du script de déverrouillage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Longueur du script de déverrouillage en octets, à suivre</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Déverrouillage-Script</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un script remplissant les conditions du script de verrouillage UTXO</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numéro de séquence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Généralement défini sur 0xFFFFFFFF pour désactiver BIP 125 et BIP 68</p></td>
</tr>
</tbody>
</table>
<table id="table_8-2" class="tableblock frame-all grid-all stretch data-line-316">
<caption class="title">Table 2. La structure d&#39;une entrée de transaction coinbase</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Champ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hachage de transaction</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tous les bits sont à zéro : pas une référence de hachage de transaction</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Indice de sortie</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Tous les bits sont des uns : 0xFFFFFFFF</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">1–9 octets (VarInt)</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taille des données Coinbase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Longueur des données coinbase, de 2 à 100 octets</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">variables</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Données Coinbase</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Données arbitraires utilisées pour les nonce supplémentaires et les balises minières. Dans les blocs v2 ; doit commencer par la hauteur du bloc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Numéro de séquence</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Réglé sur 0xFFFFFFFF</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-325">
<p>Dans une transaction coinbase, les deux premiers champs sont définis sur des valeurs qui ne représentent pas une référence UTXO. Au lieu d&#39;un &quot;hachage de transaction&quot;, le premier champ est rempli de 32 octets tous mis à zéro. &quot;L&#39;index de sortie&quot; est rempli de 4 octets tous mis à 0xFF (255 décimal). Le &quot;Script de déverrouillage&quot; (scriptSig) est remplacé par les données coinbase, un champ de données utilisé par les mineurs, comme nous le verrons ensuite.</p>
</div>
</div>
<div class="sect3 data-line-327">
<h4 id="_données_coinbase">Données Coinbase</h4>
<div class="paragraph data-line-329">
<p>Les transactions Coinbase n&#39;ont pas de champ de script de déverrouillage (aka, scriptSig). Au lieu de cela, ce champ est remplacé par des données coinbase, qui doivent être comprises entre 2 et 100 octets. À l&#39;exception des premiers octets, le reste des données de coinbase peut être utilisé par les mineurs comme ils le souhaitent ; ce sont des données arbitraires.</p>
</div>
<div class="paragraph data-line-331">
<p>(&quot;bloc de genèse&quot; ) Dans le bloc de genèse, par exemple, Satoshi Nakamoto a ajouté le texte &quot;The Times 03/Jan/2009 Chancellor on bound of second bailout for banks&quot; dans les données coinbase, l&#39;utilisant comme preuve de la date et pour transmettre un message. Actuellement, les mineurs utilisent les données coinbase pour inclure des valeurs nonce supplémentaires et des chaînes identifiant le pool de minage.</p>
</div>
<div class="paragraph data-line-333">
<p>Les premiers octets de la coinbase étaient auparavant arbitraires, mais ce n&#39;est plus le cas. Conformément à BIP-34, les blocs de version 2 (blocs avec le champ de version défini sur 2) doivent contenir l&#39;index de hauteur de bloc en tant qu&#39;opération &quot;push&quot; de script au début du champ coinbase.</p>
</div>
<div class="paragraph data-line-335">
<p>Dans le bloc 277 316, nous voyons que la coinbase (voir &lt;&lt;generation_tx_example&gt; &gt;), qui se trouve dans le script de déverrouillage ou le champ scriptSig de l&#39;entrée de transaction, contient la valeur hexadécimale 03443b0403858402062f503253482f. Décodons cette valeur.</p>
</div>
<div class="paragraph data-line-337">
<p>Le premier octet, 03, indique au moteur d&#39;exécution de script de pousser les trois octets suivants sur la pile de script (voir &lt;&lt;tx_script_ops_table_pushdata&gt; &gt;). Les trois octets suivants, 0x443b04, sont la hauteur de bloc encodée au format little-endian (en arrière, octet le moins significatif en premier). Inversez l&#39;ordre des octets et le résultat est 0x043b44, soit 277 316 en décimal.</p>
</div>
<div class="paragraph data-line-339">
<p>Les quelques chiffres hexadécimaux suivants (0385840206) sont utilisés pour coder un <em>nonce</em> supplémentaire (voir &lt;&lt;extra_nonce&gt; &gt;), ou valeur aléatoire, utilisée pour trouver une solution de preuve de travail appropriée.</p>
</div>
<div class="paragraph data-line-341">
<p> &lt;span class="keep-together"&gt;&lt;code&gt;/P2SH/&lt;/code&gt;&lt;/span&gt; ], ce qui indique que le nœud de minage qui a miné ce bloc prend en charge l&#39;amélioration P2SH définie dans BIP-16. L&#39;introduction de la capacité P2SH a nécessité une signalisation par les mineurs pour approuver le BIP-16 ou le BIP-17. Ceux qui approuvaient la mise en œuvre du BIP-16 devaient inclure la chaîne /P2SH/ dans leurs données coinbase. Ceux qui approuvaient l&#39;implémentation BIP-17 de P2SH devaient inclure la chaîne p2sh/CHV dans leurs données coinbase. Enfin, le BIP-16 a été élu vainqueur, et de nombreux mineurs ont continué à inclure la chaîne /P2SH/ dans leur coinbase pour indiquer qu&#39;ils prennent en charge cette fonctionnalité.</p>
</div>
<div class="paragraph data-line-343">
<p>&lt;&lt;satoshi_words&gt; &gt; utilise la bibliothèque libbitcoin introduite dans &lt;&lt;alt_libraries&gt; &gt; pour extraire les données coinbase du bloc genesis, affichant le message de Satoshi. Notez que la bibliothèque libbitcoin contient une copie statique du bloc genesis, de sorte que l&#39;exemple de code peut récupérer le bloc genesis directement à partir de la bibliothèque.</p>
</div>
<div id="satoshi_words" class="exampleblock data-line-347">
<div class="title">Example 5. Extraire les données coinbase du bloc genesis</div>
<div class="content">
<div class="listingblock data-line-349">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">inclure::code/satoshi-words.cpp[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-354">
<p>Nous compilons le code avec le compilateur GNU C++ et exécutons l&#39;exécutable résultant, comme indiqué dans &lt;&lt;satoshi_words_run&gt; &gt;.</p>
</div>
<div id="satoshi_words_run" class="exampleblock data-line-358">
<div class="title">Example 6. Compilation et exécution de l&#39;exemple de code satoshi-words</div>
<div class="content">
<div class="listingblock data-line-360">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash"># Compiler le code
$ g++ -o satoshi-words satoshi-words.cpp $(pkg-config --cflags --libs libbitcoin)
# Lancer l&amp;#39;exécutable
$ ./mots satoshi
^D��&lt;GS&gt; ^A^DEThe Times 03/Jan/2009 La chancelière est sur le point de renflouer les banques</code></pre>
</div>
</div>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-369">
<h3 id="_construction_de_len_tête_de_bloc">Construction de l&#39;en-tête de bloc</h3>
<div class="paragraph data-line-371">
<p> Pour construire l&#39;en-tête de bloc, le nœud d&#39;exploration de données doit remplir six champs, comme indiqué dans &lt;&lt;block_header_structure_ch10&gt; &gt;.</p>
</div>
<table id="block_header_structure_ch10" class="tableblock frame-all grid-all stretch data-line-376">
<caption class="title">Table 3. La structure de l&#39;entête du bloc</caption>
<colgroup>
<col style="width: 33.3333%;">
<col style="width: 33.3333%;">
<col style="width: 33.3334%;">
</colgroup>
<tbody>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">Taille</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Champ</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La description</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Version</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un numéro de version pour suivre les mises à niveau du logiciel/protocole</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Hachage de bloc précédent</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Une référence au hachage du bloc précédent (parent) dans la chaîne</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">32 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Racine de Merkel</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un hachage de la racine de l&#39;arbre Merkle des transactions de ce bloc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Horodatage</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Le temps de création approximatif de ce bloc (secondes à partir d&#39;Unix Epoch)</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Cible</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">La cible de l&#39;algorithme de preuve de travail pour ce bloc</p></td>
</tr>
<tr>
<td class="tableblock halign-left valign-top"><p class="tableblock">4 octets</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Nonce</p></td>
<td class="tableblock halign-left valign-top"><p class="tableblock">Un compteur utilisé pour l&#39;algorithme Proof-of-Work</p></td>
</tr>
</tbody>
</table>
<div class="paragraph data-line-386">
<p>Au moment où le bloc 277 316 a été miné, le numéro de version décrivant la structure du bloc est la version 2, qui est codée au format petit-boutiste sur 4 octets sous la forme 0x02000000.</p>
</div>
<div class="paragraph data-line-388">
<p>Ensuite, le nœud de minage doit ajouter le &quot;Previous Block Hash&quot; (également appelé prevhash). C&#39;est le hachage de l&#39;en-tête de bloc du bloc 277,315, le bloc précédent reçu du réseau, que le nœud de Jing a accepté et sélectionné comme <em>parent</em> du bloc candidat 277,316. Le hachage d&#39;en-tête de bloc pour le bloc 277 315 est :</p>
</div>
<div class="listingblock data-line-390">
<div class="content">
<pre>0000000000000002a7bbd25a417c0374cc55261021e8a9ca74442b01284f0569</pre>
</div>
</div>
<div class="exampleblock data-line-395">
<div class="content">
<div class="paragraph data-line-396">
<p>En sélectionnant le bloc <em>parent</em> spécifique, indiqué par le champ Hash du bloc précédent dans l&#39;en-tête du bloc candidat, Jing engage sa puissance minière à étendre la chaîne qui se termine dans ce bloc spécifique. En substance, c&#39;est ainsi que Jing &quot;vote&quot; avec son pouvoir minier pour la chaîne valide la plus longue.</p>
</div>
</div>
</div>
<div class="paragraph data-line-399">
<p>L&#39;étape suivante consiste à résumer toutes les transactions avec un arbre merkle, afin d&#39;ajouter la racine merkle à la en-tête de bloc. La transaction coinbase est répertoriée comme la première transaction du bloc. Ensuite, 418 transactions supplémentaires sont ajoutées après, pour un total de 419 transactions dans le bloc. Comme nous l&#39;avons vu dans le &lt;&lt;merkle_trees&gt; &gt;, il doit y avoir un nombre pair de nœuds &quot;feuilles&quot; dans l&#39;arbre, donc la dernière transaction est dupliquée, créant 420 nœuds, chacun contenant le hachage d&#39;une transaction. Les hachages de transaction sont ensuite combinés, par paires, créant chaque niveau de l&#39;arbre, jusqu&#39;à ce que toutes les transactions soient résumées en un nœud à la &quot;racine&quot; de l&#39;arbre. La racine de l&#39;arborescence merkle résume toutes les transactions en une seule valeur de 32 octets, que vous pouvez voir répertoriée comme &quot;racine merkle&quot; dans &lt;&lt;block277316&gt; &gt;, et ici :</p>
</div>
<div class="listingblock data-line-401">
<div class="content">
<pre>c91c008c26e50763e9f548bb8b2fc323735f73577effbc55502c51eb4cc7cf2e</pre>
</div>
</div>
<div class="paragraph data-line-405">
<p>Le nœud minier de Jing ajoutera alors un horodatage de 4 octets, codé comme un horodatage &quot;d&#39;époque&quot; Unix, qui est basé sur le nombre de secondes écoulées depuis minuit UTC, le jeudi 1er janvier 1970. L&#39;heure 1388185914 est égale à vendredi , 27 décembre 2013, 23:11:54 UTC.</p>
</div>
<div class="paragraph data-line-407">
<p>Le nœud de Jing remplit ensuite la cible, qui définit la preuve de travail requise pour en faire un bloc valide. La cible est stockée dans le bloc en tant que métrique de &quot;bits cibles&quot;, qui est un codage d&#39;exposant de mantisse de la cible. Le codage a un exposant de 1 octet, suivi d&#39;une mantisse de 3 octets (coefficient). Dans le bloc 277 316, par exemple, la valeur des bits cibles est 0x1903a30c. La première partie 0x19 est un exposant hexadécimal, tandis que la partie suivante, 0x03a30c, est le coefficient. Le concept de cible est expliqué dans &lt;&lt;target&gt; &gt; et la représentation des &quot;bits cibles&quot; est expliquée dans &lt;&lt;target_bits&gt; &gt;.</p>
</div>
<div class="paragraph data-line-409">
<p>Le dernier champ est le nonce, qui est initialisé à zéro.</p>
</div>
<div class="paragraph data-line-411">
<p>Une fois tous les autres champs remplis, l&#39;en-tête du bloc est maintenant terminé et le processus d&#39;extraction peut commencer. L&#39;objectif est maintenant de trouver une valeur pour le nonce qui se traduit par un hachage d&#39;en-tête de bloc égal ou inférieur à la cible. Le nœud de minage devra tester des milliards ou des billions de valeurs de nonce avant de trouver un nonce qui réponde à l&#39;exigence.</p>
</div>
</div>
<div class="sect2 data-line-413">
<h3 id="_miner_le_bloc">Miner le bloc</h3>
<div class="paragraph data-line-415">
<p>Maintenant qu&#39;un bloc candidat a été construit par le nœud de Jing, il est temps pour la plate-forme de minage matériel de Jing de &quot;miner&quot; le bloc, pour trouver une solution à l&#39;algorithme de preuve de travail qui rend le bloc valide. Tout au long de ce livre, nous avons étudié les fonctions de hachage cryptographique utilisées dans divers aspects du système Bitcoin. La fonction de hachage SHA256 est la fonction utilisée dans le processus d&#39;extraction de bitcoin.</p>
</div>
<div class="paragraph data-line-417">
<p> Dans les termes les plus simples, le minage est le processus de hachage répété de l&#39;en-tête de bloc, en modifiant un paramètre, jusqu&#39;à ce que le hachage résultant corresponde à une cible spécifique. Le résultat de la fonction de hachage ne peut pas être déterminé à l&#39;avance, pas plus qu&#39;un modèle ne peut être créé qui produira une valeur de hachage spécifique. Cette caractéristique des fonctions de hachage signifie que la seule façon de produire un résultat de hachage correspondant à une cible spécifique est d&#39;essayer encore et encore, en modifiant de manière aléatoire l&#39;entrée jusqu&#39;à ce que le résultat de hachage souhaité apparaisse par hasard.</p>
</div>
<div class="sect3 data-line-419">
<h4 id="_algorithme_de_preuve_de_travail">Algorithme de preuve de travail</h4>
<div class="paragraph data-line-421">
<p>Un algorithme de hachage prend une entrée de données de longueur arbitraire et produit un résultat déterministe de longueur fixe, une empreinte numérique de l&#39;entrée. Pour toute entrée spécifique, le hachage résultant sera toujours le même et peut être facilement calculé et vérifié par toute personne mettant en œuvre le même algorithme de hachage. La principale caractéristique d&#39;un algorithme de hachage cryptographique est qu&#39;il est impossible de trouver deux entrées différentes qui produisent la même empreinte digitale (appelée <em>collision</em>). En corollaire, il est également pratiquement impossible de sélectionner une entrée de manière à produire une empreinte digitale souhaitée, autrement qu&#39;en essayant des entrées aléatoires.</p>
</div>
<div class="paragraph data-line-423">
<p>Avec SHA256, la sortie a toujours une longueur de 256 bits, quelle que soit la taille de l&#39;entrée. Dans &lt;&lt;sha256_example1&gt; &gt;, nous utiliserons l&#39;interpréteur Python pour calculer le hachage SHA256 de la phrase &quot;Je suis Satoshi Nakamoto&quot;.</p>
</div>
<div id="sha256_example1" class="paragraph data-line-426">
<p>Exemple .SHA256</p>
</div>
<div class="exampleblock data-line-427">
<div class="content">
<div class="listingblock data-line-429">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ python</code></pre>
</div>
</div>
<div class="listingblock data-line-433">
<div class="content">
<pre class="highlight"><code class="language-pycon" data-lang="pycon">Python 3.7.3
&amp;gt;&amp;gt;&amp;gt; importer hashlib
&amp;gt;&amp;gt;&amp;gt; hashlib.sha256(b&amp;quot;Je suis Satoshi Nakamoto&amp;quot;).hexdigest()
&amp;#39;5d7c7ba21cbbcd75d14800b100252d5b428e5b1213d27c385bc141ca6b47989e&amp;#39;</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-441">
<p>&lt;&lt;sha256_example1&gt; &gt; montre le résultat du calcul du hachage de &amp;quot;Je suis Satoshi Nakamoto&amp;quot; : 5d7c7ba21cbbcd75d14800b100252d5b428e5b1213d27c385bc141ca6b47989e. Ce nombre de 256 bits est le <em>hash</em> ou <em>digest</em> de la phrase et dépend de chaque partie de la phrase. L&#39;ajout d&#39;une seule lettre, d&#39;un signe de ponctuation ou de tout autre caractère produira un hachage différent.</p>
</div>
<div class="paragraph data-line-443">
<p>Maintenant, si nous changeons la phrase, nous devrions nous attendre à voir des hachages complètement différents. Essayons cela en ajoutant un nombre à la fin de notre phrase, en utilisant le script Python simple dans &lt;&lt;sha256_example_generator&gt; &gt;.</p>
</div>
<div id="sha256_example_generator" class="paragraph data-line-446">
<p>Script .SHA256 pour générer de nombreux hachages en itérant sur un nonce</p>
</div>
<div class="exampleblock data-line-447">
<div class="content">
<div class="listingblock &quot;c_less_space&quot; data-line-450">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">inclure::code/hash_example.py[]</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-455">
<p>L&#39;exécution de ceci produira les hachages de plusieurs phrases, rendues différentes en ajoutant un nombre à la fin du texte. En incrémentant le nombre, nous pouvons obtenir différents hachages, comme indiqué dans &lt;&lt;sha256_example_generator_output&gt; &gt;.</p>
</div>
<div id="sha256_example_generator_output" class="exampleblock data-line-459">
<div class="title">Example 7. SHA256 sortie d&#39;un script pour générer de nombreux hachages en itérant sur un nonce</div>
<div class="content">
<div class="listingblock data-line-461">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ python hash_example.py</code></pre>
</div>
</div>
<div class="listingblock data-line-465">
<div class="content">
<pre>Je suis Satoshi Nakamoto0 =&amp;gt; a80a81401765c8eddee25df36728d732...
Je suis Satoshi Nakamoto1 =&amp;gt; f7bc9a6304a4647bb41241a677b5345f...
Je suis Satoshi Nakamoto2 =&amp;gt; ea758a8134b115298a1583ffb80ae629...
Je suis Satoshi Nakamoto3 =&amp;gt; bfa9779618ff072c903d773de30c99bd...
Je suis Satoshi Nakamoto4 =&amp;gt; bce8564de9a83c18c31944a66bde992f...
Je suis Satoshi Nakamoto5 =&amp;gt; eb362c3cf3479be0a97a20163589038e...
Je suis Satoshi Nakamoto6 =&amp;gt; 4a2fd48e3be420d0d28e202360cfbaba...
Je suis Satoshi Nakamoto7 =&amp;gt; 790b5a1349a5f2b909bf74d0d166b17a...
Je suis Satoshi Nakamoto8 =&amp;gt; 702c45e5b15aa54b625d68dd947f1597...
Je suis Satoshi Nakamoto9 =&amp;gt; 7007cf7dd40f5e933cd89fff5b791ff0...
Je suis Satoshi Nakamoto10 =&amp;gt; c2f38c81992f4614206a21537bd634a...
Je suis Satoshi Nakamoto11 =&amp;gt; 7045da6ed8a914690f087690e1e8d66...
Je suis Satoshi Nakamoto12 =&amp;gt; 60f01db30c1a0d4cbce2b4b22e88b9b...
Je suis Satoshi Nakamoto13 =&amp;gt; 0ebc56d59a34f5082aaef3d66b37a66...
Je suis Satoshi Nakamoto14 =&amp;gt; 27ead1ca85da66981fd9da01a8c6816...
Je suis Satoshi Nakamoto15 =&amp;gt; 394809fb809c5f83ce97ab554a2812c...
Je suis Satoshi Nakamoto16 =&amp;gt; 8fa4992219df33f50834465d3047429...
Je suis Satoshi Nakamoto17 =&amp;gt; dca9b8b4f8d8e1521fa4eaa46f4f0cd...
Je suis Satoshi Nakamoto18 =&amp;gt; 9989a401b2a3a318b01e9ca9a22b0f3...
Je suis Satoshi Nakamoto19 =&amp;gt; cda56022ecb5b67b2bc93a2d764e75f...</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-489">
<p>Chaque phrase produit un résultat de hachage complètement différent. Ils semblent complètement aléatoires, mais vous pouvez reproduire les résultats exacts de cet exemple sur n&#39;importe quel ordinateur avec Python et voir les mêmes hachages exacts.</p>
</div>
<div class="paragraph data-line-491">
<p>Le nombre utilisé comme variable dans un tel scénario est appelé un <em>nonce</em>. Le nonce est utilisé pour faire varier la sortie d&#39;une fonction cryptographique, dans ce cas pour faire varier l&#39;empreinte SHA256 de la phrase.</p>
</div>
<div class="paragraph data-line-493">
<p>Pour relever le défi de cet algorithme, fixons-nous un objectif : trouver une phrase qui produit un hachage hexadécimal commençant par un zéro. Heureusement, ce n&#39;est pas difficile ! &lt;&lt;sha256_example_generator_output&gt; &gt; montre que la phrase &quot;I am Satoshi Nakamoto13&quot; produit le hash 0ebc56d59a34f5082aaef3d66b37a661696c2b618e62432727216ba9531041a5, ce qui correspond à nos critères. Il a fallu 13 tentatives pour le trouver. En termes de probabilités, si la sortie de la fonction de hachage est uniformément distribuée, nous nous attendrions à trouver un résultat avec un 0 comme préfixe hexadécimal une fois tous les 16 hachages (un sur 16 chiffres hexadécimaux de 0 à F). En termes numériques, cela signifie trouver une valeur de hachage inférieure à 0x100000000000000000000000000000000000000000000000000000000000. Nous appelons ce seuil la <em>cible</em> et le but est de trouver un hachage qui est numériquement égal ou inférieur à la cible. Si nous diminuons la cible, la tâche de trouver un hachage inférieur à la cible devient de plus en plus difficile.</p>
</div>
<div class="paragraph data-line-495">
<p>Pour donner une analogie simple, imaginez un jeu où les joueurs lancent une paire de dés à plusieurs reprises, en essayant de lancer autant ou moins qu&#39;une cible spécifiée. Au premier tour, l&#39;objectif est de 11. À moins que vous ne lanciez un double-six, vous gagnez. Au tour suivant, l&#39;objectif est de 10. Les joueurs doivent lancer 10 ou moins pour gagner, encore une fois une tâche facile. Disons que quelques tours plus tard, l&#39;objectif est tombé à 5. Maintenant, plus de la moitié des lancers de dés dépasseront l&#39;objectif et seront donc invalides. Il faut exponentiellement plus de lancers de dés pour gagner, plus la cible est basse. Finalement, lorsque l&#39;objectif est de 2 (le minimum possible), un seul lancer sur 36, soit 2 % d&#39;entre eux, produira un résultat gagnant.</p>
</div>
<div class="paragraph data-line-497">
<p>Du point de vue d&#39;un observateur qui sait que la cible du jeu de dés est 2, si quelqu&#39;un a réussi à lancer un lancer gagnant, on peut supposer qu&#39;il a tenté, en moyenne, 36 lancers. En d&#39;autres termes, on peut estimer la quantité de travail nécessaire pour réussir à partir de la difficulté imposée par la cible. Lorsque l&#39;algorithme est basé sur une fonction déterministe telle que SHA256, l&#39;entrée elle-même constitue la <em>preuve</em> qu&#39;une certaine quantité de <em>travail</em> a été effectuée pour produire un résultat égal ou inférieur à la cible. Par conséquent, <em>Preuve de travail</em>.</p>
</div>
<div class="exampleblock data-line-500">
<div class="content">
<div class="paragraph data-line-501">
<p>Même si chaque tentative produit un résultat aléatoire, la probabilité de tout résultat possible peut être calculée à l&#39;avance. Par conséquent, un résultat d&#39;une difficulté spécifiée constitue la preuve d&#39;une quantité de travail spécifique.</p>
</div>
</div>
</div>
<div class="paragraph data-line-504">
<p>Dans &lt;&lt;sha256_example_generator_output&gt; &gt;, le &quot;nonce&quot; gagnant est 13 et ce résultat peut être confirmé par n&#39;importe qui indépendamment. N&#39;importe qui peut ajouter le nombre 13 comme suffixe à la phrase &quot;Je suis Satoshi Nakamoto&quot; et calculer le hachage, en vérifiant qu&#39;il est inférieur à la cible. Le résultat réussi est également une preuve de travail, car cela prouve que nous avons fait le travail pour trouver ce nonce. Alors qu&#39;il ne faut qu&#39;un seul calcul de hachage pour vérifier, il nous a fallu 13 calculs de hachage pour trouver un nonce qui a fonctionné. Si nous avions une cible inférieure (difficulté plus élevée), il faudrait beaucoup plus de calculs de hachage pour trouver un nonce approprié, mais un seul calcul de hachage pour que quiconque puisse le vérifier. De plus, en connaissant la cible, n&#39;importe qui peut estimer la difficulté à l&#39;aide de statistiques et donc savoir combien de travail a été nécessaire pour trouver un tel nonce.</p>
</div>
<div class="exampleblock data-line-507">
<div class="content">
<div class="paragraph data-line-508">
<p>La preuve de travail doit produire un hachage qui est <em>égal ou inférieur à</em> la cible. Une cible plus élevée signifie qu&#39;il est moins difficile de trouver un hachage égal ou inférieur à la cible. Une cible inférieure signifie qu&#39;il est plus difficile de trouver un hachage égal ou inférieur à la cible. La cible et la difficulté sont inversement liées.</p>
</div>
</div>
</div>
<div class="paragraph data-line-512">
<p> La preuve de travail de Bitcoin est très similaire au défi présenté dans &lt;&lt;sha256_example_generator_output&gt; &gt;. Le mineur construit un bloc candidat rempli de transactions. Ensuite, le mineur calcule le hachage de l&#39;en-tête de ce bloc et voit s&#39;il est égal ou inférieur à la <em>target</em> actuelle. Si le hachage est supérieur à la cible, le mineur modifiera le nonce (généralement en l&#39;incrémentant simplement de un) et réessayera. À la difficulté actuelle du réseau Bitcoin, les mineurs doivent essayer des quadrillions de fois avant de trouver un nonce qui se traduit par un hachage d&#39;en-tête de bloc suffisamment bas.</p>
</div>
<div class="paragraph data-line-514">
<p>Un algorithme de preuve de travail très simplifié est implémenté en Python dans &lt;&lt;pow_example1&gt; &gt;.</p>
</div>
<div id="pow_example1" class="exampleblock data-line-518">
<div class="title">Example 8. Mise en œuvre simplifiée de la preuve de travail</div>
<div class="content">
<div class="listingblock data-line-520">
<div class="content">
<pre class="highlight"><code class="language-python" data-lang="python">#!/usr/bin/env python
# example of proof-of-work algorithm

import hashlib
import time

max_nonce = 2 ** 32 # 4 billion

def proof_of_work(header, difficulty_bits):
    
    # calculate the difficulty target
    target = 2 ** (256-difficulty_bits)
    
    for nonce in xrange(max_nonce):
        hash_result = hashlib.sha256(str(header)+str(nonce)).hexdigest()
        
        # check if this is a valid result, below the target
        if long(hash_result, 16) &lt; target:
            print "Success with nonce %d" % nonce
            print "Hash is %s" % hash_result
            return (hash_result,nonce)
            
    print "Failed after %d (max_nonce) tries" % nonce
    return nonce

    
if __name__ == '__main__':
    
    nonce = 0
    hash_result = ''
     
    # difficulty from 0 to 31 bits  
    for difficulty_bits in xrange(32):
        
        difficulty = 2 ** difficulty_bits
        print "Difficulty: %ld (%d bits)" % (difficulty, difficulty_bits)
    
        print "Starting search..."
        
        # checkpoint the current time
        start_time = time.time()
        
        # make a new block which includes the hash from the previous block
        # we fake a block of transactions - just a string
        new_block = 'test block with transactions' + hash_result 
        
        # find a valid nonce for the new block
        (hash_result, nonce) = proof_of_work(new_block, difficulty_bits) 
        
        # checkpoint how long it took to find a result
        end_time = time.time()
        
        elapsed_time = end_time - start_time
        print "Elapsed Time: %.4f seconds" % elapsed_time
    
        if elapsed_time &gt; 0:
            
            # estimate the hashes per second
            hash_power = float(long(nonce)/elapsed_time)
            print "Hashing Power: %ld hashes per second" % hash_power</code></pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-525">
<p>En exécutant ce code, vous pouvez définir la difficulté souhaitée (en bits, combien de bits de tête doivent être nuls) et voir combien de temps il faut à votre ordinateur pour trouver une solution. Dans &lt;&lt;pow_example_outputs&gt; &gt;, vous pouvez voir comment cela fonctionne sur un ordinateur portable moyen.</p>
</div>
<div id="pow_example_outputs" class="exampleblock data-line-529">
<div class="title">Example 9. Exécution de l&#39;exemple de preuve de travail pour diverses difficultés</div>
<div class="content">
<div class="listingblock data-line-531">
<div class="content">
<pre class="highlight"><code class="language-bash" data-lang="bash">$ python preuve-de-travail-exemple.py*</code></pre>
</div>
</div>
<div class="listingblock data-line-535">
<div class="content">
<pre>Difficulté : 1 (0 bits)

[...]

Difficulté : 8 (3 bits)
Lancement de la recherche...
Succès avec nonce 9
Le hachage est 1c1c105e65b47142f028a8f93ddf3dabb9260491bc64474738133ce5256cb3c1
Temps écoulé : 0,0004 seconde
Puissance de hachage : 25 065 hachages par seconde
Difficulté : 16 (4 bits)
Lancement de la recherche...
Succès avec nonce 25
Le hachage est 0f7becfd3bcd1a82e06663c97176add89e7cae0268de46f94e7e11bc3863e148
Temps écoulé : 0,0005 seconde
Puissance de hachage : 52 507 hachages par seconde
Difficulté : 32 (5 bits)
Lancement de la recherche...
Succès avec nonce 36
Le hachage est 029ae6e5004302a120630adcbb808452346ab1cf0b94c5189ba8bac1d47e7903
Temps écoulé : 0,0006 seconde
Puissance de hachage : 58 164 hachages par seconde

[...]

Difficulté : 4194304 (22 bits)
Lancement de la recherche...
Succès avec nonce 1759164
Le hachage est 0000008bb8f0e731f0496b8e530da984e85fb3cd2bd81882fe8ba3610b6cefc3
Temps écoulé : 13,3201 secondes
Puissance de hachage : 132 068 hachages par seconde
Difficulté : 8388608 (23 bits)
Lancement de la recherche...
Succès avec nonce 14214729
Le hachage est 000001408cf12dbd20fcba6372a223e098d58786c6ff93488a9f74f5df4df0a3
Temps écoulé : 110,1507 secondes
Puissance de hachage : 129 048 hachages par seconde
Difficulté : 16777216 (24 bits)
Lancement de la recherche...
Succès avec nonce 24586379
Le hachage est 0000002c3d6b370fccd699708d1b7cb4a94388595171366b944d68b2acce8b95
Temps écoulé : 195,2991 secondes
Puissance de hachage : 125 890 hachages par seconde

[...]

Difficulté : 67108864 (26 bits)
Lancement de la recherche...
Succès avec nonce 84561291
Le hachage est 0000001f0ea21e676b6dde5ad429b9d131a9f2b000802ab2f169cbca22b1e21a
Temps écoulé : 665,0949 secondes
Puissance de hachage : 127 141 hachages par seconde</pre>
</div>
</div>
</div>
</div>
<div class="paragraph data-line-591">
<p>Comme vous pouvez le constater, augmenter la difficulté de 1 bit entraîne un doublement du temps nécessaire pour trouver une solution. Si vous pensez à l&#39;ensemble de l&#39;espace numérique de 256 bits, chaque fois que vous contraignez un bit de plus à zéro, vous réduisez l&#39;espace de recherche de moitié. Dans &lt;&lt;pow_example_outputs&gt; &gt;, il faut 84 millions de tentatives de hachage pour trouver un nonce qui produit un hachage avec 26 bits de tête comme zéro. Même à une vitesse de plus de 120 000 hachages par seconde, il faut tout de même 10 minutes sur un portable pour trouver cette solution.</p>
</div>
<div class="paragraph data-line-593">
<p>Au moment de la rédaction, le réseau tente de trouver un bloc dont le hachage d&#39;en-tête est égal ou inférieur à :</p>
</div>
<div class="listingblock data-line-595">
<div class="content">
<pre>0000000000000000029AB900000000000000000000000000000000000000000</pre>
</div>
</div>
<div class="paragraph data-line-599">
<p>Comme vous pouvez le voir, il y a beaucoup de zéros au début de cette cible, ce qui signifie que la plage acceptable de hachages est beaucoup plus petite, il est donc plus difficile de trouver un hachage valide. Il faudra en moyenne plus de 1,8 hachages zêta (mille milliards de milliards de hachages) pour que le réseau découvre le bloc suivant. Cela semble être une tâche impossible, mais heureusement, le réseau apporte 3 exa-hachages par seconde (EH/sec) de puissance de traitement, ce qui permettra de trouver un bloc en environ 10 minutes en moyenne.</p>
</div>
</div>
<div class="sect3 data-line-602">
<h4 id="target_bits">Représentation cible</h4>
<div class="paragraph data-line-604">
<p>Dans &lt;&lt;block277316&gt; &gt;, nous avons vu que le bloc contient la cible, dans une notation appelée &quot;target bits&quot; ou simplement &quot;bits&quot;, qui dans le bloc 277 316 a la valeur 0x1903a30c. Cette notation exprime la cible de preuve de travail sous la forme d&#39;un format coefficient/exposant, avec les deux premiers chiffres hexadécimaux pour l&#39;exposant et les six chiffres hexadécimaux suivants pour le coefficient. Dans ce bloc, par conséquent, l&#39;exposant est 0x19 et le coefficient est 0x03a30c.</p>
</div>
<div class="paragraph data-line-606">
<p>La formule pour calculer la cible de difficulté à partir de cette représentation est :</p>
</div>
<ul class="simplelist">
  <li>cible = coefficient * 2 <sup>(8*(exposant–3))</sup></li>
</ul>
<div class="paragraph data-line-614">
<p>En utilisant cette formule et la valeur des bits de difficulté 0x1903a30c, nous obtenons :</p>
</div>
<ul class="simplelist">
  <li>cible = 0x03a30c * 2 <sup>0x08*(0x19-0x03)</sup></li>
  <li>=&gt; cible = 0x03a30c * 2 <sup>(0x08*0x16)</sup></li>
  <li>=&gt; cible = 0x03a30c * 2 <sup>0xB0</sup></li>
</ul>
<div class="paragraph data-line-624">
<p>qui en décimal est :</p>
</div>
<ul class="simplelist">
  <li>=&gt; cible = 238 348 * 2 <sup>176</sup></li>
  <li>=&gt; cible =<br/> 22 829 202 948 393 929 850 749 706 076 701 368 331 072 452 018 388 575 715 328</li>
</ul>
<div class="paragraph data-line-633">
<p>retour en hexadécimal :</p>
</div>
<ul class="simplelist">
  <li>=&gt; cible =<br/> 0x0000000000000003A30C000000000000000000000000000000000000000000</li>
</ul>
<div class="paragraph data-line-641">
<p>Cela signifie qu&#39;un bloc valide pour la hauteur 277 316 est celui qui a un hachage d&#39;en-tête de bloc inférieur à cette cible. En binaire, ce nombre doit avoir plus de 60 bits de tête mis à zéro. Avec ce niveau de difficulté, un seul mineur traitant 1 billion de hachages par seconde (1 terahash par seconde ou 1 TH/sec) ne trouverait une solution qu&#39;une fois tous les 8 496 blocs ou une fois tous les 59 jours, en moyenne.</p>
</div>
</div>
<div class="sect3 data-line-644">
<h4 id="cible">Reciblage pour ajuster la difficulté</h4>
<div class="paragraph data-line-646">
<p> Comme nous l&#39;avons vu, la cible détermine la difficulté et affecte donc le temps qu&#39;il faut pour trouver une solution au Proof-of- Algorithme de travail. Cela conduit à des questions évidentes : pourquoi la difficulté est-elle ajustable, qui l&#39;ajuste et comment ?</p>
</div>
<div class="paragraph data-line-648">
<p>Les blocs de Bitcoin sont générés toutes les 10 minutes, en moyenne. C&#39;est le battement de cœur de bitcoin et sous-tend la fréquence d&#39;émission de devises et la rapidité de règlement des transactions. Il doit rester constant non seulement à court terme, mais sur une période de plusieurs décennies. Au cours de cette période, on s&#39;attend à ce que la puissance des ordinateurs continue d&#39;augmenter à un rythme rapide. De plus, le nombre de participants à l&#39;exploitation minière et les ordinateurs qu&#39;ils utilisent changeront également constamment. Pour maintenir le temps de génération de bloc à 10 minutes, la difficulté de minage doit être ajustée pour tenir compte de ces changements. En fait, la cible de preuve de travail est un paramètre dynamique qui est périodiquement ajusté pour atteindre un objectif d&#39;intervalle de bloc de 10 minutes. En termes simples, l&#39;objectif est défini de sorte que la puissance minière actuelle se traduise par un intervalle de bloc de 10 minutes.</p>
</div>
<div class="paragraph data-line-650">
<p>Comment, alors, un tel ajustement s&#39;effectue-t-il dans un réseau totalement décentralisé ? Le reciblage se produit automatiquement et sur chaque nœud indépendamment. Tous les 2 016 blocs, tous les nœuds reciblent la preuve de travail. L&#39;équation de reciblage mesure le temps qu&#39;il a fallu pour trouver les 2 016 derniers blocs et le compare au temps prévu de 20 160 minutes (2 016 blocs multipliés par l&#39;intervalle de bloc de 10 minutes souhaité). Le rapport entre la durée réelle et la durée souhaitée est calculé et un ajustement proportionnel (à la hausse ou à la baisse) est apporté à la cible. En termes simples : si le réseau trouve des blocs plus rapidement que toutes les 10 minutes, la difficulté augmente (la cible diminue). Si la découverte de blocs est plus lente que prévu, la difficulté diminue (la cible augmente).</p>
</div>
<div class="paragraph data-line-652">
<p>L&#39;équation peut se résumer ainsi :</p>
</div>
<div class="listingblock data-line-654">
<div class="content">
<pre>Nouvel objectif = Ancien objectif * (Heure réelle des 2016 derniers blocs / 20160 minutes)</pre>
</div>
</div>
<div class="paragraph data-line-658">
<p>&lt;&lt;retarget_code&gt; &gt; montre le code utilisé dans le client Bitcoin Core.</p>
</div>
<div id="retarget_code" class="exampleblock data-line-662">
<div class="title">Example 10. Retargeting la preuve de travail—CalculateNextWorkRequired() dans pow.cpp</div>
<div class="content">
<div class="listingblock data-line-664">
<div class="content">
<pre class="highlight"><code class="language-cpp" data-lang="cpp">   // Limiter le pas de réglage
    int64_t nActualTimespan = pindexLast-&amp;gt;GetBlockTime() - nFirstBlockTime ;
    LogPrintf(&amp;quot; nActualTimespan = %d avant les limites\n&amp;quot;, nActualTimespan);
    si (nActualTimespan &amp;lt; params.nPowTargetTimespan/4)
        nActualTimespan = params.nPowTargetTimespan/4 ;
    si (nActualTimespan &amp;gt; params.nPowTargetTimespan*4)
        nActualTimespan = params.nPowTargetTimespan*4 ;

    // Recibler
    const arith_uint256 bnPowLimit = UintToArith256(params.powLimit);
    arith_uint256 bnNew ;
    arith_uint256 bnOld ;
    bnNew.SetCompact(pindexLast-&amp;gt;nBits);
    bnAncien = bnNouveau ;
    bnNew *= nActualTimespan ;
    bnNew /= params.nPowTargetTimespan ;

    si (bnNew &amp;gt; bnPowLimit)
        bnNouveau = bnPowLimit ;</code></pre>
</div>
</div>
</div>
</div>
<div class="exampleblock data-line-690">
<div class="content">
<div class="paragraph data-line-691">
<p>Bien que l&#39;étalonnage cible se produise tous les 2 016 blocs, en raison d&#39;une erreur de un par un dans le client Bitcoin Core d&#39;origine, il est basé sur le temps total des 2 015 blocs précédents (et non 2 016 comme il se doit), ce qui entraîne un biais de reciblage vers une difficulté plus élevée de 0,05 %.</p>
</div>
</div>
</div>
<div class="paragraph data-line-695">
<p>Les paramètres Interval (2 016 blocs) et TargetTimespan (deux semaines en 1 209 600 secondes) sont définis dans <em>chainparams.cpp</em>.</p>
</div>
<div class="paragraph data-line-697">
<p>Pour éviter une volatilité extrême de la difficulté, l&#39;ajustement de reciblage doit être inférieur à un facteur quatre (4) par cycle. Si l&#39;ajustement cible requis est supérieur à un facteur de quatre, il sera ajusté d&#39;un facteur de 4 et pas plus. Tout autre ajustement sera effectué au cours de la prochaine période de reciblage, car le déséquilibre persistera au cours des 2 016 prochains blocs. Par conséquent, des écarts importants entre la puissance de hachage et la difficulté peuvent nécessiter plusieurs cycles de blocs de 2 016 pour s&#39;équilibrer.</p>
</div>
<div class="exampleblock data-line-700">
<div class="content">
<div class="paragraph data-line-701">
<p>La difficulté d&#39;extraction d&#39;un bloc de bitcoins est d&#39;environ &#39;10 minutes de traitement&#39; pour l&#39;ensemble du réseau, sur la base du temps qu&#39;il a fallu pour extraire les 2 016 blocs précédents, ajusté tous les 2 016 blocs. Ceci est réalisé en abaissant ou en élevant la cible.</p>
</div>
</div>
</div>
<div class="paragraph data-line-704">
<p>Notez que la cible est indépendante du nombre de transactions ou de la valeur des transactions. Cela signifie que la quantité de puissance de hachage et donc d&#39;électricité dépensée pour sécuriser le bitcoin est également entièrement indépendante du nombre de transactions. Bitcoin peut évoluer, parvenir à une adoption plus large et rester sécurisé sans aucune augmentation de la puissance de hachage par rapport au niveau actuel. L&#39;augmentation de la puissance de hachage représente les forces du marché alors que de nouveaux mineurs entrent sur le marché pour concourir pour la récompense. Tant qu&#39;une puissance de hachage suffisante est sous le contrôle des mineurs agissant honnêtement à la recherche de la récompense, cela suffit pour empêcher les attaques de &quot;prise de contrôle&quot; et, par conséquent, c&#39;est suffisant pour sécuriser le bitcoin.</p>
</div>
<div class="paragraph data-line-706">
<p>La difficulté du minage est étroitement liée au coût de l&#39;électricité et au taux de change du bitcoin vis-à-vis de la monnaie utilisée pour payer l&#39;électricité. Les systèmes de minage hautes performances sont à peu près aussi efficaces que possible avec la génération actuelle de fabrication de silicium, convertissant l&#39;électricité en calcul de hachage au taux le plus élevé possible. La principale influence sur le marché minier est le prix d&#39;un kilowattheure d&#39;électricité en bitcoin, car cela détermine la rentabilité du minage et donc les incitations à entrer ou à sortir du marché minier.</p>
</div>
</div>
</div>
<div class="sect2 data-line-708">
<h3 id="_réussir_à_miner_le_bloc">Réussir à miner le bloc</h3>
<div class="paragraph data-line-710">
<p>Comme nous l&#39;avons vu précédemment, Jing&#39;s node a construit un bloc candidat et l&#39;a préparé pour le minage. Jing possède plusieurs plates-formes de minage de matériel avec des circuits intégrés spécifiques à l&#39;application, où des centaines de milliers de circuits intégrés exécutent l&#39;algorithme SHA256 en parallèle à des vitesses incroyables. Beaucoup de ces machines spécialisées sont connectées à son nœud minier via USB ou un réseau local. Ensuite, le nœud de minage exécuté sur le bureau de Jing transmet l&#39;en-tête de bloc à son matériel de minage, qui commence à tester des milliards de nonces par seconde. Parce que le nonce n&#39;est que de 32 bits, après avoir épuisé toutes les possibilités de nonce (environ 4 milliards), le matériel de minage modifie l&#39;en-tête de bloc (en ajustant l&#39;espace ou l&#39;horodatage supplémentaire du nonce coinbase) et réinitialise le compteur de nonce, en testant de nouvelles combinaisons.</p>
</div>
<div class="paragraph data-line-712">
<p>Près de 11 minutes après avoir commencé à miner le bloc 277 316, l&#39;une des machines de minage de matériel trouve une solution et la renvoie au nœud de minage.</p>
</div>
<div class="paragraph data-line-714">
<p>Lorsqu&#39;il est inséré dans l&#39;en-tête de bloc, le nonce 924 591 752 produit un hachage de bloc de :</p>
</div>
<div class="listingblock data-line-716">
<div class="content">
<pre>0000000000000001b6b9a13b095e96db41c4a928b97ef2d944a9b31b2cc7bdc4</pre>
</div>
</div>
<div class="paragraph data-line-720">
<p>qui est inférieur à la cible :</p>
</div>
<div class="listingblock data-line-722">
<div class="content">
<pre>0000000000000003A30C000000000000000000000000000000000000000000</pre>
</div>
</div>
<div class="paragraph data-line-726">
<p>Immédiatement, le nœud minier de Jing transmet le bloc à tous ses pairs. Ils reçoivent, valident puis propagent le nouveau bloc. Au fur et à mesure que le bloc se répand sur le réseau, chaque nœud l&#39;ajoute à sa propre copie de la blockchain, l&#39;étendant à une nouvelle hauteur de 277 316 blocs. Au fur et à mesure que les nœuds miniers reçoivent et valident le bloc, ils abandonnent leurs efforts pour trouver un bloc à la même hauteur et commencent immédiatement à calculer le bloc suivant dans la chaîne, en utilisant le bloc de Jing comme &quot;parent&quot;. En construisant sur le bloc nouvellement découvert de Jing, les autres mineurs &quot;votent&quot; essentiellement avec leur puissance minière et approuvent le bloc de Jing et la chaîne qu&#39;il prolonge.</p>
</div>
<div class="paragraph data-line-728">
<p>Dans la section suivante, nous examinerons le processus utilisé par chaque nœud pour valider un bloc et sélectionner la chaîne la plus longue, créant ainsi le consensus qui forme la blockchain décentralisée.(&quot;&quot;, startref=&quot;jingtentwo&quot;)</p>
</div>
</div>
<div class="sect2 data-line-730">
<h3 id="_validation_dun_nouveau_bloc">Validation d&#39;un nouveau bloc</h3>
<div class="paragraph data-line-732">
<p>La troisième étape du mécanisme de consensus de bitcoin est indépendante validation de chaque nouveau bloc par chaque nœud du réseau. Au fur et à mesure que le bloc nouvellement résolu se déplace sur le réseau, chaque nœud effectue une série de tests pour le valider avant de le propager à ses pairs. Cela garantit que seuls les blocs valides sont propagés sur le réseau. La validation indépendante garantit également que les mineurs qui agissent honnêtement obtiennent leurs blocs incorporés dans la blockchain, gagnant ainsi la récompense. Les mineurs qui agissent de manière malhonnête voient leurs blocs rejetés et non seulement perdent la récompense, mais gaspillent également les efforts déployés pour trouver une solution de preuve de travail, encourant ainsi le coût de l&#39;électricité sans compensation.</p>
</div>
<div class="paragraph data-line-734">
<p>Lorsqu&#39;un nœud reçoit un nouveau bloc, il valide le bloc en le comparant à une longue liste de critères qui doivent tous être remplis ; sinon, le bloc est rejeté. Ces critères peuvent être vus dans le client Bitcoin Core dans les fonctions CheckBlock et CheckBlockHeader et incluent :</p>
</div>
<div class="ulist data-line-736">
<ul>
<li class="data-line-736">
<p>La structure de données du bloc est syntaxiquement valide</p>
</li>
<li class="data-line-737">
<p>Le hachage de l&#39;en-tête de bloc est égal ou inférieur à la cible (applique la preuve de travail)</p>
</li>
<li class="data-line-738">
<p>L&#39;horodatage du bloc est inférieur à deux heures dans le futur (en tenant compte des erreurs de temps)</p>
</li>
<li class="data-line-739">
<p>La taille du bloc est dans les limites acceptables</p>
</li>
<li class="data-line-740">
<p>La première transaction (et seulement la première) est une transaction coinbase</p>
</li>
<li class="data-line-741">
<p>Toutes les transactions dans le bloc sont valides en utilisant la liste de contrôle des transactions décrite dans &lt;&lt;tx_verification&gt; &gt;</p>
</li>
</ul>
</div>
<div class="paragraph data-line-743">
<p>La validation indépendante de chaque nouveau bloc par chaque nœud du réseau garantit que les mineurs ne peuvent pas tricher. Dans les sections précédentes, nous avons vu comment les mineurs peuvent écrire une transaction qui leur attribue le nouveau bitcoin créé dans le bloc et réclamer les frais de transaction. Pourquoi les mineurs n&#39;écrivent-ils pas eux-mêmes une transaction pour mille bitcoins au lieu de la bonne récompense ? Parce que chaque nœud valide les blocs selon les mêmes règles. Une transaction coinbase invalide rendrait l&#39;ensemble du bloc invalide, ce qui entraînerait le rejet du bloc et, par conséquent, cette transaction ne ferait jamais partie du grand livre. Les mineurs doivent construire un bloc parfait, basé sur les règles partagées que tous les nœuds suivent, et l&#39;exploiter avec une solution correcte à la preuve de travail. Pour ce faire, ils dépensent beaucoup d&#39;électricité dans l&#39;exploitation minière, et s&#39;ils trichent, toute l&#39;électricité et les efforts sont gaspillés. C&#39;est pourquoi la validation indépendante est un élément clé du consensus décentralisé.</p>
</div>
</div>
<div class="sect2 data-line-745">
<h3 id="_assemblage_et_sélection_de_chaînes_de_blocs">Assemblage et sélection de chaînes de blocs</h3>
<div class="paragraph data-line-747">
<p>Le La dernière étape du mécanisme de consensus décentralisé de Bitcoin est l&#39;assemblage de blocs en chaînes et la sélection de la chaîne avec le plus de preuves de travail. Une fois qu&#39;un nœud a validé un nouveau bloc, il tentera alors d&#39;assembler une chaîne en connectant le bloc à la blockchain existante.</p>
</div>
<div class="paragraph data-line-749">
<p>Les nœuds maintiennent trois ensembles de blocs : ceux connectés à la blockchain principale, ceux qui forment des branches de la blockchain principale (chaînes secondaires) et enfin, les blocs qui n&#39;ont pas de parent connu dans les chaînes connues (orphelins). Les blocs invalides sont rejetés dès que l&#39;un des critères de validation échoue et ne sont donc inclus dans aucune chaîne.</p>
</div>
<div class="paragraph data-line-751">
<p>La &quot;chaîne principale&quot; à tout moment est la chaîne de blocs <em>valide</em> à laquelle est associée la preuve de travail la plus cumulative. Dans la plupart des cas, il s&#39;agit également de la chaîne contenant le plus de blocs, à moins qu&#39;il n&#39;y ait deux chaînes de longueur égale et que l&#39;une ait plus de preuve de travail. La chaîne principale aura également des branches avec des blocs qui sont des &quot;frères et sœurs&quot; des blocs de la chaîne principale. Ces blocs sont valides mais ne font pas partie de la chaîne principale. Elles sont conservées pour référence future, au cas où l&#39;une de ces chaînes serait étendue au-delà de la chaîne principale en cours. Dans la section suivante (&lt;&lt;forks&gt; &gt;), nous verrons comment des chaînes secondaires se produisent à la suite d&#39;une extraction quasi simultanée de blocs à la même hauteur.</p>
</div>
<div class="paragraph data-line-753">
<p>Lorsqu&#39;un nouveau bloc est reçu, un nœud essaie de l&#39;insérer dans la blockchain existante. Le nœud examinera le champ &quot;hachage du bloc précédent&quot; du bloc, qui est la référence au parent du bloc. Ensuite, le nœud tentera de trouver ce parent dans la blockchain existante. La plupart du temps, le parent sera la &quot;pointe&quot; de la chaîne principale, ce qui signifie que ce nouveau bloc étend la chaîne principale. Par exemple, le nouveau bloc 277,316 a une référence au hachage de son bloc parent 277,315. La plupart des nœuds qui reçoivent 277 316 auront déjà le bloc 277 315 comme pointe de leur chaîne principale et relieront donc le nouveau bloc et étendront cette chaîne.</p>
</div>
<div class="paragraph data-line-755">
<p>Parfois, comme nous le verrons dans &lt;&lt;forks&gt; &gt;, le nouveau bloc prolonge une chaîne qui n&#39;est pas la chaîne principale. Dans ce cas, le nœud attachera le nouveau bloc à la chaîne secondaire qu&#39;il prolonge, puis comparera le travail de la chaîne secondaire à la chaîne principale. Si la chaîne secondaire a plus de travail cumulé que la chaîne principale, le nœud <em>reconvergera</em> sur la chaîne secondaire, ce qui signifie qu&#39;il sélectionnera la chaîne secondaire comme sa nouvelle chaîne principale, faisant de l&#39;ancienne chaîne principale une chaîne secondaire. Si le nœud est un mineur, il construira maintenant un bloc étendant cette nouvelle chaîne plus longue.</p>
</div>
<div class="paragraph data-line-757">
<p>Si un bloc valide est reçu et qu&#39;aucun parent n&#39;est trouvé dans les chaînes existantes, ce bloc est considéré comme &quot;orphelin&quot;. Les blocs orphelins sont enregistrés dans le pool de blocs orphelins où ils resteront jusqu&#39;à ce que leur parent soit reçu. Une fois que le parent est reçu et lié aux chaînes existantes, l&#39;orphelin peut être retiré du pool d&#39;orphelins et lié au parent, ce qui en fait une partie d&#39;une chaîne. Les blocs orphelins se produisent généralement lorsque deux blocs extraits dans un court laps de temps sont reçus dans l&#39;ordre inverse (enfant avant parent).</p>
</div>
<div class="paragraph data-line-759">
<p>En sélectionnant la chaîne valide de plus grand travail cumulé, tous les nœuds finissent par parvenir à un consensus à l&#39;échelle du réseau. Les divergences temporaires entre les chaînes sont finalement résolues au fur et à mesure que du travail est ajouté, étendant l&#39;une des chaînes possibles. Les nœuds de minage « votent » avec leur puissance de minage en choisissant quelle chaîne étendre en minant le bloc suivant. Lorsqu&#39;ils exploitent un nouveau bloc et étendent la chaîne, le nouveau bloc lui-même représente leur vote.</p>
</div>
<div class="paragraph data-line-761">
<p>Dans la section suivante, nous verrons comment les divergences entre les chaînes concurrentes (forks) sont résolues par la sélection indépendante de la chaîne de plus grand travail cumulatif.</p>
</div>
<div class="sect3 data-line-764">
<h4 id="fourches">Fourchettes Blockchain</h4>
<div class="paragraph data-line-766">
<p>(&quot;forks&quot;, &quot;blockchain fork events&quot;, id=&quot;forks10&quot;)Parce que la blockchain est une structure de données décentralisée, différentes copies de celle-ci ne sont pas toujours cohérentes. Les blocs peuvent arriver à différents nœuds à des moments différents, ce qui amène les nœuds à avoir différentes perspectives de la blockchain. Pour résoudre ce problème, chaque nœud sélectionne et tente toujours d&#39;étendre la chaîne de blocs qui représente le plus de preuve de travail, également connue sous le nom de chaîne la plus longue ou de chaîne de travail cumulative la plus importante. En additionnant le travail enregistré dans chaque bloc d&#39;une chaîne, un nœud peut calculer la quantité totale de travail qui a été dépensée pour créer cette chaîne. Tant que tous les nœuds sélectionnent la plus grande chaîne de travail cumulatif, le réseau mondial Bitcoin finit par converger vers un état cohérent. Les fourches se produisent sous forme d&#39;incohérences temporaires entre les versions de la blockchain, qui sont résolues par une éventuelle reconvergence à mesure que d&#39;autres blocs sont ajoutés à l&#39;une des fourches.</p>
</div>
<div class="exampleblock data-line-769">
<div class="content">
<div class="paragraph data-line-770">
<p>Les fourches de blockchain décrites dans cette section se produisent naturellement (accidentellement) en raison de retards de transmission dans le réseau mondial. Plus loin dans ce chapitre, nous verrons également les forks délibérément induits (hard forks et soft forks), qui sont utilisés pour modifier les règles de consensus.</p>
</div>
</div>
</div>
<div class="paragraph data-line-773">
<p>Dans les quelques diagrammes suivants, nous suivons la progression d&#39;un événement &quot;fork&quot; à travers le réseau. Le diagramme est une représentation simplifiée du réseau Bitcoin. À des fins d&#39;illustration, différents blocs sont représentés sous différentes formes (étoile, triangle, triangle inversé, losange), répartis sur le réseau. Chaque nœud du réseau est représenté par un cercle.</p>
</div>
<div class="paragraph data-line-775">
<p>Chaque nœud a sa propre perspective de la blockchain mondiale. Au fur et à mesure que chaque nœud reçoit des blocs de ses voisins, il met à jour sa propre copie de la blockchain, en sélectionnant la plus grande chaîne de travail cumulée. À des fins d&#39;illustration, chaque nœud contient une forme qui représente le bloc qui, selon lui, est actuellement la pointe de la chaîne principale. Donc, si vous voyez une forme d&#39;étoile dans le nœud, cela signifie que le bloc en étoile est la pointe de la chaîne principale, en ce qui concerne ce nœud.</p>
</div>
<div class="paragraph data-line-777">
<p>Dans le premier diagramme (&lt;&lt;fork1&gt; &gt;), le réseau a une perspective unifiée de la blockchain, avec le bloc étoile comme pointe de la chaîne principale.</p>
</div>
<div id="fork1" class="imageblock &quot;smallereighty&quot; data-line-782">
<div class="content">
<img src="images/mbc2_1002.png" alt="&quot;Avant la bifurcation - tous les nœuds ont la même perspective&quot;">
</div>
<div class="title">Figure 1. Avant la bifurcation—tous les nœuds ont la même perspective</div>
</div>
<div class="paragraph data-line-784">
<p>Un &quot;fork&quot; se produit chaque fois qu&#39;il y a deux blocs valides différents à la même hauteur de bloc en compétition pour former la blockchain la plus longue. Cela se produit dans des conditions normales chaque fois que deux mineurs résolvent l&#39;algorithme de preuve de travail dans un court laps de temps l&#39;un de l&#39;autre. Alors que les deux mineurs découvrent une solution pour leurs blocs candidats respectifs, ils diffusent immédiatement leur propre bloc &quot;gagnant&quot; à leurs voisins immédiats qui commencent à propager le bloc sur le réseau. Chaque nœud qui reçoit un bloc valide l&#39;incorpore dans sa blockchain, étendant la blockchain d&#39;un bloc. Si ce nœud voit plus tard un autre bloc valide étendre le même parent (à la même hauteur de bloc), il connecte le deuxième bloc sur une chaîne secondaire, bifurquant sa chaîne principale. En conséquence, certains nœuds &quot;verront&quot; un bloc gagnant en premier, tandis que d&#39;autres nœuds verront l&#39;autre bloc gagnant en premier, et deux versions concurrentes de la blockchain émergeront.</p>
</div>
<div class="paragraph data-line-786">
<p>Dans &lt;&lt;fork2&gt; &gt;, on voit deux mineurs (Node X et Node Y) qui minent deux blocs différents presque simultanément. Ces deux blocs sont des enfants du bloc étoile et étendent la chaîne en s&#39;appuyant sur le bloc étoile. Pour nous aider à le suivre, l&#39;un est visualisé comme un bloc triangulaire provenant du nœud X, et l&#39;autre est représenté comme un bloc triangulaire inversé provenant du nœud Y.</p>
</div>
<div id="fork2" class="imageblock data-line-791">
<div class="content">
<img src="images/mbc2_1003.png" alt="&quot;Visualisation d&#39;un événement fork blockchain : deux blocs trouvés simultanément&quot;">
</div>
<div class="title">Figure 2. Visualisation d&#39;un événement fork blockchain : deux blocs trouvés simultanément</div>
</div>
<div class="paragraph data-line-793">
<p>Supposons, par exemple, que le mineur Node X trouve une solution de preuve de travail pour un bloc &quot;triangle&quot; qui étend la blockchain, en s&#39;appuyant sur le bloc parent &quot;étoile&quot;. Presque simultanément, le mineur Node Y qui étendait également la chaîne du bloc &quot;étoile&quot; trouve une solution pour le bloc &quot;triangle inversé&quot;, son bloc candidat. Maintenant, il y a deux blocs possibles ; un que nous appelons &quot;triangle&quot;, originaire du Nœud X ; et un que nous appelons &quot;triangle inversé&quot;, originaire du nœud Y. Les deux blocs ont été extraits avec succès, les deux blocs sont valides (contiennent une solution valide à la preuve de travail), et les deux blocs étendent le même parent (bloc &quot; Star&quot;). Les deux blocs contiennent probablement la plupart des mêmes transactions, avec seulement peut-être quelques différences dans l&#39;ordre des transactions.</p>
</div>
<div class="paragraph data-line-795">
<p>Au fur et à mesure que les deux blocs se propagent, certains nœuds reçoivent d&#39;abord le bloc &quot;triangle&quot; et d&#39;autres reçoivent le bloc &quot;triangle inversé&quot; en premier. Comme indiqué dans &lt;&lt;fork3&gt; &gt;, le réseau se scinde en deux perspectives différentes de la blockchain ; un côté surmonté du bloc triangle, l&#39;autre du bloc triangle renversé.</p>
</div>
<div id="fork3" class="imageblock data-line-800">
<div class="content">
<img src="images/mbc2_1004.png" alt="Visualization of a blockchain fork event: two blocks propagate, splitting the network">
</div>
<div class="title">Figure 3. Visualization of a blockchain fork event: two blocks propagate, splitting the network</div>
</div>
<div class="paragraph data-line-802">
<p>In <a href="#fork3">Visualization of a blockchain fork event: two blocks propagate, splitting the network</a>, the miner Node X mined (created) the triangle block and extended the star chain with it. Therefore, Node X initially considers the chain with "triangle" block as the main chain. Later, Node X also received the "upside-down triangle" block that was mined by Node Y. Since it was received second, it is assumed to have "lost" the race. Yet, the "upside-down triangle" block is not discarded. It is linked to the "star" block parent and forms a secondary chain. While Node X assumes its main chain is the winning chain, it keeps the "losing" chain so that it has the information needed to reconverge if the "losing" chain ends up "winning."</p>
</div>
<div class="paragraph data-line-804">
<p>On the other side of the network, the miner Node Y constructs a blockchain based on its own perspective of the sequence of events. The miner Node Y mined (created) the "upside-down triangle" and initially considers that chain as the main chain (the "winner" chain). When it later received the "triangle" block that was mined by Node X, it connected it to the "star" block parent as a secondary chain.</p>
</div>
<div class="paragraph data-line-806">
<p>Neither side is "correct," or "incorrect." Both are valid perspectives of the blockchain. Only in hindsight will one prevail, based on how these two competing chains are extended by additional work.</p>
</div>
<div class="paragraph data-line-808">
<p>Each mining node whose perspective resembles Node X will immediately begin mining a candidate block that extends the chain with "triangle" as its tip. By linking "triangle" as the parent of their candidate blocks, they are voting with their hashing power. Their vote supports the chain that they have elected as the main chain.</p>
</div>
<div class="paragraph data-line-810">
<p>Any mining node whose perspective resembles Node Y will start building a candidate block with "upside-down triangle" as its parent, extending the chain that they believe is the main chain. And so, the race begins again.</p>
</div>
<div class="paragraph data-line-812">
<p>Forks are almost always resolved within one block time (10 minutes on average). While part of the network&#8217;s hashing power is dedicated to building on top of "triangle" as the parent, another part of the hashing power is focused on building on top of "upside-down triangle." Even if the hashing power is almost evenly split, it is likely that one set of miners will find a solution and propagate it before the other set of miners have found any solutions. Let&#8217;s say, for example, that the miners building on top of "triangle" find a new block "rhombus" that extends the chain (e.g., star-triangle-rhombus). They immediately propagate this new block and the entire network sees it as a valid solution as shown in <a href="#fork4">Visualization of a blockchain fork event: a new block extends one fork, reconverging the network. Both Node X and Node Y now consider "upside-down-triangle" block as a stale block.</a>.</p>
</div>
<div class="paragraph data-line-814">
<p>All nodes that had chosen "triangle" as the winner in the previous round will simply extend the chain one more block. The nodes that chose "upside-down triangle" as the winner, however, will now see two chains: star-triangle-rhombus and star-upside-down-triangle. The chain star-triangle-rhombus is now longer (more cumulative work) than the other chain. As a result, those nodes will set the chain star-triangle-rhombus as the main chain and change the star-upside-down-triangle chain to a secondary chain, as shown in <a href="#fork5">Visualization of a blockchain fork event: the network reconverges on a new longest chain</a>. This is a chain reconvergence, because those nodes are forced to revise their view of the blockchain to incorporate the new evidence of a longer chain. Any miners working on extending the chain star-upside-down-triangle will now stop that work because their candidate block is now considered a child of a stale block, as its parent "upside-down-triangle" is no longer on the longest chain. Since the upside-down-triangle block is now obsolete, the miner Node Y (which mined this block) will not be able to spend the mining reward for this block, even though this block was valid and was successfully mined. The transactions within "upside-down-triangle" that are not within "triangle" are re-inserted in the mempool for inclusion in the next block to become a part of the main chain. The entire network reconverges on a single blockchain star-triangle-rhombus, with "rhombus" as the last block in the chain. All miners immediately start working on candidate blocks that reference "rhombus" as their parent to extend the star-triangle-rhombus chain.</p>
</div>
<div id="fork4" class="imageblock &quot;smallereighty&quot; data-line-819">
<div class="content">
<img src="images/mbc2_1005.png" alt="Visualization of a blockchain fork event: a new block extends one fork">
</div>
<div class="title">Figure 4. Visualization of a blockchain fork event: a new block extends one fork, reconverging the network. Both Node X and Node Y now consider "upside-down-triangle" block as a stale block.</div>
</div>
<div id="fork5" class="imageblock &quot;smallereighty&quot; data-line-824">
<div class="content">
<img src="images/mbc2_1006.png" alt="Visualization of a blockchain fork event: the network reconverges on a new longest chain">
</div>
<div class="title">Figure 5. Visualization of a blockchain fork event: the network reconverges on a new longest chain</div>
</div>
<div class="paragraph data-line-826">
<p>It is theoretically possible for a fork to extend to two blocks, if two blocks are found almost simultaneously by miners on opposite "sides" of a previous fork. However, the chance of that happening is very low. Whereas a one-block fork might occur every day, a two-block fork occurs at most once every few weeks.</p>
</div>
<div class="paragraph data-line-828">
<p>Bitcoin&#8217;s block interval of 10 minutes is a design compromise between fast confirmation times (settlement of transactions) and the probability of a fork. A faster block time would make transactions clear faster but lead to more frequent blockchain forks, whereas a slower block time would decrease the number of forks but make settlement slower.</p>
</div>
</div>
</div>
<div class="sect2 data-line-830">
<h3 id="_mining_and_the_hashing_race">Mining and the Hashing Race</h3>
<div class="paragraph data-line-832">
<p>Bitcoin mining is an extremely competitive industry. The hashing power has increased exponentially every year of bitcoin&#8217;s existence. Some years the growth has reflected a complete change of technology, such as in 2010 and 2011 when many miners switched from using CPU mining to GPU mining and field programmable gate array (FPGA) mining. In 2013 the introduction of ASIC mining lead to another giant leap in mining power, by placing the SHA256 function directly on silicon chips specialized for the purpose of mining. The first such chips could deliver more mining power in a single box than the entire Bitcoin network in 2010.</p>
</div>
<div class="paragraph data-line-834">
<p>The following list shows the total hashing power of the Bitcoin network in terahashes/sec (TH/sec), since its inception in 2009 (source: Blockchain.com):</p>
</div>
<div class="dlist data-line-836">
<dl>
<dt class="hdlist1">2009</dt>
<dd>
<p>0.000004 – 0.00001 TH/sec (2.40&#x00D7; growth)</p>
</dd>
<dt class="hdlist1">2010</dt>
<dd>
<p>0.00001 – 0.14 TH/sec (14,247&#x00D7; growth)</p>
</dd>
<dt class="hdlist1">2011</dt>
<dd>
<p>0.14 – 9.49 TH/sec (63.92&#x00D7; growth)</p>
</dd>
<dt class="hdlist1">2012</dt>
<dd>
<p>9.49 – 22 TH/sec (2.32&#x00D7; growth)</p>
</dd>
<dt class="hdlist1">2013</dt>
<dd>
<p>22.04 – 15,942 TH/sec (723.32&#x00D7; growth)</p>
</dd>
<dt class="hdlist1">2014</dt>
<dd>
<p>15,942 – 306,333 TH/sec (19.21&#x00D7; growth)</p>
</dd>
<dt class="hdlist1">2015</dt>
<dd>
<p>306,333 – 881,232 TH/sec (2.87&#x00D7; growth)</p>
</dd>
<dt class="hdlist1">2016</dt>
<dd>
<p>881,232 – 2,807,540 TH/sec (3.18&#x00D7; growth)</p>
</dd>
<dt class="hdlist1">2017</dt>
<dd>
<p>2,807,540 – 18,206,558 TH/sec (6.48&#x00D7; growth)</p>
</dd>
<dt class="hdlist1">2018</dt>
<dd>
<p>18,206,558 – 41,801,528 TH/sec (2.29&#x00D7; growth)</p>
</dd>
<dt class="hdlist1">2019</dt>
<dd>
<p>41,801,528 – 109,757,127 TH/sec (2.62&#x00D7; growth)</p>
</dd>
<dt class="hdlist1">2020</dt>
<dd>
<p>109,757,127 – 149,064,869 TH/sec (1.35&#x00D7; growth)</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-849">
<p>In the chart in <a href="#network_hashing_power">Total hashing power, terahashes per second (TH/sec) (chart on a linear scale)</a>, we can see that Bitcoin network&#8217;s hashing power increased over the past two years. As you can see, the competition between miners and the growth of bitcoin has resulted in an exponential increase in the hashing power (total hashes per second across the network).</p>
</div>
<div id="network_hashing_power" class="imageblock data-line-853">
<div class="content">
<img src="images/mbc2_1007.png" alt="NetworkHashingRate">
</div>
<div class="title">Figure 6. Total hashing power, terahashes per second (TH/sec) (chart on a linear scale)</div>
</div>
<div class="paragraph data-line-855">
<p>As the amount of hashing power applied to mining bitcoin has exploded, the difficulty has risen to match it. The difficulty metric in the chart shown in <a href="#bitcoin_difficulty">Bitcoin&#8217;s mining difficulty metric (chart on a logarithmic scale)</a> is measured as a ratio of current difficulty over minimum difficulty (the difficulty of the first block).</p>
</div>
<div id="bitcoin_difficulty" class="imageblock data-line-859">
<div class="content">
<img src="images/mbc2_1008.png" alt="BitcoinDifficulty">
</div>
<div class="title">Figure 7. Bitcoin&#8217;s mining difficulty metric (chart on a logarithmic scale)</div>
</div>
<div class="paragraph data-line-861">
<p>In the last two years, the ASIC mining chips have become increasingly denser, approaching the cutting edge of silicon fabrication with a feature size (resolution) of 7 nanometers (nm). Currently, ASIC manufacturers are aiming to overtake general-purpose CPU chip manufacturers, designing chips with a feature size of 5 nm, because the profitability of mining is driving this industry even faster than general computing. There are no more giant leaps left in bitcoin mining, because the industry has reached the forefront of Moore&#8217;s Law, which stipulates that computing density will double approximately every 18 months. Still, the mining power of the network continues to advance at an exponential pace as the race for higher density chips is matched with a race for higher density data centers where thousands of these chips can be deployed. It&#8217;s no longer about how much mining can be done with one chip, but how many chips can be squeezed into a building, while still dissipating the heat and providing adequate power.</p>
</div>
<div class="sect3 data-line-864">
<h4 id="extra_nonce">The Extra Nonce Solution</h4>
<div class="paragraph data-line-866">
<p>Since 2012, bitcoin mining has evolved to resolve a fundamental limitation in the structure of the block header. In the early days of bitcoin, a miner could find a block by iterating through the nonce until the resulting hash was equal to or below the target. As difficulty increased, miners often cycled through all 4 billion values of the nonce without finding a block. However, this was easily resolved by updating the block timestamp to account for the elapsed time. Because the timestamp is part of the header, the change would allow miners to iterate through the values of the nonce again with different results.  Once mining hardware exceeded 4 GH/sec, however, this approach became increasingly difficult because the nonce values were exhausted in less than a second. As ASIC mining equipment started pushing and then exceeding the TH/sec hash rate, the mining software needed more space for nonce values in order to find valid blocks. The timestamp could be stretched a bit, but moving it too far into the future would cause the block to become invalid. A new source of "change" was needed in the block header. The solution was to use the coinbase transaction as a source of extra nonce values. Because the coinbase script can store between 2 and 100 bytes of data, miners started using that space as extra nonce space, allowing them to explore a much larger range of block header values to find valid blocks. The coinbase transaction is included in the merkle tree, which means that any change in the coinbase script causes the merkle root to change. Eight bytes of extra nonce, plus the 4 bytes of "standard" nonce allow miners to explore a total 2<sup>96</sup> (8 followed by 28 zeros) possibilities <em>per second</em> without having to modify the timestamp. If, in the future, miners could run through all these possibilities, they could then modify the timestamp. There is also more space in the coinbase script for future expansion of the extra nonce space.</p>
</div>
</div>
<div class="sect3 data-line-869">
<h4 id="mining_pools">Mining Pools</h4>
<div class="paragraph data-line-871">
<p>In this highly competitive environment, individual miners working alone (also known as solo miners) don&#8217;t stand a chance. The likelihood of them finding a block to offset their electricity and hardware costs is so low that it represents a gamble, like playing the lottery. Even the fastest consumer ASIC mining system cannot keep up with commercial systems that stack tens of thousands of these chips in giant warehouses near hydroelectric powerstations. Miners now collaborate to form mining pools, pooling their hashing power and sharing the reward among thousands of participants. By participating in a pool, miners get a smaller share of the overall reward, but typically get rewarded every day, reducing uncertainty.</p>
</div>
<div class="paragraph data-line-873">
<p>Let&#8217;s look at a specific example. Assume a miner has purchased mining hardware with a combined hashing rate of 14,000 gigahashes per second (GH/s), or 14 TH/s. In 2017 this equipment costs approximately $2,500 USD. The hardware consumes 1375 watts (1.3 kW) of electricity when running, 33 kW-hours a day, at a cost of $1 to $2 per day at very low electricity rates. At current bitcoin difficulty, the miner will be able to solo mine a block approximately once every 4 years. How do we work out that probability? It is based on a network-wide hashing rate of 3 EH/sec (in 2017), and the miner&#8217;s rate of 14 TH/sec:</p>
</div>
<ul class="simplelist">
  <li>P = (14 * 10<sup>12</sup> / 3 * 10<sup>18</sup>) * 210240 = 0.98</li>
</ul>
<div class="paragraph data-line-881">
<p>&#8230;&#8203;where 210240 is the number of blocks in four years. The miner has a 98% probability of finding a block over four years, based on the global hash rate at the beginning of the period.</p>
</div>
<div class="paragraph data-line-883">
<p>If the miner does find a single block in that timeframe, the payout of 6.25 bitcoin, at approximately $1,000 per bitcoin, will result in a single payout of $6,250, which will produce a net profit of about $750. However, the chance of finding a block in a 4-year period depends on the miner&#8217;s luck. He might find two blocks in 4 years and make a larger profit. Or he might not find a block for 5 years and suffer a big financial loss. Even worse, the difficulty of the bitcoin Proof-of-Work algorithm is likely to go up significantly over that period, at the current rate of growth of hashing power, meaning the miner has, at most, one year to break even before the hardware is effectively obsolete and must be replaced by more powerful mining hardware. Financially this only makes sense at very low electricity cost (less than 1 cent per kW-hour) and only at very large scale.</p>
</div>
<div class="paragraph data-line-885">
<p>Mining pools coordinate many hundreds or thousands of miners, over specialized pool-mining protocols. The individual miners configure their mining equipment to connect to a pool server, and specify a Bitcoin address, which will receive their share of the rewards. Their mining hardware remains connected to the pool server while mining, synchronizing their efforts with the other miners. Thus, the pool miners share the effort to mine a block and then share in the rewards.</p>
</div>
<div class="paragraph data-line-887">
<p>Successful blocks pay the reward to a pool Bitcoin address, rather than individual miners. The pool server will periodically make payments to the miners' Bitcoin addresses, once their share of the rewards has reached a certain threshold. Typically, the pool server charges a percentage fee of the rewards for providing the pool-mining service.</p>
</div>
<div class="paragraph data-line-889">
<p>Miners participating in a pool split the work of searching for a solution to a candidate block, earning "shares" for their mining contribution. The mining pool sets a higher target (lower difficulty) for earning a share, typically more than 1,000 times easier than the Bitcoin network&#8217;s target. When someone in the pool successfully mines a block, the reward is earned by the pool and then shared with all miners in proportion to the number of shares they contributed to the effort.</p>
</div>
<div class="paragraph data-line-891">
<p>Pools are open to any miner, big or small, professional or amateur. A pool will therefore have some participants with a single small mining machine, and others with a garage full of high-end mining hardware. Some will be mining with a few tens of a kilowatt of electricity, others will be running a data center consuming a megawatt of power. How does a mining pool measure the individual contributions, so as to fairly distribute the rewards, without the possibility of cheating? The answer is to use bitcoin&#8217;s Proof-of-Work algorithm to measure each pool miner&#8217;s contribution, but set at a lower difficulty so that even the smallest pool miners win a share frequently enough to make it worthwhile to contribute to the pool. By setting a lower difficulty for earning shares, the pool measures the amount of work done by each miner. Each time a pool miner finds a block header hash that is equal to or less than the pool target, she proves she has done the hashing work to find that result. More importantly, the work to find shares contributes, in a statistically measurable way, to the overall effort to find a hash equal to or lower than the Bitcoin network&#8217;s target. Thousands of miners trying to find low-value hashes will eventually find one low enough to satisfy the Bitcoin network target.</p>
</div>
<div class="paragraph data-line-893">
<p>Let&#8217;s return to the analogy of a dice game. If the dice players are throwing dice with a goal of throwing equal to or less than four (the overall network difficulty), a pool would set an easier target, counting how many times the pool players managed to throw equal to or less than eight. When pool players throw equal to or less than eight (the pool share target) but higher than four (higher than the overall network difficulty), they earn shares, but neither they nor the pool win the game because they don&#8217;t achieve the game target (equal to or less than four). The pool players will achieve the easier pool target much more often, earning them shares very regularly, even when they don&#8217;t achieve the harder target of winning the game. Every now and then, one of the pool players will throw a combined dice throw of equal to or less than four, the pool player wins a share and the whole pool wins the game. Then, the earnings can be distributed to the pool players based on the amount of shares each one has earned. Even though the target of eight-or-less wasn&#8217;t winning, it was a fair way to measure dice throws for the players, and it occasionally produces a four-or-less throw.</p>
</div>
<div class="paragraph data-line-895">
<p>Similarly, a mining pool will set a (higher and easier) pool target that will ensure that an individual pool miner can find block header hashes that are equal to or less than the pool target often, earning shares. Every now and then, one of these attempts will produce a block header hash that is equal to or less than the Bitcoin network target, making it a valid block and the whole pool wins.</p>
</div>
<div class="sect4 data-line-897">
<h5 id="_managed_pools">Managed pools</h5>
<div class="paragraph data-line-899">
<p>Most mining pools are "managed," meaning that there is a company or individual running a pool server. The owner of the pool server is called the <em>pool operator</em>, and he charges pool miners a percentage fee of the earnings.</p>
</div>
<div class="paragraph data-line-901">
<p>The pool server runs specialized software and a pool-mining protocol that coordinate the activities of the pool miners. The pool server is also connected to one or more full Bitcoin nodes and has direct access to a full copy of the blockchain database. This allows the pool server to validate blocks and transactions on behalf of the pool miners, relieving them of the burden of running a full node. For pool miners, this is an important consideration, because a full node requires a dedicated computer with at least 300 to 350 GB of persistent storage (disk) and at least 2 to 4 GB of memory (RAM). Furthermore, the bitcoin software running on the full node needs to be monitored, maintained, and upgraded frequently. Any downtime caused by a lack of maintenance or lack of resources will hurt the miner&#8217;s profitability. For many miners, the ability to mine without running a full node is another big benefit of joining a managed pool.</p>
</div>
<div class="paragraph data-line-903">
<p>Pool miners connect to the pool server using a mining protocol such as Stratum (STM) or GetBlockTemplate (GBT). An older standard called GetWork (GWK) has been mostly obsolete since late 2012, because it does not easily support mining at hash rates above 4 GH/s. Both the STM and GBT protocols create block <em>templates</em> that contain a template of a candidate block header. The pool server constructs a candidate block by aggregating transactions, adding a coinbase transaction (with extra nonce space), calculating the merkle root, and linking to the previous block hash. The header of the candidate block is then sent to each of the pool miners as a template. Each pool miner then mines using the block template, at a higher (easier) target than the Bitcoin network target, and sends any successful results back to the pool server to earn shares.</p>
</div>
</div>
<div class="sect4 data-line-905">
<h5 id="_peer_to_peer_mining_pool_p2pool">Peer-to-peer mining pool (P2Pool)</h5>
<div class="paragraph data-line-907">
<p>Managed pools create the possibility of cheating by the pool operator, who might direct the pool effort to double-spend transactions or invalidate blocks (see <a href="#consensus_attacks">Consensus Attacks</a>). Furthermore, centralized pool servers represent a single-point-of-failure. If the pool server is down or is slowed by a denial-of-service attack, the pool miners cannot mine. In 2011, to resolve these issues of centralization, a new pool mining method was proposed and implemented: P2Pool, a peer-to-peer mining pool without a central operator.</p>
</div>
<div class="paragraph data-line-909">
<p>P2Pool works by decentralizing the functions of the pool server, implementing a parallel blockchain-like system called a <em>share chain</em>. A share chain is a blockchain running at a lower difficulty than the Bitcoin blockchain. The share chain allows pool miners to collaborate in a decentralized pool by mining shares on the share chain at a rate of one share block every 30 seconds. Each of the blocks on the share chain records a proportionate share reward for the pool miners who contribute work, carrying the shares forward from the previous share block. When one of the share blocks also achieves the Bitcoin network target, it is propagated and included on the Bitcoin blockchain, rewarding all the pool miners who contributed to all the shares that preceded the winning share block. Essentially, instead of a pool server keeping track of pool miner shares and rewards, the share chain allows all pool miners to keep track of all shares using a decentralized consensus mechanism like bitcoin&#8217;s blockchain consensus mechanism.</p>
</div>
<div class="paragraph data-line-911">
<p>P2Pool mining is more complex than pool mining because it requires that the pool miners run a dedicated computer with enough disk space, memory, and internet bandwidth to support a full Bitcoin node and the P2Pool node software. P2Pool miners connect their mining hardware to their local P2Pool node, which simulates the functions of a pool server by sending block templates to the mining hardware. On P2Pool, individual pool miners construct their own candidate blocks, aggregating transactions much like solo miners, but then mine collaboratively on the share chain. P2Pool is a hybrid approach that has the advantage of much more granular payouts than solo mining, but without giving too much control to a pool operator like managed pools.</p>
</div>
<div class="paragraph data-line-914">
<p>Even though P2Pool reduces the concentration of power by mining pool operators, it is conceivably vulnerable to 51% attacks against the share chain itself. A much broader adoption of P2Pool does not solve the 51% attack problem for bitcoin itself. Rather, P2Pool makes bitcoin more robust overall, as part of a diversified mining ecosystem.</p>
</div>
</div>
</div>
</div>
<div class="sect2 data-line-917">
<h3 id="consensus_attacks">Consensus Attacks</h3>
<div class="paragraph data-line-919">
<p>Bitcoin&#8217;s consensus mechanism is, at least theoretically, vulnerable to attack by miners (or pools) that attempt to use their hashing power to dishonest or destructive ends. As we saw, the consensus mechanism depends on having a majority of the miners acting honestly out of self-interest. However, if a miner or group of miners can achieve a significant share of the mining power, they can attack the consensus mechanism so as to disrupt the security and availability of the Bitcoin network.</p>
</div>
<div class="paragraph data-line-921">
<p>It is important to note that consensus attacks can only affect future consensus, or at best, the most recent past (tens of blocks). Bitcoin&#8217;s ledger becomes more and more immutable as time passes. While in theory, a fork can be achieved at any depth, in practice, the computing power needed to force a very deep fork is immense, making old blocks practically immutable. Consensus attacks also do not affect the security of the private keys and signing algorithm (ECDSA). A consensus attack cannot steal bitcoin, spend bitcoin without signatures, redirect bitcoin, or otherwise change past transactions or ownership records. Consensus attacks can only affect the most recent blocks and cause denial-of-service disruptions on the creation of future blocks.</p>
</div>
<div class="paragraph data-line-923">
<p>One attack scenario against the consensus mechanism is called the "51% attack." In this scenario a group of miners, controlling a majority (51%) of the total network&#8217;s hashing power, collude to attack bitcoin. With the ability to mine the majority of the blocks, the attacking miners can cause deliberate "forks" in the blockchain and double-spend transactions or execute denial-of-service attacks against specific transactions or addresses. A fork/double-spend attack is where the attacker causes previously confirmed blocks to be invalidated by forking below them and re-converging on an alternate chain. With sufficient power, an attacker can invalidate six or more blocks in a row, causing transactions that were considered immutable (six confirmations) to be invalidated. Note that a double-spend can only be done on the attacker&#8217;s own transactions, for which the attacker can produce a valid signature. Double-spending one&#8217;s own transactions is profitable if by invalidating a transaction the attacker can get an irreversible exchange payment or product without paying for it.</p>
</div>
<div class="paragraph data-line-925">
<p>Let&#8217;s examine a practical example of a 51% attack. In the first chapter, we looked at a transaction between Alice and Bob for a cup of coffee. Bob, the cafe owner, is willing to accept payment for cups of coffee without waiting for confirmation (mining in a block), because the risk of a double-spend on a cup of coffee is low in comparison to the convenience of rapid customer service. This is similar to the practice of coffee shops that accept credit card payments without a signature for amounts below $25, because the risk of a credit-card chargeback is low while the cost of delaying the transaction to obtain a signature is comparatively larger. In contrast, selling a more expensive item for bitcoin runs the risk of a double-spend attack, where the buyer broadcasts a competing transaction that spends the same inputs (UTXO) and cancels the payment to the merchant. A double-spend attack can happen in two ways: either before a transaction is confirmed, or if the attacker takes advantage of a blockchain fork to undo several blocks. A 51% attack allows attackers to double-spend their own transactions in the new chain, thus undoing the corresponding transaction in the old chain.</p>
</div>
<div class="paragraph data-line-927">
<p>In our example, malicious attacker Mallory goes to Carol&#8217;s gallery and purchases a beautiful triptych painting depicting Satoshi Nakamoto as Prometheus. Carol sells "The Great Fire" paintings for $250,000 in bitcoin to Mallory. Instead of waiting for six or more confirmations on the transaction, Carol wraps and hands the paintings to Mallory after only one confirmation. Mallory works with an accomplice, Paul, who operates a large mining pool, and the accomplice launches a 51% attack as soon as Mallory&#8217;s transaction is included in a block. Paul directs the mining pool to remine the same block height as the block containing Mallory&#8217;s transaction, replacing Mallory&#8217;s payment to Carol with a transaction that double-spends the same input as Mallory&#8217;s payment. The double-spend transaction consumes the same UTXO and pays it back to Mallory&#8217;s wallet, instead of paying it to Carol, essentially allowing Mallory to keep the bitcoin. Paul then directs the mining pool to mine an additional block, so as to make the chain containing the double-spend transaction longer than the original chain (causing a fork below the block containing Mallory&#8217;s transaction). When the blockchain fork resolves in favor of the new (longer) chain, the double-spent transaction replaces the original payment to Carol. Carol is now missing the three paintings and also has no bitcoin payment. Throughout all this activity, Paul&#8217;s mining pool participants might remain blissfully unaware of the double-spend attempt, because they mine with automated miners and cannot monitor every transaction or block.</p>
</div>
<div class="paragraph data-line-929">
<p>To protect against this kind of attack, a merchant selling large-value items must wait at least six confirmations before giving the product to the buyer. Alternatively, the merchant should use an escrow multisignature account, again waiting for several confirmations after the escrow account is funded. The more confirmations elapse, the harder it becomes to invalidate a transaction with a 51% attack. For high-value items, payment by bitcoin will still be convenient and efficient even if the buyer has to wait 24 hours for delivery, which would correspond to approximately 144 confirmations.</p>
</div>
<div class="paragraph data-line-931">
<p>In addition to a double-spend attack, the other scenario for a consensus attack is to deny service to specific bitcoin participants (specific Bitcoin addresses). An attacker with a majority of the mining power can simply ignore specific transactions. If they are included in a block mined by another miner, the attacker can deliberately fork and remine that block, again excluding the specific transactions. This type of attack can result in a sustained denial-of-service against a specific address or set of addresses for as long as the attacker controls the majority of the mining power.</p>
</div>
<div class="paragraph data-line-933">
<p>Despite its name, the 51% attack scenario doesn&#8217;t actually require 51% of the hashing power. In fact, such an attack can be attempted with a smaller percentage of the hashing power. The 51% threshold is simply the level at which such an attack is almost guaranteed to succeed. A consensus attack is essentially a tug-of-war for the next block and the "stronger" group is more likely to win. With less hashing power, the probability of success is reduced, because other miners control the generation of some blocks with their "honest" mining power. One way to look at it is that the more hashing power an attacker has, the longer the fork he can deliberately create, the more blocks in the recent past he can invalidate, or the more blocks in the future he can control. Security research groups have used statistical modeling to claim that various types of consensus attacks are possible with as little as 30% of the hashing power.</p>
</div>
<div class="paragraph data-line-935">
<p>The massive increase of total hashing power has arguably made bitcoin impervious to attacks by a single miner. There is no possible way for a solo miner to control more than a small percentage of the total mining power. However, the centralization of control caused by mining pools has introduced the risk of for-profit attacks by a mining pool operator. The pool operator in a managed pool controls the construction of candidate blocks and also controls which transactions are included. This gives the pool operator the power to exclude transactions or introduce double-spend transactions. If such abuse of power is done in a limited and subtle way, a pool operator could conceivably profit from a consensus attack without being noticed.</p>
</div>
<div class="paragraph data-line-937">
<p>Not all attackers will be motivated by profit, however. One potential attack scenario is where an attacker intends to disrupt the Bitcoin network without the possibility of profiting from such disruption. A malicious attack aimed at crippling bitcoin would require enormous investment and covert planning, but could conceivably be launched by a well-funded, most likely state-sponsored, attacker. Alternatively, a well-funded attacker could attack bitcoin&#8217;s consensus by simultaneously amassing mining hardware, compromising pool operators, and attacking other pools with denial-of-service. All of these scenarios are theoretically possible, but increasingly impractical as the Bitcoin network&#8217;s overall hashing power continues to grow exponentially.</p>
</div>
<div class="paragraph data-line-939">
<p>Undoubtedly, a serious consensus attack would erode confidence in bitcoin in the short term, possibly causing a significant price decline. However, the Bitcoin network and software are constantly evolving, so consensus attacks would be met with immediate countermeasures by the bitcoin community, making bitcoin more robust.</p>
</div>
</div>
<div class="sect2 data-line-942">
<h3 id="consensus_changes">Changing the Consensus Rules</h3>
<div class="paragraph data-line-944">
<p>The rules of consensus determine the validity of transactions and blocks. These rules are the basis for collaboration between all Bitcoin nodes and are responsible for the convergence of all local perspectives into a single consistent blockchain across the entire network.</p>
</div>
<div class="paragraph data-line-946">
<p>While the consensus rules are invariable in the short term and must be consistent across all nodes, they are not invariable in the long term. In order to evolve and develop the Bitcoin system, the rules have to change from time to time to accommodate new features, improvements, or bug fixes. Unlike traditional software development, however, upgrades to a consensus system are much more difficult and require coordination between all the participants.</p>
</div>
<div class="sect3 data-line-950">
<h4 id="hard_forks">Hard Forks</h4>
<div class="paragraph data-line-951">
<p>In <a href="#forks">[forks]</a> we looked at how the Bitcoin network may briefly diverge, with two parts of the network following two different branches of the blockchain for a short time. We saw how this process occurs naturally, as part of the normal operation of the network and how the network reconverges on a common blockchain after one or more blocks are mined.</p>
</div>
<div class="paragraph data-line-953">
<p>There is another scenario in which the network may diverge into following two chains: a change in the consensus rules. This type of fork is called a <em>hard fork</em>, because after the fork the network does not reconverge onto a single chain. Instead, the two chains evolve independently. Hard forks occur when part of the network is operating under a different set of consensus rules than the rest of the network. This may occur because of a bug or because of a deliberate change in the implementation of the consensus rules.</p>
</div>
<div class="paragraph data-line-955">
<p>Hard forks can be used to change the rules of consensus, but they require coordination between all participants in the system. Any nodes that do not upgrade to the new consensus rules are unable to participate in the consensus mechanism and are forced onto a separate chain at the moment of the hard fork. Thus, a change introduced by a hard fork can be thought of as not "forward compatible," in that non-upgraded systems can&#8217;t process the new consensus rules after the hard fork event.</p>
</div>
<div class="paragraph data-line-957">
<p>Let&#8217;s examine the mechanics of a hard fork with a specific example.</p>
</div>
<div class="paragraph data-line-959">
<p><a href="#blockchainwithforks">A blockchain with forks</a> shows a blockchain with two forks. At block height 4, a one-block fork occurs. This is the type of spontaneous fork we saw in <a href="#forks">[forks]</a>. With the mining of block 5, the network reconverges on one chain and the fork is resolved.</p>
</div>
<div id="blockchainwithforks" class="imageblock data-line-963">
<div class="content">
<img src="images/mbc2_1009.png" alt="A blockchain with forks">
</div>
<div class="title">Figure 8. A blockchain with forks</div>
</div>
<div class="paragraph data-line-965">
<p>Later, however, at block height 6, a hard fork occurs. Let&#8217;s assume that a new implementation of the client is released with a change in the consensus rules. Starting on block height 7, miners running this new implementation will accept a new type of digital signature, let&#8217;s call it a "Smores" signature, that is not ECDSA based. Immediately after, a node running the new implementation creates a transaction that contains a Smores signature and a miner with the updated software mines block 7b containing this transaction.</p>
</div>
<div class="paragraph data-line-967">
<p>Any node or miner that has not upgraded the software to validate Smores signatures is now unable to process block 7b. From their perspective, both the transaction that contained a Smores signature and block 7b that contained that transaction are invalid, because they are evaluating them based upon the old consensus rules. These nodes will reject the transaction and the block and will not propagate them. Any miners that are using the old rules will not accept block 7b and will continue to mine a candidate block whose parent is block 6. In fact, miners using the old rules may not even receive block 7b if all the nodes they are connected to are also obeying the old rules and therefore not propagating the block. Eventually, they will be able to mine block 7a, which is valid under the old rules and does not contain any transactions with Smores signatures.</p>
</div>
<div class="paragraph data-line-969">
<p>The two chains continue to diverge from this point. Miners on the "b" chain will continue to accept and mine transactions containing Smores signatures, while miners on the "a" chain will continue to ignore these transactions. Even if block 8b does not contain any Smores-signed transactions, the miners on the "a" chain cannot process it. To them it appears to be an orphan block, as its parent "7b" is not recognized as a valid block.</p>
</div>
</div>
<div class="sect3 data-line-971">
<h4 id="_hard_forks_software_network_mining_and_chain">Hard Forks: Software, Network, Mining, and Chain</h4>
<div class="paragraph data-line-973">
<p>For software developers, the term "fork" has another meaning, adding confusion to the term "hard fork." In open source software, a fork occurs when a group of developers choose to follow a different software roadmap and start a competing implementation of an open source project. We&#8217;ve already discussed two circumstances that will lead to a hard fork in bitcoin: a bug in the consensus rules and a deliberate modification of the consensus rules. In the case of a deliberate change to the consensus rules, a software fork precedes the hard fork. However, for this type of hard fork to occur, a new software implementation of the consensus rules must be developed, adopted, and launched.</p>
</div>
<div class="paragraph data-line-975">
<p>Examples of software forks that have attempted to change consensus rules include Bitcoin XT, Bitcoin Classic, and most recently Bitcoin Unlimited. However, none of these software forks have resulted in a hard fork. While a software fork is a necessary precondition, it is not in itself sufficient for a hard fork to occur. For a hard fork to occur, the competing implementation must be adopted and the new rules activated, by miners, wallets, and intermediary nodes. Conversely, there are numerous alternative implementations of Bitcoin Core, and even software forks, that do not change the consensus rules and barring a bug, can coexist on the network and interoperate without causing a hard fork.</p>
</div>
<div class="paragraph data-line-977">
<p>Consensus rules may differ in obvious and explicit ways, in the validation of transactions or blocks. The rules may also differ in more subtle ways, in the implementation of the consensus rules as they apply to bitcoin scripts or cryptographic primitives such as digital signatures. Finally, the consensus rules may differ in unanticipated ways because of implicit consensus constraints imposed by system limitations or implementation details. An example of the latter was seen in the unanticipated hard fork during the upgrade of Bitcoin Core 0.7 to 0.8, which was caused by a limitation in the Berkeley DB implementation used to store blocks.</p>
</div>
<div class="paragraph data-line-979">
<p>Conceptually, we can think of a hard fork as developing in four stages: a software fork, a network fork, a mining fork, and a chain fork.</p>
</div>
<div class="paragraph data-line-981">
<p>The process begins when an alternative implementation of the client, with modified consensus rules, is created by developers.</p>
</div>
<div class="paragraph data-line-983">
<p>When this forked implementation is deployed in the network, a certain percentage of miners, wallet users, and intermediate nodes may adopt and run this implementation. A resulting fork will depend upon whether the new consensus rules apply to blocks, transactions, or some other aspect of the system. If the new consensus rules pertain to transactions, then a wallet creating a transaction under the new rules may precipitate a network fork, followed by a hard fork when the transaction is mined into a block. If the new rules pertain to blocks, then the hard fork process will begin when a block is mined under the new rules.</p>
</div>
<div class="paragraph data-line-985">
<p>First, the network will fork. Nodes based on the original implementation of the consensus rules will reject any transactions and blocks that are created under the new rules. Furthermore, the nodes following the original consensus rules will temporarily ban and disconnect from any nodes that are sending them these invalid transactions and blocks. As a result, the network will partition into two: old nodes will only remain connected to old nodes and new nodes will only be connected to new nodes. A single transaction or block based on the new rules will ripple through the network and result in the partition into two networks.</p>
</div>
<div class="paragraph data-line-987">
<p>Once a miner using the new rules mines a block, the mining power and chain will also fork. New miners will mine on top of the new block, while old miners will mine a separate chain based on the old rules. The partitioned network will make it so that the miners operating on separate consensus rules won&#8217;t likely receive each other&#8217;s blocks, as they are connected to two separate networks.</p>
</div>
</div>
<div class="sect3 data-line-989">
<h4 id="_diverging_miners_and_difficulty">Diverging Miners and Difficulty</h4>
<div class="paragraph data-line-991">
<p>As miners diverge into mining two different chains, the hashing power is split between the chains. The mining power can be split in any proportion between the two chains. The new rules may only be followed by a minority, or by the vast majority of the mining power.</p>
</div>
<div class="paragraph data-line-993">
<p>Let&#8217;s assume, for example, an 80%&#x2013;20% split, with the majority of the mining power using the new consensus rules. Let&#8217;s also assume that the fork occurs immediately after a retargeting period.</p>
</div>
<div class="paragraph data-line-995">
<p>The two chains would each inherit the difficulty from the retargeting period. The new consensus rules would have 80% of the previously available mining power committed to them. From the perspective of this chain, the mining power has suddenly declined by 20% vis-a-vis the previous period. Blocks will be found on average every 12.5 minutes, representing the 20% decline in mining power available to extend this chain. This rate of block issuance will continue (barring any changes in hashing power) until 2016 blocks are mined, which will take approximately 25,200 minutes (at 12.5 minutes per block), or 17.5 days. After 17.5 days, a retarget will occur and the difficulty will adjust (reduced by 20%) to produce 10-minute blocks again, based on the reduced amount of hashing power in this chain.</p>
</div>
<div class="paragraph data-line-997">
<p>The minority chain, mining under the old rules with only 20% of the hashing power, will face a much more difficult task. On this chain, blocks will now be mined every 50 minutes on average. The difficulty will not be adjusted for 2016 blocks, which will take 100,800 minutes, or approximately 10 weeks to mine. Assuming a fixed capacity per block, this will also result in a reduction of transaction capacity by a factor of 5, as there are fewer blocks per hour available to record transactions.</p>
</div>
</div>
<div class="sect3 data-line-999">
<h4 id="_contentious_hard_forks">Contentious Hard Forks</h4>
<div class="paragraph data-line-1001">
<p>This is the dawn of consensus software development. Just as open source development changed both the methods and products of software and created new methodologies, new tools, and new communities in its wake, consensus software development also represents a new frontier in computer science. Out of the debates, experiments, and tribulations of the bitcoin development roadmap, we will see new development tools, practices, methodologies, and communities emerge.</p>
</div>
<div class="paragraph data-line-1003">
<p>Hard forks are seen as risky because they force a minority to either upgrade or remain on a minority chain. The risk of splitting the entire system into two competing systems is seen by many as an unacceptable risk. As a result, many developers are reluctant to use the hard fork mechanism to implement upgrades to the consensus rules, unless there is near-unanimous support from the entire network. Any hard fork proposals that do not have near-unanimous support are considered too "contentious" to attempt without risking a partition of the system.</p>
</div>
<div class="paragraph data-line-1005">
<p>The issue of hard forks is highly controversial in the bitcoin development community, especially as it relates to any proposed changes to the consensus rules controlling the maximum block size limit. Some developers are opposed to any form of hard fork, seeing it as too risky. Others see the mechanism of hard fork as an essential tool for upgrading the consensus rules in a way that avoids "technical debt" and provides a clean break with the past. Finally, some developers see hard forks as a mechanism that should be used rarely, with a lot of advance planning and only under near-unanimous consensus.</p>
</div>
<div class="paragraph data-line-1007">
<p>Already we have seen the emergence of new methodologies to address the risks of hard forks. In the next section, we will look at soft forks, and the BIP-34 and BIP-9 methods for signaling and activation of consensus modifications.</p>
</div>
</div>
<div class="sect3 data-line-1009">
<h4 id="_soft_forks">Soft Forks</h4>
<div class="paragraph data-line-1011">
<p>Not all consensus rule changes cause a hard fork. Only consensus changes that are forward-incompatible cause a fork. If the change is implemented in such a way that a non-upgraded client still sees the transaction or block as valid under the previous rules, the change can happen without a fork.</p>
</div>
<div class="paragraph data-line-1013">
<p>The term <em>soft fork</em> was introduced to distinguish this upgrade method from a "hard fork." In practice, a soft fork is not a fork at all. A soft fork is a forward-compatible change to the consensus rules that allows non-upgraded clients to continue to operate in consensus with the new rules.</p>
</div>
<div class="paragraph data-line-1015">
<p>One aspect of soft forks that is not immediately obvious is that soft fork upgrades can only be used to constrain the consensus rules, not to expand them. In order to be forward compatible, transactions and blocks created under the new rules must be valid under the old rules too, but not vice versa. The new rules can only limit what is valid; otherwise, they will trigger a hard fork when rejected under the old rules.</p>
</div>
<div class="paragraph data-line-1017">
<p>Soft forks can be implemented in a number of ways&#x2014;the term does not specify a particular method, rather a set of methods that all have one thing in common: they don&#8217;t require all nodes to upgrade or force non-upgraded nodes out of consensus.</p>
</div>
<div class="sect4 data-line-1019">
<h5 id="_soft_forks_redefining_nop_opcodes">Soft forks redefining NOP opcodes</h5>
<div class="paragraph data-line-1021">
<p>A number of soft forks have been implemented in bitcoin, based on the re-interpretation of NOP opcodes. Bitcoin Script had ten opcodes reserved for future use, NOP1 through NOP10. Under the consensus rules, the presence of these opcodes in a script is interpreted as a null-potent operator, meaning they have no effect. Execution continues after the NOP opcode as if it wasn&#8217;t there.</p>
</div>
<div class="paragraph data-line-1023">
<p>A soft fork therefore can modify the semantics of a NOP code to give it new meaning. For example, BIP-65 (CHECKLOCKTIMEVERIFY) reinterpreted the NOP2 opcode. Clients implementing BIP-65 interpret NOP2 as OP_CHECKLOCKTIMEVERIFY and impose an absolute locktime consensus rule on UTXO that contain this opcode in their locking scripts. This change is a soft fork because a transaction that is valid under BIP-65 is also valid on any client that is not implementing (ignorant of) BIP-65. To the old clients, the script contains an NOP code, which is ignored.</p>
</div>
</div>
<div class="sect4 data-line-1025">
<h5 id="_other_ways_to_soft_fork_upgrade">Other ways to soft fork upgrade</h5>
<div class="paragraph data-line-1027">
<p>The reinterpretation of NOP opcodes was both planned for and an obvious mechanism for consensus upgrades. Recently, however, another soft fork mechanism was introduced that does not rely on NOP opcodes for a very specific type of consensus change. This is examined in more detail in <a href="#segwit">[segwit]</a>. Segwit is an architectural change to the structure of a transaction, which moves the unlocking script (witness) from inside the transaction to an external data structure (segregating it). Segwit was initially envisioned as a hard fork upgrade, as it modified a fundamental structure (transaction). In November 2015, a developer working on Bitcoin Core proposed a mechanism by which segwit could be introduced as a soft fork. The mechanism used for this is a modification of the locking script of UTXO created under segwit rules, such that non-upgraded clients see the locking script as redeemable with any unlocking script whatsoever. As a result, segwit can be introduced without requiring every node to upgrade or split from the chain: a soft fork.</p>
</div>
<div class="paragraph data-line-1029">
<p>It is likely that there are other, yet to be discovered, mechanisms by which upgrades can be made in a forward-compatible way as a soft fork.</p>
</div>
</div>
</div>
<div class="sect3 data-line-1031">
<h4 id="_criticisms_of_soft_forks">Criticisms of Soft Forks</h4>
<div class="paragraph data-line-1033">
<p>Soft forks based on the NOP opcodes are relatively uncontroversial. The NOP opcodes were placed in Bitcoin Script with the explicit goal of allowing non-disruptive upgrades.</p>
</div>
<div class="paragraph data-line-1035">
<p>However, many developers are concerned that other methods of soft fork upgrades make unacceptable tradeoffs. Common criticisms of soft fork changes include:</p>
</div>
<div class="dlist data-line-1037">
<dl>
<dt class="hdlist1">Technical debt</dt>
<dd>
<p>Because soft forks are more technically complex than a hard fork upgrade, they introduce <em>technical debt</em>, a term that refers to increasing the future cost of code maintenance because of design tradeoffs made in the past. Code complexity in turn increases the likelihood of bugs and security vulnerabilities.</p>
</dd>
<dt class="hdlist1">Validation relaxation</dt>
<dd>
<p>Non-upgraded clients see transactions as valid, without evaluating the modified consensus rules. In effect, the non-upgraded clients are not validating using the full range of consensus rules, as they are blind to the new rules. This applies to NOP-based upgrades, as well as other soft fork upgrades.</p>
</dd>
<dt class="hdlist1">Irreversible upgrades</dt>
<dd>
<p>Because soft forks create transactions with additional consensus constraints, they become irreversible upgrades in practice. If a soft fork upgrade were to be reversed after being activated, any transactions created under the new rules could result in a loss of funds under the old rules. For example, if a CLTV transaction is evaluated under the old rules, there is no timelock constraint and it can be spent at any time. Therefore, critics contend that a failed soft fork that had to be reversed because of a bug would almost certainly lead to loss of funds.</p>
</dd>
</dl>
</div>
</div>
</div>
<div class="sect2 data-line-1044">
<h3 id="softforksignaling">Soft Fork Signaling with Block Version</h3>
<div class="paragraph data-line-1046">
<p>Since soft forks allow non-upgraded clients to continue to operate within consensus, the mechanism for "activating" a soft fork is through miners signaling readiness: a majority of miners must agree that they are ready and willing to enforce the new consensus rules. To coordinate their actions, there is a signaling mechanism that allows them to show their support for a consensus rule change. This mechanism was introduced with the activation of BIP-34 in March 2013 and replaced by the activation of BIP-9 in July 2016.</p>
</div>
<div class="sect3 data-line-1048">
<h4 id="_bip_34_signaling_and_activation">BIP-34 Signaling and Activation</h4>
<div class="paragraph data-line-1050">
<p>The first implementation, in BIP-34, used the block version field to allow miners to signal readiness for a specific consensus rule change. Prior to BIP-34, the block version was set to "1" by <em>convention</em> not enforced by <em>consensus</em>.</p>
</div>
<div class="paragraph data-line-1052">
<p>BIP-34 defined a consensus rule change that required the coinbase data field of a coinbase transaction input to contain the block height. Prior to BIP-34, the coinbase data could contain any arbitrary data the miners chose to include. After activation of BIP-34, valid blocks had to contain a specific block-height at the beginning of the coinbase data and be identified with a version number greater than or equal to "2."</p>
</div>
<div class="paragraph data-line-1054">
<p>To signal the change and activation of BIP-34, miners set the block version to "2," instead of "1." This did not immediately make version "1" blocks invalid. Once activated, version "1" blocks would become invalid and all version "2" blocks would be required to contain the block height in the coinbase to be valid.</p>
</div>
<div class="paragraph data-line-1056">
<p>BIP-34 defined a two-step activation mechanism, based on a rolling window of 1000 blocks. A miner would signal his or her individual readiness for BIP-34 by constructing blocks with "2" as the version number. Strictly speaking, these blocks did not yet have to comply with the new consensus rule of including the block-height in the coinbase transaction because the consensus rule had not yet been activated. The consensus rules activated in two steps:</p>
</div>
<div class="ulist data-line-1058">
<ul>
<li class="data-line-1058">
<p>If 75% (750 of the most recent 1000 blocks) are marked with version "2," then version "2" blocks must contain block height in the coinbase transaction or they are rejected as invalid. Version "1" blocks are still accepted by the network and do not need to contain block-height. The old and new consensus rules coexist during this period.</p>
</li>
<li class="data-line-1060">
<p>When 95% (950 of the most recent 1000 blocks) are version "2," version "1" blocks are no longer considered valid. Version "2" blocks are valid only if they contain the block-height in the coinbase (as per the previous threshold). Thereafter, all blocks must comply with the new consensus rules, and all valid blocks must contain block-height in the coinbase transaction.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1062">
<p>After successful signaling and activation under the BIP-34 rules, this mechanism was used twice more to activate soft forks:</p>
</div>
<div class="ulist data-line-1064">
<ul>
<li class="data-line-1064">
<p><a href="https://github.com/bitcoin/bips/blob/master/bip-0066.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0066.mediawiki">BIP-66</a> Strict DER Encoding of Signatures was activated by BIP-34 style signaling with a block version "3" and invalidating version "2" blocks.</p>
</li>
<li class="data-line-1066">
<p><a href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0065.mediawiki">BIP-65</a> CHECKLOCKTIMEVERIFY was activated by BIP-34 style signaling with a block version "4" and invalidating version "3" blocks.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1068">
<p>After the activation of BIP-65, the signaling and activation mechanism of BIP-34 was retired and replaced with the BIP-9 signaling mechanism described next.</p>
</div>
<div class="paragraph data-line-1070">
<p>The standard is defined in <a href="https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0034.mediawiki">BIP-34 (Block v2, Height in Coinbase)</a>.</p>
</div>
</div>
<div class="sect3 data-line-1072">
<h4 id="_bip_9_signaling_and_activation">BIP-9 Signaling and Activation</h4>
<div class="paragraph data-line-1074">
<p>The mechanism used by BIP-34, BIP-66, and BIP-65 was successful in activating three soft forks. However, it was replaced because it had several limitations:</p>
</div>
<div class="ulist data-line-1076">
<ul>
<li class="data-line-1076">
<p>By using the integer value of the block version, only one soft fork could be activated at a time, so it required coordination between soft fork proposals and agreement on their prioritization and sequencing.</p>
</li>
<li class="data-line-1078">
<p>Furthermore, because the block version was incremented, the mechanism didn&#8217;t offer a straightforward way to reject a change and then propose a different one. If old clients were still running, they could mistake signaling for a new change as signaling for the previously rejected change.</p>
</li>
<li class="data-line-1080">
<p>Each new change irrevocably reduced the available block versions for future changes.</p>
</li>
</ul>
</div>
<div class="paragraph data-line-1082">
<p>BIP-9 was proposed to overcome these challenges and improve the rate and ease of implementing future changes.</p>
</div>
<div class="paragraph data-line-1084">
<p>BIP-9 interprets the block version as a bit field instead of an integer. Because the block version was originally used as an integer, versions 1 through 4, only 29 bits remain available to be used as a bit field. This leaves 29 bits that can be used to independently and simultaneously signal readiness on 29 different proposals.</p>
</div>
<div class="paragraph data-line-1086">
<p>BIP-9 also sets a maximum time for signaling and activation. This way miners don&#8217;t need to signal forever. If a proposal is not activated within the TIMEOUT period (defined in the proposal), the proposal is considered rejected. The proposal may be resubmitted for signaling with a different bit, renewing the activation period.</p>
</div>
<div class="paragraph data-line-1088">
<p>Furthermore, after the TIMEOUT has passed and a feature has been activated or rejected, the signaling bit can be reused for another feature without confusion. Therefore, up to 29 changes can be signaled in parallel and after TIMEOUT the bits can be "recycled" to propose new changes.</p>
</div>
<div class="exampleblock data-line-1091">
<div class="content">
<div class="paragraph data-line-1092">
<p>While signaling bits can be reused or recycled, as long as the voting period does not overlap, the authors of BIP-9 recommend that bits are reused only when necessary; unexpected behavior could occur due to bugs in older software. In short, we should not expect to see reuse until all 29 bits have been used once.</p>
</div>
</div>
</div>
<div class="paragraph data-line-1095">
<p>Proposed changes are identified by a data structure that contains the following fields:</p>
</div>
<div class="dlist data-line-1097">
<dl>
<dt class="hdlist1">name</dt>
<dd>
<p>A short description used to distinguish between proposals. Most often the BIP describing the proposal, as "bipN," where N is the BIP number.</p>
</dd>
<dt class="hdlist1">bit</dt>
<dd>
<p>0 through 28, the bit in the block version that miners use to signal approval for this proposal.</p>
</dd>
<dt class="hdlist1">starttime</dt>
<dd>
<p>The time (based on Median Time Past, or MTP) that signaling starts after which the bit&#8217;s value is interpreted as signaling readiness for the proposal.</p>
</dd>
<dt class="hdlist1">endtime</dt>
<dd>
<p>The time (based on MTP) after which the change is considered rejected if it has not reached the activation threshold.</p>
</dd>
</dl>
</div>
<div class="paragraph data-line-1105">
<p>Unlike BIP-34, BIP-9 counts activation signaling in whole intervals based on the difficulty retarget period of 2016 blocks. For every retarget period, if the sum of blocks signaling for a proposal exceeds 95% (1916 of 2016), the proposal will be activated one retarget period later.</p>
</div>
<div class="paragraph data-line-1107">
<p>BIP-9 offers a proposal state diagram to illustrate the various stages and transitions for a proposal, as shown in <a href="#bip9states">BIP-9 state transition diagram</a>.</p>
</div>
<div class="paragraph data-line-1109">
<p>Proposals start in the DEFINED state, once their parameters are known (defined) in the bitcoin software. For blocks with MTP after the start time, the proposal state transitions to STARTED. If the voting threshold is exceeded within a retarget period and the timeout has not been exceeded, the proposal state transitions to LOCKED_IN. One retarget period later, the proposal becomes ACTIVE. Proposals remain in the ACTIVE state perpetually once they reach that state. If the timeout elapses before the voting threshold has been reached, the proposal state changes to FAILED, indicating a rejected proposal. FAILED proposals remain in that state perpetually.</p>
</div>
<div id="bip9states" class="imageblock data-line-1113">
<div class="content">
<img src="images/mbc2_1010.png" alt="BIP-9 Proposal State Transition Diagram">
</div>
<div class="title">Figure 9. BIP-9 state transition diagram</div>
</div>
<div class="paragraph data-line-1115">
<p>BIP-9 was first implemented for the activation of CHECKSEQUENCEVERIFY and associated BIPs (68, 112, 113). The proposal named "csv" was activated successfully in July of 2016.</p>
</div>
<div class="paragraph data-line-1117">
<p>The standard is defined in <a href="https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki" data-href="https://github.com/bitcoin/bips/blob/master/bip-0009.mediawiki">BIP-9 (Version bits with timeout and delay)</a>.</p>
</div>
</div>
</div>
<div class="sect2 data-line-1119">
<h3 id="_consensus_software_development">Consensus Software Development</h3>
<div class="paragraph data-line-1121">
<p>Consensus software continues to evolve and there is much discussion on the various mechanisms for changing the consensus rules. By its very nature, bitcoin sets a very high bar on coordination and consensus for changes. As a decentralized system, it has no "authority" that can impose its will on the participants of the network. Power is diffused between multiple constituencies such as miners, core developers, wallet developers, exchanges, merchants, and end users. Decisions cannot be made unilaterally by any of these constituencies. For example, while miners can theoretically change the rules by simple majority (51%), they are constrained by the consent of the other constituencies. If they act unilaterally, the rest of the participants may simply refuse to follow them, keeping the economic activity on a minority chain. Without economic activity (transactions, merchants, wallets, exchanges), the miners will be mining a worthless coin with empty blocks. This diffusion of power means that all the participants must coordinate, or no changes can be made. Status quo is the stable state of this system with only a few changes possible if there is strong consensus by a very large majority. The 95% threshold for soft forks is reflective of this reality.</p>
</div>
<div class="paragraph data-line-1123">
<p>It is important to recognize that there is no perfect solution for consensus development. Both hard forks and soft forks involve tradeoffs. For some types of changes, soft forks may be a better choice; for others, hard forks may be a better choice. There is no perfect choice; both carry risks. The one constant characteristic of consensus software development is that change is difficult and consensus forces compromise.</p>
</div>
<div class="paragraph data-line-1125">
<p>Some see this as a weakness of consensus systems. In time, you may come to see it as I do, as the system&#8217;s greatest strength.</p>
</div>
</div>
</div>
</div>
</div>
<div id="footer">
<div id="footer-text">
Last updated 2022-03-09 14:56:10 -0500
</div>
</div>
</body>
</html>